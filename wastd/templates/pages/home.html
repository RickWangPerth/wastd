{% extends "base.html" %}
{% load leaflet_tags geojson_tags %}

{% block map %}
<div id="mapholder">
    {% leaflet_map "wastdmap" callback="window.map_init" %}
</div>
{% endblock map %}

{% block javascript%}
{{ block.super }}
<script type="text/javascript">
  // var collection = {{ qs_results|geojsonfeature|safe }};
  function map_init(map, options) {
    // L.geoJson(collection).addTo(map);
    $.getJSON("{% url 'observation-geojson' %}", function (data) {
        L.geoJson(data, {
            style: function (feature) {
                return { /* color: feature.properties.colour */ };
            },
            onEachFeature: function (feature, layer) {
                layer.bindPopup(
                    feature.properties.as_html,
                    {minWidth: "350px", maxWidth: "450px"}); // ignored - why?
            }
        }).addTo(map);
    });
  }
</script>
{% endblock %}
