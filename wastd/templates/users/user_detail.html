{% extends "pages/base.html" %}
{% load leaflet_tags geojson_tags static %}

{% block title %}User: {{ object.username }}{% endblock %}

{% block content %}

 <!-- breadcrumbs.html-->
<div class="row">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="{% url 'home' %}">Home</a>
      </li>
      <li class="breadcrumb-item">
        <a href="{% url 'users:user-list' %}">Users</a>
      </li>
      <li class="breadcrumb-item active">
        <a href="">{{ object }}</a>
      </li>
    </ol>
  </nav>
</div>
<!-- /breadcrumbs.html -->

  <div class="row" id="obj-detail-main">
    <div class="col-12 col-sm-12 col-md-6 col-lg-8">
      {% include object.card_template %}
    </div><!-- .col -->
    <div class="col-12 col-md-6 col-lg-4" id="occ-detail-map">
      <div>
        {% leaflet_map "detailmap" callback="window.map_init" %}
      </div>
    </div><!-- /.col#occ-map -->
  </div><!-- .row#id="obj-detail-main" -->


  <div class="row mt-2" id="row-enc">
    <div class="col-12" id="col-enc">
      {% for enc in object.encounters_reported.all %}
      {% include enc.card_template with object=enc %}
      {% endfor %}
    </div><!-- /.col-svy-enc -->
  </div><!-- /.row-svy-enc -->
{% endblock content %}

{% block extrajs %}
  <!-- Some widgets need JQuery to be loaded early -->
  {% if settings.OFFLINE %}{# Serve third party libraries locally - demo mode #}
  <script src="{% static 'offline/jquery.min.js' %}"></script>
  {% else %}{# Serve third party libraries from CDN - production mode #}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
    integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
    crossorigin="anonymous"></script>
  {% endif %}
  <script type="text/javascript">
  function map_init(map, options) {

    {% include 'shared/styles.js' %}

    $.getJSON("{% url 'sites-geojson' %}", function (data) {
        L.geoJson(data, {style: polystyle, onEachFeature: oef}).addTo(map);
    });

    /* Data loading */


    var enc_layer = L.geoJson(
      {{ object.encounters_reported.all|geojsonfeature:"as_html,leaflet_title,leaflet_icon,leaflet_colour:where"|safe }},
      { style: pointstyle, pointToLayer: ptl, onEachFeature: oef_ll }
    );
    enc_layer.addTo(map);

    map.fitBounds(enc_layer.getBounds());

  };

  </script>
  {% endblock %}
