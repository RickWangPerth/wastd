{% extends "base.html" %}
{% load static %}

{% block title %}User: {{ object.username }}{% endblock %}

{% block content %}
<div class="container">

  <div class="row">
    <div class="col-sm-12">
      <h2>{{ object }}</h2>
      <p>
          <i class="fa fa-envelope" aria-hidden="true"></i> {{ object.email }}
          <i class="fa fa-mobile" aria-hidden="true"></i> {{ object.phone }}
      </p>

  </div>
</div>

<div class="row">
  <div class="col-sm-12">
    <p>
      <a href="/api/1/encounters/?format=latex&observer={{ object.pk }}"
          class="btn btn-primary btn-sm"
          target="_" title="Export contributions of {% firstof object.name object.username %}">
          <i class="fa fa-fw fa-file-pdf-o"></i>
          Export all encounters by {% firstof object.name object.username %}
      </a>
    </p>
  </div>
</div>

{% if object == request.user %}
<!-- Action buttons -->
<div class="row">

  <div class="col-sm-12 ">
    <p>
    <a class="btn btn-primary" href="{% url 'users:update' %}">My Info</a>
    <a class="btn btn-primary" href="{% url 'account_email' %}">E-Mail</a>
    </p>
  </div>

</div>
<!-- End Action buttons -->
<!-- API auth -->
<div class="row">
    <div class="col-sm-12 ">
        <h2>Accessing the data</h2>
        <p>You can access all data through the API using your API token:
            <strong>{{ request.user.apitoken }}</strong>.</p>

            <h3>Code example in R</h3>
            <pre>
require(httr); require(jsonlite); require(DT)
url = "{{ request.scheme }}://{{ request.get_host }}/api/1/animal-encounters/"
hdr = c(Authorization = "Token {{ request.user.apitoken }}")
j = httr::GET(paste0(url, "?format=json"), add_headers(.headers = hdr)) %>% content("text") %>% fromJSON
d = httr::GET(paste0(url, "?format=csv"),  add_headers(.headers = hdr)) %>% content("parsed")
datatable(d)
            </pre>
            <p>
            <strong>j</strong> is the data as JSON dictionary,
            <strong>d</strong> is the data as data.frame.
            Note, the Token is only required for PUT, POST and DELETE requests.
            </p>

            <h3>Code example in Python</h3>
            <pre>
import requests
url = '{{ request.scheme }}://{{ request.get_host }}/api/1/animal-encounters/'
headers = {"Authorization": "Token {{ request.user.apitoken }}"}
j = requests.get(url + "?format=json", headers=headers).json()
d = requests.get(url + "?format=csv", headers=headers).content
            </pre>

            <h3>Code example on the command line</h3>
            <pre>
curl -X GET {{ request.scheme }}://{{ request.get_host }}/api/1/animal-encounters/ -H 'Authorization: Token {{ request.user.apitoken }}'
            </pre>

        </div><!-- /.col-sm-12 "-->
</div><!-- /.row "-->
<!-- End API auth -->
{% endif %}

</div><!-- /.container "-->
{% endblock content %}
