{% load observations %}
{% with original as o %}
<!-- Heading -->
<div class="row">
    <h4>{% block title %}Encounter{% endblock %}{% if o.name %} {{ o.name }}{% endif%}</h4>
</div>

<!-- Optional image carousel -->
{% if o.photographs %}
<div class="row margin-top-15">
    <div class="col-md-6">
        <div id="slideshow-bob" class="carousel slide" data-ride="carousel">
          {% if o.photographs|length > 1 %}
          <ol id="popup-image-indicators" class="carousel-indicators">
            {% for p in o.photographs %}
            <li data-target="#carousel-example-generic"
                data-slide-to="{{ forloop.counter }}"
                {% if forloop.first %}class="active"{% endif %}></li>
            {% endfor %}
          </ol>
          {% endif %}
          <div class="carousel-inner" role="listbox">
              {% for p in o.photographs %}
            <div class="carousel-item{% if forloop.first %} active{% endif %}">
              <img src="{{ p.attachment.url }}" width="100%" alt="{{ p.title }}"/>
            </div>
            {% endfor %}
          </div>
          {% if o.photographs|length > 1 %}
          <a class="left carousel-control" href="#slideshow-bob"
             role="button" data-slide="prev">
            <span class="icon-prev" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="right carousel-control" href="#slideshow-bob"
             role="button" data-slide="next">
            <span class="icon-next" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
          {% endif %}
        </div>
    </div>
    <div class="col-md-6">
{% endif %}

{% block headlines %}{% endblock %}

<!-- Location & time -->
<div class="row">
    <i class="fa fa-fw fa-map-marker"></i>
    Lat {{ o.latitude|floatformat:"-4" }} Lon {{ o.longitude|floatformat:"-4" }}
    ({{ o.crs }}) &plusmn; {{ o.location_accuracy }} m
</div>
<div class="row">
    <i class="fa fa-fw fa-calendar"></i>
    {{ o.when|date:"r" }}
</div>

<!-- Observer -->
<div class="row">
    <i class="fa fa-fw fa-eye"></i>
    <a href="mailto:{{ o.observer.email }}">{{ o.observer.name }}</a>

    <i class="fa fa-fw fa-pencil"></i>
    <a href="mailto:{{ o.reporter.email }}">{{ o.reporter.name }}</a>
</div>

<!--  Observations -->
{% block encounterdetails %}{% endblock %}
{% for obs in o.observations %}
    {{ obs.as_html|safe }}
{% endfor %}

<div class="row">
    <!-- QA status -->
    <span class="{{ o.status|tb_status_icon }}">{{ o.get_status_display }}</span>

    <!-- URL to change_view -->
    <i class="fa fa-fw fa-pencil"></i>
    <a href="{{ o.absolute_admin_url }}" target="_" title="Open in new tab">
        Edit Encounter
    </a>
</div>
<div class="row">
    <!-- URL to change_list of encounter history for encounter name -->
    {% if o.name %}
    <i class="fa fa-fw fa-history"></i>
    <a href="{% url 'admin:observations_encounter_changelist' %}?name={{ o.name }}"
        target="_" title="Open in new tab">Browse history of {{ o.name }}</a>
    {% endif %}
</div>

{% if o.photographs %}
</div><!-- /.col-md-6 -->
</div><!-- /.row -->
{% endif %}

{% endwith %}
