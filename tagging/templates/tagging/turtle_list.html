{% extends "base_wastd.html" %}
{% load bootstrap_pagination crispy_forms_tags %}

{% block page_content_inner %}
<!-- Search bar -->
<div class="row">
    <div class="col-xs-12 col-sm-6">
        {% comment %}
        <div class="accordion" id="filterTurtles">
            <div class="card">
                <div class="card-header p-0" id="headingFilterTurtles">
                    <h5 class="m-0">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseFilter" aria-expanded="true" aria-controls="collapseFilter">
                            <i class="fa-solid fa-square-caret-down" aria-hidden="true"></i>
                            Filter/search turtles
                        </button>
                    </h5>
                </div>
                <div id="collapseFilter" class="collapse show" aria-labelledby="headingFilterTurtles" data-parent="#filterTurtles">
                    <div class="card-body p-2">
                        {% crispy search_form %}
                    </div>
                </div>
            </div>
        </div>
        {% endcomment %}
        <form action="" method="get">
            <input id="search_field" type="text" class="form-control" name="q" placeholder="Search turtles (ID, tags, name, etc.)" value="{{ query_string }}">
        </form>
    </div>
    <div class="col-xs-12 col-sm-6">
        <span class="float-right">
            <!-- FIXME: proper permissions check -->
            {% if user.is_staff %}
            <a class="btn btn-primary" href="{% url 'admin:tagging_turtle_add' %}">
                <i class="fa-solid fa-plus"></i>
                Create new turtle
            </a>
            {% else %}
            <a class="btn btn-primary disabled" href="">
                <i class="fa-solid fa-plus"></i>
                Create new turtle
            </a>
            {% endif %}
        </span>
    </div>
</div>

{% block pagination_row %}
<div class="row mt-1" id="pagination-row">
    <div class="col">
    {% if object_list %}
        {% if object_count %}<div>Found {{ object_count }} records</div>{% endif %}
        {% if page_obj.has_other_pages %}<div>{% bootstrap_paginate page_obj range=10 show_prev_next="true" show_first_last="true" %}</div>{% endif %}
    {% endif %}
    </div>
</div>
{% endblock pagination_row %}

{% if object_list %}
<div class="row">
  <div class="col">
    <table class="table table-striped table-bordered table-sm table-hover">
        <thead>
            <tr>
                <th>ID</th>
                <th>Species</th>
                <th>Sex</th>
                <th>Tags</th>
                <th>Nesting/other group</th>
                <th>Date entered</th>
                <th>Name</th>
                <th>Status</th>
                <th>Observations</th>
                <th>Cause of death</th>
            </tr>
        </thead>
        <tbody>
            {% for obj in object_list %}
            <tr>
                <td>{{ obj.pk }}</td>
                <td><a href="{{ obj.get_absolute_url }}">{{ obj.species.common_name }}</a></td>
                <td>{{ obj.get_sex_display }}</td>
                <td>{{ obj.get_tags_description }}</td>
                <td>{{ obj.location.name }}</td>
                <td>{{ obj.created|date:"j M Y" }}</td>
                <td>{{ obj.name|default_if_none:"" }}</td>
                <td>{{ obj.status.description|default_if_none:"" }}</td>
                <td>{{ obj.turtleobservation_set.count }}</td>
                <td>{{ obj.get_cause_of_death_display|default_if_none:"" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
  </div>
</div>
{% endif %}

{% if object_list %}
{% if page_obj.has_other_pages %}<div>{% bootstrap_paginate page_obj range=10 show_prev_next="true" show_first_last="true" %}</div>{% endif %}
{% endif %}

{% endblock page_content_inner %}

{% block extra_js %}{% endblock %}
