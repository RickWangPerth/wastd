

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>wastd.observations.models &mdash; WAStD 0.46.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> WAStD
          

          
          </a>

          
            
            
              <div class="version">
                0.46
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../data_collection/data_collection_overview.html">Data collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_collection/data_collection_admin.html">Data collection administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_collection/data_collection_training.html">Data collection training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_curators.html">Data curators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_curators.html#data-upload-from-odk">Data upload from ODK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_qa.html">Data QA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_qa.html#data-release">Data release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_consumers.html">Data consumers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../business_analysts.html">Business Analysts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../business_analysts.html#how-it-s-made-the-process">How itâ€™s made - the process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../business_analysts.html#reproducible-research">Reproducible Research</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainers.html">Application maintainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers.html">Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers.html#project-delivery-ticking-the-boxes">Project delivery: ticking the boxes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">WAStD</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>wastd.observations.models</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for wastd.observations.models</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Observation models.</span>

<span class="sd">These models support opportunistic encounters with stranded, dead, injured,</span>
<span class="sd">nesting turtles and possibly other wildlife, such as cetaceans and pinnipeds.</span>

<span class="sd">Species use a local name list, but should lookup a webservice.</span>
<span class="sd">This Observation is generic for all species. Other Models can FK this Model</span>
<span class="sd">to add species-specific measurements.</span>

<span class="sd">Observer name / address / phone / email is captured through the observer being</span>
<span class="sd">a system user.</span>

<span class="sd">The combination of species and health determines subsequent measurements and</span>
<span class="sd">actions:</span>

<span class="sd">* [turtle, dugong, cetacean] damage observation</span>
<span class="sd">* [turtle, dugong, cetacean] distinguishing features</span>
<span class="sd">* [taxon] morphometrics</span>
<span class="sd">* [flipper, pit, sat] tag observation</span>
<span class="sd">* disposal actions</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">dateutil</span> <span class="kn">import</span> <span class="n">parser</span> <span class="k">as</span> <span class="n">dateparser</span>

<span class="kn">import</span> <span class="nn">slugify</span>
<span class="kn">from</span> <span class="nn">dateutil</span> <span class="kn">import</span> <span class="n">tz</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.contrib.gis.db</span> <span class="kn">import</span> <span class="n">models</span> <span class="k">as</span> <span class="n">geo_models</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.db.models.fields</span> <span class="kn">import</span> <span class="n">DurationField</span>
<span class="kn">from</span> <span class="nn">django.db.models.signals</span> <span class="kn">import</span> <span class="n">post_save</span><span class="p">,</span> <span class="n">pre_delete</span><span class="p">,</span> <span class="n">pre_save</span>
<span class="kn">from</span> <span class="nn">django.dispatch</span> <span class="kn">import</span> <span class="n">receiver</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">loader</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">force_text</span>
<span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">mark_safe</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="c1"># from django_fsm import FSMField, transition</span>
<span class="c1"># from django_fsm_log.decorators import fsm_log_by</span>
<span class="kn">from</span> <span class="nn">django_fsm_log.models</span> <span class="kn">import</span> <span class="n">StateLog</span>
<span class="kn">from</span> <span class="nn">polymorphic.models</span> <span class="kn">import</span> <span class="n">PolymorphicModel</span>
<span class="kn">from</span> <span class="nn">rest_framework.reverse</span> <span class="kn">import</span> <span class="n">reverse</span> <span class="k">as</span> <span class="n">rest_reverse</span>
<span class="kn">from</span> <span class="nn">shared.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="c1"># CodeLabelDescriptionMixin,</span>
    <span class="c1"># RenderMixin,</span>
    <span class="n">LegacySourceMixin</span><span class="p">,</span>
    <span class="c1"># ObservationAuditMixin,</span>
    <span class="n">QualityControlMixin</span><span class="p">,</span>
    <span class="n">UrlsMixin</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">shared.utils</span> <span class="kn">import</span> <span class="n">sanitize_tag_label</span>

<span class="kn">from</span> <span class="nn">wastd.users.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Lookups --------------------------------------------------------------------#</span>

<span class="n">SOURCE_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;direct&quot;</span>
<span class="n">SOURCE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">SOURCE_DEFAULT</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Direct entry&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Paper data sheet&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;odk&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;OpenDataKit mobile data capture&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;wamtram&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;WAMTRAM 2 tagging DB&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;ntp-exmouth&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;NTP Access DB Exmouth&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;ntp-broome&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;NTP Access DB Broome&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;cet&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Cetacean strandings DB&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;pin&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Pinniped strandings DB&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;reconstructed&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Reconstructed by WAStD&quot;</span><span class="p">)),</span>
<span class="p">)</span>

<span class="n">BODY_PART_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;whole&quot;</span>
<span class="n">TURTLE_BODY_PART_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;head&quot;</span><span class="p">,</span> <span class="s2">&quot;head&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;eyes&quot;</span><span class="p">,</span> <span class="s2">&quot;eyes&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;neck&quot;</span><span class="p">,</span> <span class="s2">&quot;neck&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;plastron&quot;</span><span class="p">,</span> <span class="s2">&quot;plastron&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;carapace&quot;</span><span class="p">,</span> <span class="s2">&quot;carapace&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;internals&quot;</span><span class="p">,</span> <span class="s2">&quot;internals&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;cloaca&quot;</span><span class="p">,</span> <span class="s2">&quot;cloaca&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;tail&quot;</span><span class="p">,</span> <span class="s2">&quot;tail&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;flipper-front-left-1&quot;</span><span class="p">,</span> <span class="s2">&quot;front left flipper, 1st scale from body&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;flipper-front-left-2&quot;</span><span class="p">,</span> <span class="s2">&quot;front left flipper, 2nd scale from body&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;flipper-front-left-3&quot;</span><span class="p">,</span> <span class="s2">&quot;front left flipper, 3rd scale from body&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;flipper-front-left&quot;</span><span class="p">,</span> <span class="s2">&quot;front left flipper&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;flipper-front-right-1&quot;</span><span class="p">,</span> <span class="s2">&quot;front right flipper, 1st scale from body&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;flipper-front-right-2&quot;</span><span class="p">,</span> <span class="s2">&quot;front right flipper, 2nd scale from body&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;flipper-front-right-3&quot;</span><span class="p">,</span> <span class="s2">&quot;front right flipper, 3rd scale from body&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;flipper-front-right&quot;</span><span class="p">,</span> <span class="s2">&quot;front right flipper&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;flipper-rear-left&quot;</span><span class="p">,</span> <span class="s2">&quot;rear left flipper&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;flipper-rear-right&quot;</span><span class="p">,</span> <span class="s2">&quot;rear right flipper&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;shoulder-left&quot;</span><span class="p">,</span> <span class="s2">&quot;left shoulder&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;shoulder-right&quot;</span><span class="p">,</span> <span class="s2">&quot;right shoulder&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">BODY_PART_DEFAULT</span><span class="p">,</span> <span class="s2">&quot;whole turtle&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="s1">&#39;Other&#39;</span><span class="p">),</span> <span class="p">)</span>

<span class="n">TAG_TYPE_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;flipper-tag&#39;</span>
<span class="n">TAG_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">TAG_TYPE_DEFAULT</span><span class="p">,</span> <span class="s1">&#39;Flipper Tag&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;tag-scar&#39;</span><span class="p">,</span> <span class="s1">&#39;Tag Scar&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;pit-tag&#39;</span><span class="p">,</span> <span class="s1">&#39;PIT Tag&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;sat-tag&#39;</span><span class="p">,</span> <span class="s1">&#39;Satellite Relay Data Logger&#39;</span><span class="p">),</span>  <span class="c1"># SRDL</span>
    <span class="p">(</span><span class="s1">&#39;blood-sample&#39;</span><span class="p">,</span> <span class="s1">&#39;Blood Sample&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;biopsy-sample&#39;</span><span class="p">,</span> <span class="s1">&#39;Biopsy Sample&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;stomach-content-sample&#39;</span><span class="p">,</span> <span class="s1">&#39;Stomach Content Sample&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;physical-sample&#39;</span><span class="p">,</span> <span class="s1">&#39;Physical Sample&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;egg-sample&#39;</span><span class="p">,</span> <span class="s1">&#39;Egg Sample&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;qld-monel-a-flipper-tag&#39;</span><span class="p">,</span> <span class="s1">&#39;QLD Monel Series A flipper tag&#39;</span><span class="p">),</span>               <span class="c1"># TRT_IDENTIFICATION_TYPES A</span>
    <span class="p">(</span><span class="s1">&#39;qld-titanium-k-flipper-tag&#39;</span><span class="p">,</span> <span class="s1">&#39;QLD Titanium Series K flipper tag&#39;</span><span class="p">),</span>         <span class="c1"># TRT_IDENTIFICATION_TYPES K</span>
    <span class="p">(</span><span class="s1">&#39;qld-titanium-t-flipper-tag&#39;</span><span class="p">,</span> <span class="s1">&#39;QLD Titanium Series T flipper tag&#39;</span><span class="p">),</span>         <span class="c1"># TRT_IDENTIFICATION_TYPES T</span>
    <span class="p">(</span><span class="s1">&#39;acoustic-tag&#39;</span><span class="p">,</span> <span class="s1">&#39;Acoustic tag&#39;</span><span class="p">),</span>                                            <span class="c1"># Acoustic</span>
    <span class="p">(</span><span class="s1">&#39;commonwealth-titanium-flipper-tag&#39;</span><span class="p">,</span> <span class="s1">&#39;Commonwealth titanium flipper tag (old db value)&#39;</span><span class="p">),</span>    <span class="c1"># CA cmlth</span>
    <span class="p">(</span><span class="s1">&#39;cmlth-titanium-flipper-tag&#39;</span><span class="p">,</span> <span class="s1">&#39;Commonwealth titanium flipper tag&#39;</span><span class="p">),</span>         <span class="c1"># CA cmlth</span>
    <span class="p">(</span><span class="s1">&#39;cayman-juvenile-tag&#39;</span><span class="p">,</span> <span class="s1">&#39;Cayman juvenile tag&#39;</span><span class="p">),</span>                              <span class="c1"># CT</span>
    <span class="p">(</span><span class="s1">&#39;hawaii-inconel-flipper-tag&#39;</span><span class="p">,</span> <span class="s1">&#39;Hawaii Inst Mar Biol Inconel tag&#39;</span><span class="p">),</span>          <span class="c1"># I</span>
    <span class="p">(</span><span class="s1">&#39;ptt&#39;</span><span class="p">,</span> <span class="s1">&#39;Platform Transmitter Terminal (PTT)&#39;</span><span class="p">),</span>                              <span class="c1"># PTT</span>
    <span class="p">(</span><span class="s1">&#39;rototag&#39;</span><span class="p">,</span> <span class="s1">&#39;RotoTag&#39;</span><span class="p">),</span>                                                      <span class="c1"># SFU/FIU</span>
    <span class="p">(</span><span class="s1">&#39;narangebub-nickname&#39;</span><span class="p">,</span> <span class="s1">&#39;Narangebup rehab informal name&#39;</span><span class="p">),</span>                   <span class="c1"># RREC</span>
    <span class="p">(</span><span class="s1">&#39;aqwa-nickname&#39;</span><span class="p">,</span> <span class="s1">&#39;AQWA informal name&#39;</span><span class="p">),</span>                                     <span class="c1"># UWW, UnderWater World</span>
    <span class="p">(</span><span class="s1">&#39;atlantis-nickname&#39;</span><span class="p">,</span> <span class="s1">&#39;Atlantis informal name&#39;</span><span class="p">),</span>                             <span class="c1"># ATLANTIS</span>
    <span class="p">(</span><span class="s1">&#39;wa-museum-reptile-registration-number&#39;</span><span class="p">,</span>
        <span class="s1">&#39;WA Museum Natural History Reptiles Catalogue Registration Number (old db value)&#39;</span><span class="p">),</span>  <span class="c1"># WAMusR</span>
    <span class="p">(</span><span class="s1">&#39;wam-reptile-registration-number&#39;</span><span class="p">,</span>
        <span class="s1">&#39;WA Museum Natural History Reptiles Catalogue Registration Number&#39;</span><span class="p">),</span>     <span class="c1"># WAMusR</span>
    <span class="p">(</span><span class="s1">&#39;genetic-tag&#39;</span><span class="p">,</span> <span class="s1">&#39;Genetic ID sequence&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="s1">&#39;Other&#39;</span><span class="p">),)</span>

<span class="n">TAG_STATUS_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;resighted&#39;</span>
<span class="n">TAG_STATUS_APPLIED_NEW</span> <span class="o">=</span> <span class="s1">&#39;applied-new&#39;</span>
<span class="n">TAG_STATUS_CHOICES</span> <span class="o">=</span> <span class="p">(</span>                                          <span class="c1"># TRT_TAG_STATES</span>
    <span class="p">(</span><span class="s1">&#39;ordered&#39;</span><span class="p">,</span> <span class="s1">&#39;ordered from manufacturer&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;produced&#39;</span><span class="p">,</span> <span class="s1">&#39;produced by manufacturer&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;delivered&#39;</span><span class="p">,</span> <span class="s1">&#39;delivered to HQ&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;allocated&#39;</span><span class="p">,</span> <span class="s1">&#39;allocated to field team&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">TAG_STATUS_APPLIED_NEW</span><span class="p">,</span> <span class="s1">&#39;applied new&#39;</span><span class="p">),</span>                    <span class="c1"># A1, AE</span>
    <span class="p">(</span><span class="n">TAG_STATUS_DEFAULT</span><span class="p">,</span> <span class="s1">&#39;re-sighted associated with animal&#39;</span><span class="p">),</span>  <span class="c1"># OX, P, P_OK, RQ, P_ED</span>
    <span class="p">(</span><span class="s1">&#39;reclinched&#39;</span><span class="p">,</span> <span class="s1">&#39;re-sighted and reclinched on animal&#39;</span><span class="p">),</span>      <span class="c1"># RC</span>
    <span class="p">(</span><span class="s1">&#39;removed&#39;</span><span class="p">,</span> <span class="s1">&#39;taken off animal&#39;</span><span class="p">),</span>                            <span class="c1"># OO, R</span>
    <span class="p">(</span><span class="s1">&#39;found&#39;</span><span class="p">,</span> <span class="s1">&#39;found detached&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;returned&#39;</span><span class="p">,</span> <span class="s1">&#39;returned to HQ&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;decommissioned&#39;</span><span class="p">,</span> <span class="s1">&#39;decommissioned&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;destroyed&#39;</span><span class="p">,</span> <span class="s1">&#39;destroyed&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="s1">&#39;observed in any other context, see comments&#39;</span><span class="p">),</span> <span class="p">)</span>

<span class="n">TAG_STATUS_RESIGHTED</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;resighted&#39;</span><span class="p">,</span> <span class="s1">&#39;reclinched&#39;</span><span class="p">,</span> <span class="s1">&#39;removed&#39;</span><span class="p">)</span>
<span class="n">TAG_STATUS_ON_ANIMAL</span> <span class="o">=</span> <span class="p">(</span><span class="n">TAG_STATUS_APPLIED_NEW</span><span class="p">,</span> <span class="n">TAG_STATUS_RESIGHTED</span><span class="p">)</span>

<span class="n">NEST_TAG_STATUS_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">TAG_STATUS_APPLIED_NEW</span><span class="p">,</span> <span class="s1">&#39;applied new&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">TAG_STATUS_DEFAULT</span><span class="p">,</span> <span class="s1">&#39;re-sighted associated with nest&#39;</span><span class="p">),</span>
<span class="p">)</span>


<span class="n">NA_VALUE</span> <span class="o">=</span> <span class="s2">&quot;na&quot;</span>
<span class="n">NA</span> <span class="o">=</span> <span class="p">((</span><span class="n">NA_VALUE</span><span class="p">,</span> <span class="s2">&quot;not observed&quot;</span><span class="p">),</span> <span class="p">)</span>

<span class="n">TAXON_CHOICES_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;Cheloniidae&quot;</span>
<span class="n">TAXON_CHOICES</span> <span class="o">=</span> <span class="n">NA</span> <span class="o">+</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">TAXON_CHOICES_DEFAULT</span><span class="p">,</span> <span class="s2">&quot;Marine turtles&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Cetacea&quot;</span><span class="p">,</span> <span class="s2">&quot;Whales and Dolphins&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Pinnipedia&quot;</span><span class="p">,</span> <span class="s2">&quot;Pinnipeds&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Sirenia&quot;</span><span class="p">,</span> <span class="s2">&quot;Dugongs&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Elasmobranchii&quot;</span><span class="p">,</span> <span class="s2">&quot;Sharks and Rays&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Hydrophiinae&quot;</span><span class="p">,</span> <span class="s2">&quot;Sea snakes and kraits&quot;</span><span class="p">),</span> <span class="p">)</span>

<span class="n">TURTLE_SPECIES_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;cheloniidae-fam&#39;</span>
<span class="n">TURTLE_SPECIES_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;natator-depressus&#39;</span><span class="p">,</span> <span class="s1">&#39;Natator depressus (Flatback turtle)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;chelonia-mydas&#39;</span><span class="p">,</span> <span class="s1">&#39;Chelonia mydas (Green turtle)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;eretmochelys-imbricata&#39;</span><span class="p">,</span> <span class="s1">&#39;Eretmochelys imbricata (Hawksbill turtle)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;caretta-caretta&#39;</span><span class="p">,</span> <span class="s1">&#39;Caretta caretta (Loggerhead turtle)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lepidochelys-olivacea&#39;</span><span class="p">,</span> <span class="s1">&#39;Lepidochelys olivacea (Olive ridley turtle)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;dermochelys-coriacea&#39;</span><span class="p">,</span> <span class="s1">&#39;Dermochelys coriacea (Leatherback turtle)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;chelonia-mydas-agassazzi&#39;</span><span class="p">,</span> <span class="s1">&#39;Chelonia mydas agassazzi (Black turtle or East Pacific Green)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;corolla-corolla&#39;</span><span class="p">,</span> <span class="s1">&#39;Corolla corolla (Hatchback turtle)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">TURTLE_SPECIES_DEFAULT</span><span class="p">,</span> <span class="s1">&#39;Cheloniidae (Unidentified turtle)&#39;</span><span class="p">),</span>
    <span class="c1"># Caretta caretta x Chelonia mydas (Hybrid turtle)</span>
    <span class="c1"># Chelonia mydas x Eretmochelys imbricata (Hybrid turtle)</span>
    <span class="c1"># Natator depressus x Caretta caretta (Hybrid turtle)</span>
    <span class="c1"># Natator depressus x Chelonia mydas (Hybrid turtle)</span>
<span class="p">)</span>
<span class="n">CETACEAN_SPECIES_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># dolphins</span>
    <span class="p">(</span><span class="s2">&quot;delphinus-delphis&quot;</span><span class="p">,</span> <span class="s2">&quot;Delphinus delphis (Short-beaked common dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;grampus-griseus&quot;</span><span class="p">,</span> <span class="s2">&quot;Grampus griseus (Risso&#39;s dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;lagenodelphis-hosei&quot;</span><span class="p">,</span> <span class="s2">&quot;Lagenodelphis hosei (Fraser&#39;s dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;lagenorhynchus-obscurus&quot;</span><span class="p">,</span> <span class="s2">&quot;Lagenorhynchus obscurus (Dusky dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;orcaella-heinsohni&quot;</span><span class="p">,</span> <span class="s2">&quot;Orcaella heinsohni (Australian snubfin dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;sousa-sahulensis&quot;</span><span class="p">,</span> <span class="s2">&quot;Sousa sahulensis (Australian humpback dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;sousa-chinensis&quot;</span><span class="p">,</span> <span class="s2">&quot;Sousa chinensis (Chinese white dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;stenella-attenuata&quot;</span><span class="p">,</span> <span class="s2">&quot;Stenella attenuata (Pantropical spotted dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;stenella-coeruleoalba&quot;</span><span class="p">,</span> <span class="s2">&quot;Stenella coeruleoalba (Striped dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;stenella-longirostris&quot;</span><span class="p">,</span> <span class="s2">&quot;Stenella longirostris (Spinner dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;stenella-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Stenella sp. (Unidentified spotted dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;steno-bredanensis&quot;</span><span class="p">,</span> <span class="s2">&quot;Steno bredanensis (Rough-toothed dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;tursiops-aduncus&quot;</span><span class="p">,</span> <span class="s2">&quot;Tursiops aduncus (Indo-Pacific bottlenose dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;tursiops-truncatus&quot;</span><span class="p">,</span> <span class="s2">&quot;Tursiops truncatus (Offshore bottlenose dolphin)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;tursiops-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Tursiops sp. (Unidentified bottlenose dolphin)&quot;</span><span class="p">),</span>

    <span class="p">(</span><span class="s2">&quot;delphinidae-fam&quot;</span><span class="p">,</span> <span class="s2">&quot;Unidentified dolphin&quot;</span><span class="p">),</span>
    <span class="c1"># whales</span>
    <span class="p">(</span><span class="s2">&quot;balaenoptera-acutorostrata&quot;</span><span class="p">,</span> <span class="s2">&quot;Balaenoptera acutorostrata (Dwarf minke whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;balaenoptera-bonaerensis&quot;</span><span class="p">,</span> <span class="s2">&quot;Balaenoptera bonaerensis (Antarctic minke whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;balaenoptera-borealis&quot;</span><span class="p">,</span> <span class="s2">&quot;Balaenoptera borealis (Sei whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;balaenoptera-edeni&quot;</span><span class="p">,</span> <span class="s2">&quot;Balaenoptera edeni (Bryde&#39;s whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;balaenoptera-musculus&quot;</span><span class="p">,</span> <span class="s2">&quot;Balaenoptera musculus (Blue whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;balaenoptera-musculus-brevicauda&quot;</span><span class="p">,</span> <span class="s2">&quot;Balaenoptera musculus brevicauda (Pygmy blue whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;balaenoptera-physalus&quot;</span><span class="p">,</span> <span class="s2">&quot;Balaenoptera physalus (Fin whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;balaenoptera-omurai&quot;</span><span class="p">,</span> <span class="s2">&quot;Balaenoptera omurai (Omura&#39;s whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;balaenoptera-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Balaenoptera sp. (Unidentified Balaenoptera)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;caperea-marginata&quot;</span><span class="p">,</span> <span class="s2">&quot;Caperea marginata (Pygmy Right Whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;eubalaena-australis&quot;</span><span class="p">,</span> <span class="s2">&quot;Eubalaena australis (Southern right whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;feresa-attenuata&quot;</span><span class="p">,</span> <span class="s2">&quot;Feresa attenuata (Pygmy killer whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;globicephala-macrorhynchus&quot;</span><span class="p">,</span> <span class="s2">&quot;Globicephala macrorhynchus (Short-finned pilot whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;globicephala-melas&quot;</span><span class="p">,</span> <span class="s2">&quot;Globicephala melas (Long-finned pilot whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;globicephala-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Globicephala sp. (Unidentified pilot whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;indopacetus-pacificus&quot;</span><span class="p">,</span> <span class="s2">&quot;Indopacetus pacificus (Longman&#39;s beaked whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;kogia-breviceps&quot;</span><span class="p">,</span> <span class="s2">&quot;Kogia breviceps (Pygmy sperm whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;kogia-sima&quot;</span><span class="p">,</span> <span class="s2">&quot;Kogia sima (Dwarf sperm whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;kogia-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Kogia sp. (Unidentified small sperm whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;megaptera-novaeangliae&quot;</span><span class="p">,</span> <span class="s2">&quot;Megaptera novaeangliae (Humpback whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;mesoplodon-bowdoini&quot;</span><span class="p">,</span> <span class="s2">&quot;Mesoplodon bowdoini (Andew&#39;s beaked whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;mesoplodon-densirostris&quot;</span><span class="p">,</span> <span class="s2">&quot;Mesoplodon densirostris (Blainville&#39;s beaked whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;mesoplodon-grayi&quot;</span><span class="p">,</span> <span class="s2">&quot;Mesoplodon grayi (Gray&#39;s beaked whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;mesoplodon-hectori&quot;</span><span class="p">,</span> <span class="s2">&quot;Mesoplodon hectori (Hector&#39;s beaked whale&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;mesoplodon-layardii&quot;</span><span class="p">,</span> <span class="s2">&quot;Mesoplodon layardii (Strap-toothed whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;mesoplodon-mirus&quot;</span><span class="p">,</span> <span class="s2">&quot;Mesoplodon mirus (True&#39;s beaked whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;mesoplodon-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Mesoplodon sp. (Beaked whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;berardius-arnuxii&quot;</span><span class="p">,</span> <span class="s2">&quot;Berardius arnuxii (Giant beaked whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;orcinus-orca&quot;</span><span class="p">,</span> <span class="s2">&quot;Orcinus orca (Killer whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;peponocephala-electra&quot;</span><span class="p">,</span> <span class="s2">&quot;Peponocephala electra (Melon-headed whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;physeter-macrocephalus&quot;</span><span class="p">,</span> <span class="s2">&quot;Physeter macrocephalus (Sperm whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;pseudorca-crassidens&quot;</span><span class="p">,</span> <span class="s2">&quot;Pseudorca crassidens (False killer whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ziphius-cavirostris&quot;</span><span class="p">,</span> <span class="s2">&quot;Ziphius cavirostris (Cuvier&#39;s beaked whale)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;tasmacetus-shepherdi&quot;</span><span class="p">,</span> <span class="s2">&quot;Tasmacetus shepherdi (Shepherd&#39;s beaked whale)&quot;</span><span class="p">),</span>

    <span class="p">(</span><span class="s2">&quot;cetacea&quot;</span><span class="p">,</span> <span class="s2">&quot;Unidentified whale&quot;</span><span class="p">),</span> <span class="p">)</span>

<span class="n">PINNIPED_SPECIES_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;pinnipedia&#39;</span>
<span class="n">PINNIPED_SPECIES_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;arctocephalus-forsteri&quot;</span><span class="p">,</span> <span class="s2">&quot;Arctocephalus forsteri (New Zealand fur seal)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;neophoca-cinerea&quot;</span><span class="p">,</span> <span class="s2">&quot;Neophoca cinerea (Australian sea lion)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;arctocephalus-tropicalis&quot;</span><span class="p">,</span> <span class="s2">&quot;Arctocephalus tropicalis (Subantarctic fur seal)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;hydrurga-leptonyx&quot;</span><span class="p">,</span> <span class="s2">&quot;Hydrurga leptonyx (Leopard seal)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;lobodon-carcinophagus&quot;</span><span class="p">,</span> <span class="s2">&quot;Lobodon carcinophagus (Crabeater seal)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;mirounga-leonina&quot;</span><span class="p">,</span> <span class="s2">&quot;Mirounga leonina (Southern elephant seal)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">PINNIPED_SPECIES_DEFAULT</span><span class="p">,</span> <span class="s2">&quot;Unidentified pinniped&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">SEASNAKE_SPECIES_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;hydrophiinae-subfam&#39;</span>
<span class="n">SEASNAKE_SPECIES_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">SEASNAKE_SPECIES_DEFAULT</span><span class="p">,</span> <span class="s2">&quot;Hydrophiinae subfam. (Sea snakes and kraits)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;acalyptophis-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Acalyptophis sp. (Horned sea snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;aipysurus-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Aipysurus sp. (Olive sea snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;astrotia-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Astrotia sp. (Stokes&#39; sea snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;emydocephalus-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Emydocephalus sp. (Turtlehead sea snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;enhydrina-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Enhydrina sp. (Beaked sea snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ephalophis-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Ephalophis sp. (Grey&#39;s mudsnake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;hydrelaps-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Hydrelaps sp. (Port Darwin mudsnake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;hydrophis-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Hydrophis sp. (sea snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;kerilia-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Kerilia sp. (Jerdon&#39;s sea snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;kolpophis-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Kolpophis sp. (bighead sea snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;lapemis-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Lapemis sp. (Shaw&#39;s sea snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;laticauda-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Laticauda sp. (Sea krait)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;parahydrophis-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Parahydrophis (Northern mangrove sea snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;parapistocalamus-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Parapistocalamus sp. (Hediger&#39;s snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;pelamis-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Pelamis sp. (Yellow-bellied sea snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;praescutata-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Praescutata sp. (Sea snake)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;thalassophis-sp&quot;</span><span class="p">,</span> <span class="s2">&quot;Thalassophis sp. (Sea snake)&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">SIRENIA_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;dugong-dugon&quot;</span><span class="p">,</span> <span class="s2">&quot;Dugong dugon (Dugong)&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">SPECIES_CHOICES</span> <span class="o">=</span> <span class="n">NA</span> <span class="o">+</span>\
    <span class="n">TURTLE_SPECIES_CHOICES</span> <span class="o">+</span>\
    <span class="n">CETACEAN_SPECIES_CHOICES</span> <span class="o">+</span>\
    <span class="n">SIRENIA_CHOICES</span> <span class="o">+</span>\
    <span class="n">PINNIPED_SPECIES_CHOICES</span> <span class="o">+</span>\
    <span class="n">SEASNAKE_SPECIES_CHOICES</span>

<span class="n">SEX_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">NA_VALUE</span><span class="p">,</span> <span class="s2">&quot;NA sex&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown sex&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;male&quot;</span><span class="p">,</span> <span class="s2">&quot;male&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;female&quot;</span><span class="p">,</span> <span class="s2">&quot;female&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;intersex&quot;</span><span class="p">,</span> <span class="s2">&quot;hermaphrodite or intersex&quot;</span><span class="p">),</span> <span class="p">)</span>

<span class="n">TURTLE_MATURITY_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;hatchling&quot;</span><span class="p">,</span> <span class="s2">&quot;hatchling&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;post-hatchling&quot;</span><span class="p">,</span> <span class="s2">&quot;post-hatchling&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;juvenile&quot;</span><span class="p">,</span> <span class="s2">&quot;juvenile&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;pre-pubsecent-immature&quot;</span><span class="p">,</span> <span class="s2">&quot;pre-pubsecent immature&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;pubsecent-immature&quot;</span><span class="p">,</span> <span class="s2">&quot;pubsecent immature&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;sub-adult&quot;</span><span class="p">,</span> <span class="s2">&quot;sub-adult&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;adult-measured&quot;</span><span class="p">,</span> <span class="s2">&quot;adult (status determined from carapace and tail measurements)&quot;</span><span class="p">),</span> <span class="p">)</span>

<span class="n">MAMMAL_MATURITY_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;unweaned&quot;</span><span class="p">,</span> <span class="s2">&quot;unweaned immature&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;weaned&quot;</span><span class="p">,</span> <span class="s2">&quot;weaned immature&quot;</span><span class="p">),</span> <span class="p">)</span>

<span class="n">MATURITY_CHOICES</span> <span class="o">=</span> <span class="p">((</span><span class="n">NA_VALUE</span><span class="p">,</span> <span class="s2">&quot;unknown maturity&quot;</span><span class="p">),</span> <span class="p">)</span> <span class="o">+</span>\
    <span class="n">TURTLE_MATURITY_CHOICES</span> <span class="o">+</span> <span class="n">MAMMAL_MATURITY_CHOICES</span> <span class="o">+</span>\
    <span class="p">((</span><span class="s2">&quot;adult&quot;</span><span class="p">,</span> <span class="s2">&quot;adult&quot;</span><span class="p">),</span> <span class="p">)</span>

<span class="n">HEALTH_D1</span> <span class="o">=</span> <span class="s1">&#39;alive-then-died&#39;</span>
<span class="n">HEALTH_D2</span> <span class="o">=</span> <span class="s1">&#39;dead-edible&#39;</span>
<span class="n">HEALTH_D3</span> <span class="o">=</span> <span class="s1">&#39;dead-organs-intact&#39;</span>
<span class="n">HEALTH_D4</span> <span class="o">=</span> <span class="s1">&#39;dead-advanced&#39;</span>
<span class="n">HEALTH_D5</span> <span class="o">=</span> <span class="s1">&#39;dead-mummified&#39;</span>
<span class="n">HEALTH_D6</span> <span class="o">=</span> <span class="s1">&#39;dead-disarticulated&#39;</span>
<span class="n">DEATH_STAGES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">HEALTH_D1</span><span class="p">,</span> <span class="n">HEALTH_D2</span><span class="p">,</span> <span class="n">HEALTH_D3</span><span class="p">,</span> <span class="n">HEALTH_D4</span><span class="p">,</span> <span class="n">HEALTH_D5</span><span class="p">,</span> <span class="n">HEALTH_D6</span><span class="p">)</span>
<span class="n">HEALTH_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">NA_VALUE</span><span class="p">,</span> <span class="s2">&quot;unknown health&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;alive&#39;</span><span class="p">,</span> <span class="s1">&#39;alive, healthy&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;alive-injured&#39;</span><span class="p">,</span> <span class="s1">&#39;alive, injured&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">HEALTH_D1</span><span class="p">,</span> <span class="s1">&#39;D1 (alive, then died)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">HEALTH_D2</span><span class="p">,</span> <span class="s1">&#39;D2 (dead, fresh)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">HEALTH_D3</span><span class="p">,</span> <span class="s1">&#39;D3 (dead, organs intact)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">HEALTH_D4</span><span class="p">,</span> <span class="s1">&#39;D4 (dead, organs decomposed)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">HEALTH_D5</span><span class="p">,</span> <span class="s1">&#39;D5 (dead, mummified)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">HEALTH_D6</span><span class="p">,</span> <span class="s1">&#39;D6 (dead, disarticulated)&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># StrandNet: same as above</span>
<span class="c1"># some health status options are confused with management actions</span>
<span class="c1"># (disposal, rehab, euth), cause of death</span>
<span class="c1">#</span>
<span class="c1"># &lt;option value=&quot;16&quot;&gt;DA - Rescued after disorientation inland by artificial lighting&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;22&quot;&gt;DK - Killed for research&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;1&quot;&gt;DL - Alive and left to natural processes. Not rescued&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;23&quot;&gt;DU - Live but subsequently euthanased&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;2&quot;&gt;DZ - Alive and rescued&lt;/option&gt;&lt;/select&gt;</span>

<span class="n">CAUSE_OF_DEATH_CHOICES</span> <span class="o">=</span> <span class="n">NA</span> <span class="o">+</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;indeterminate-decomposed&quot;</span><span class="p">,</span> <span class="s2">&quot;Indeterminate due to decomposition&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;boat-strike&quot;</span><span class="p">,</span> <span class="s2">&quot;Boat strike&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;trauma-human-induced&quot;</span><span class="p">,</span> <span class="s2">&quot;Human induced trauma&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;trauma-animal-induced&quot;</span><span class="p">,</span> <span class="s2">&quot;Animal induced trauma&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;drowned-entangled-fisheries&quot;</span><span class="p">,</span> <span class="s2">&quot;Drowned entangled in fisheries equipment&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;drowned-entangled-infrastructure&quot;</span><span class="p">,</span> <span class="s2">&quot;Drowned entangled in infrastructure&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;drowned-entangled-debris&quot;</span><span class="p">,</span> <span class="s2">&quot;Drowned entangled in debris&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;drowned-entangled&quot;</span><span class="p">,</span> <span class="s2">&quot;Drowned entangled&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;drowned-other&quot;</span><span class="p">,</span> <span class="s2">&quot;Drowned&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;fishery-bycatch&quot;</span><span class="p">,</span> <span class="s2">&quot;Fishery bycatch&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;handling-accident&quot;</span><span class="p">,</span> <span class="s2">&quot;Handling accident&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;car-collision&quot;</span><span class="p">,</span> <span class="s2">&quot;Car collision&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ingested-debris&quot;</span><span class="p">,</span> <span class="s2">&quot;Ingested debris&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;harvest&quot;</span><span class="p">,</span> <span class="s2">&quot;Harvested for human consumption&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;poisoned&quot;</span><span class="p">,</span> <span class="s2">&quot;Poisoned&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;misorientation&quot;</span><span class="p">,</span> <span class="s2">&quot;Misorientation on beach&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;natural&quot;</span><span class="p">,</span> <span class="s2">&quot;Natural death&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;birthing&quot;</span><span class="p">,</span> <span class="s2">&quot;Birthing complications&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;still-born&quot;</span><span class="p">,</span> <span class="s2">&quot;Still birth&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;calf-failure-to-thrive&quot;</span><span class="p">,</span> <span class="s2">&quot;Calf failed to thrive&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;starved&quot;</span><span class="p">,</span> <span class="s2">&quot;Starvation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;stranded&quot;</span><span class="p">,</span> <span class="s2">&quot;Stranding&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;euthanasia-firearm&quot;</span><span class="p">,</span> <span class="s2">&quot;Euthanasia by firearm&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;euthanasia-injection&quot;</span><span class="p">,</span> <span class="s2">&quot;Euthanasia by injection&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;euthanasia-implosion&quot;</span><span class="p">,</span> <span class="s2">&quot;Euthanasia by implosion&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;euthanasia&quot;</span><span class="p">,</span> <span class="s2">&quot;Euthanasia&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;predation&quot;</span><span class="p">,</span> <span class="s2">&quot;Predation&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">CONFIDENCE_CHOICES</span> <span class="o">=</span> <span class="n">NA</span> <span class="o">+</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;guess&quot;</span><span class="p">,</span> <span class="s2">&quot;Guess based on insuffient evidence&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;expert-opinion&quot;</span><span class="p">,</span> <span class="s2">&quot;Expert opinion based on available evidence&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;validated&quot;</span><span class="p">,</span> <span class="s2">&quot;Validated by authoritative source&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">NESTING_ACTIVITY_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;arriving&quot;</span><span class="p">,</span> <span class="s2">&quot;arriving on beach&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;approaching&quot;</span><span class="p">,</span> <span class="s2">&quot;approaching nesting site&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;digging-body-pit&quot;</span><span class="p">,</span> <span class="s2">&quot;digging body pit&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;excavating-egg-chamber&quot;</span><span class="p">,</span> <span class="s2">&quot;excavating egg chamber&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;laying-eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;laying eggs&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;filling-in-egg-chamber&quot;</span><span class="p">,</span> <span class="s2">&quot;filling in egg chamber&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;filling-in-nest&quot;</span><span class="p">,</span> <span class="s2">&quot;filling in nest&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;camouflaging-nest&quot;</span><span class="p">,</span> <span class="s2">&quot;camouflaging nest&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;returning-to-water&quot;</span><span class="p">,</span> <span class="s2">&quot;returning to water&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;general-breeding-activity&quot;</span><span class="p">,</span> <span class="s2">&quot;general breeding activity&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">STRANDING_ACTIVITY_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;floating&quot;</span><span class="p">,</span> <span class="s2">&quot;floating (dead, sick, unable to dive, drifting in water)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;beach-washed&quot;</span><span class="p">,</span> <span class="s2">&quot;beach washed (dead, sick or stranded on beach/coast)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;beach-jumped&quot;</span><span class="p">,</span> <span class="s2">&quot;beach jumped&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;carcass-tagged-released&quot;</span><span class="p">,</span> <span class="s2">&quot;carcass tagged and released&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;carcass-inland&quot;</span><span class="p">,</span> <span class="s2">&quot;carcass or butchered remains found removed from coast&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;captivity&quot;</span><span class="p">,</span> <span class="s2">&quot;in captivity&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;non-breeding&quot;</span><span class="p">,</span> <span class="s2">&quot;general non-breeding activity (swimming, sleeping, feeding, etc.)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;other&quot;</span><span class="p">,</span> <span class="s2">&quot;other activity&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">ACTIVITY_CHOICES</span> <span class="o">=</span> <span class="n">NA</span> <span class="o">+</span> <span class="n">NESTING_ACTIVITY_CHOICES</span> <span class="o">+</span> <span class="n">STRANDING_ACTIVITY_CHOICES</span>
<span class="c1"># primary activity</span>
<span class="c1"># &lt;option value=&quot;20&quot;&gt;? - Unspecified&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;1&quot;&gt;B - B - to be determined)&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;2&quot;&gt;B? - B? - to be determined)&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;3&quot;&gt;BE - BE - to be determined&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;4&quot;&gt;BF - Floating (dead, sick, unable to dive, drifting in water)&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;5&quot;&gt;BJ - Beach Jumped&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;7&quot;&gt;BR - Carcass or butchered remains found removed from coast&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;6&quot;&gt;BW - Beach washed (dead, sick or stranded on beach/coast)&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;8&quot;&gt;C - Courting&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;21&quot;&gt;CT - Carcass tagged and released to test stranding recovery and water currents.&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;9&quot;&gt;J - In captivity&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;10&quot;&gt;N - Nesting and internesting&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;11&quot;&gt;P - Predated (killed)&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;12&quot;&gt;PC - Predated by crocodile (killed)&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;13&quot;&gt;PD - Predated by dog or dingo (killed)&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;14&quot;&gt;PF - Predated by fish (killed)&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;15&quot;&gt;PR - Predated by raptor (killed)&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;16&quot;&gt;PS - Predated by shark (killed)&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;17&quot;&gt;R - Released&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;18&quot;&gt;S - General non-breeding activity (swimming, sleeping, feeding, ...)&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;19&quot;&gt;Z - Tag found not attached to animal&lt;/option&gt;&lt;/select&gt;</span>
<span class="c1"># # secondary activity</span>
<span class="c1"># &lt;option value=&quot;30&quot;&gt;? - ? - to be determined&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;2&quot;&gt;BJ - Non-Nesting: Beach jumped&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;3&quot;&gt;BW - Non-Nesting: Beach washed&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;75&quot;&gt;CT - Carcass tagged and released to test stranding recovery and water currents.&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;31&quot;&gt;F? - F? - to be determined&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;10&quot;&gt;FC - Fisheries: Fishing - captured in arrowhead fish trap&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;11&quot;&gt;FD - Fisheries: Sucked/picked up by dredge&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;36&quot;&gt;FG - Fisheries: Captured with gaff from boat&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;35&quot;&gt;FI - Fisheries: Crabbing - trapped inside a crab pot&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;12&quot;&gt;FL - Fisheries: Fishing - hooked by fishing line; included SCP shark-hooks&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;13&quot;&gt;FN - Fisheries: Fishing - captured by netting&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;14&quot;&gt;FP - Fisheries: Tangled in float-line to crab-pot, anchor line, trace to shark-hook, etc&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;15&quot;&gt;FS - Fisheries: Fishing - speared, or captured by a diver attaching a line to the animal&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;16&quot;&gt;FT - Fisheries: Fishing - trawling&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;17&quot;&gt;FZ - Fisheries: Trapped in ghost-net&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;32&quot;&gt;L - L - to be determined&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;56&quot;&gt;NJ - Non-Nesting: Rodeo - night time&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;55&quot;&gt;NS - Non-Nesting: SCUBA/snorkelling - night time&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;6&quot;&gt;P - Non-Nesting: Observed but not captured&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;57&quot;&gt;PA - Non-Nesting: Observation from aerial survey&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;58&quot;&gt;PI - Non-Nesting: Image recorded during underwater video monitoring&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;4&quot;&gt;RJ - Non-Nesting: Rodeo - day time&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;5&quot;&gt;S - Non-Nesting: SCUBA/snorkelling - day time&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;33&quot;&gt;T - T - to be determined&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;20&quot;&gt;TA - Trapped: Trapped by land reclaimation&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;21&quot;&gt;TE - Trapped: Trapped in electricity power plant water intake system&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;59&quot;&gt;TS - Non-Nesting: Located by satellite telemetry&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;22&quot;&gt;TT - Trapped: Trapped in creek at low tide&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;34&quot;&gt;X - X - to be determined&lt;/option&gt;</span>
<span class="c1"># &lt;option value=&quot;1&quot;&gt;X* - Nesting: Laid&lt;/option&gt;&lt;/select&gt;</span>

<span class="n">BEACH_POSITION_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">NA_VALUE</span><span class="p">,</span> <span class="s2">&quot;unknown habitat&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;beach-below-high-water&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;(B) beach below high water mark&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;beach-above-high-water&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;(A) beach above high water mark and dune&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;beach-edge-of-vegetation&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;(E) edge of vegetation&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;in-dune-vegetation&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;(V) inside vegetation&quot;</span><span class="p">)),</span> <span class="p">)</span>

<span class="n">HABITAT_CHOICES</span> <span class="o">=</span> <span class="n">BEACH_POSITION_CHOICES</span> <span class="o">+</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;beach&quot;</span><span class="p">,</span> <span class="s2">&quot;beach (below vegetation line)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;bays-estuaries&quot;</span><span class="p">,</span> <span class="s2">&quot;bays, estuaries and other enclosed shallow soft sediments&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;dune&quot;</span><span class="p">,</span> <span class="s2">&quot;dune&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;dune-constructed-hard-substrate&quot;</span><span class="p">,</span> <span class="s2">&quot;dune, constructed hard substrate (concrete slabs, timber floors, helipad)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;dune-grass-area&quot;</span><span class="p">,</span> <span class="s2">&quot;dune, grass area&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;dune-compacted-path&quot;</span><span class="p">,</span> <span class="s2">&quot;dune, hard compacted areas (road ways, paths)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;dune-rubble&quot;</span><span class="p">,</span> <span class="s2">&quot;dune, rubble, usually coral&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;dune-bare-sand&quot;</span><span class="p">,</span> <span class="s2">&quot;dune, bare sand area&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;dune-beneath-vegetation&quot;</span><span class="p">,</span> <span class="s2">&quot;dune, beneath tree or shrub&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;slope-front-dune&quot;</span><span class="p">,</span> <span class="s2">&quot;dune, front slope&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;sand-flats&quot;</span><span class="p">,</span> <span class="s2">&quot;sand flats&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;slope-grass&quot;</span><span class="p">,</span> <span class="s2">&quot;slope, grass area&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;slope-bare-sand&quot;</span><span class="p">,</span> <span class="s2">&quot;slope, bare sand area&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;slope-beneath-vegetation&quot;</span><span class="p">,</span> <span class="s2">&quot;slope, beneath tree or shrub&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;below-mean-spring-high-water-mark&quot;</span><span class="p">,</span>
        <span class="s2">&quot;below the mean spring high water line or current level of inundation (old db value)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;below-mshwm&quot;</span><span class="p">,</span> <span class="s2">&quot;below the mean spring high water line or current level of inundation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;lagoon-patch-reef&quot;</span><span class="p">,</span> <span class="s2">&quot;lagoon, patch reef&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;lagoon-open-sand&quot;</span><span class="p">,</span> <span class="s2">&quot;lagoon, open sand areas&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;mangroves&quot;</span><span class="p">,</span> <span class="s2">&quot;mangroves&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;reef-coral&quot;</span><span class="p">,</span> <span class="s2">&quot;coral reef&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;reef-crest-front-slope&quot;</span><span class="p">,</span> <span class="s2">&quot;reef crest (dries at low water) and front reef slope areas&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;reef-flat&quot;</span><span class="p">,</span> <span class="s2">&quot;reef flat, dries at low tide&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;reef-seagrass-flats&quot;</span><span class="p">,</span> <span class="s2">&quot;coral reef with seagrass flats&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;reef-rocky&quot;</span><span class="p">,</span> <span class="s2">&quot;rocky reef&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;open-water&quot;</span><span class="p">,</span> <span class="s2">&quot;open water&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;harbour&quot;</span><span class="p">,</span> <span class="s2">&quot;harbour&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;boat-ramp&quot;</span><span class="p">,</span> <span class="s2">&quot;boat ramp&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">HABITAT_WATER</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;lagoon-patch-reef&quot;</span><span class="p">,</span> <span class="s2">&quot;lagoon-open-sand&quot;</span><span class="p">,</span> <span class="s2">&quot;mangroves&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;reef-coral&quot;</span><span class="p">,</span> <span class="s2">&quot;reef-crest-front-slope&quot;</span><span class="p">,</span> <span class="s2">&quot;reef-flat&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;reef-seagrass-flats&quot;</span><span class="p">,</span> <span class="s2">&quot;reef-rocky&quot;</span><span class="p">,</span> <span class="s2">&quot;open-water&quot;</span><span class="p">,</span> <span class="s2">&quot;harbour&quot;</span><span class="p">)</span>

<span class="n">NEST_AGE_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
<span class="n">NEST_AGE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;old&quot;</span><span class="p">,</span> <span class="s2">&quot;(O) old, made before last night&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;fresh&quot;</span><span class="p">,</span> <span class="s2">&quot;(F) fresh, made last night&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">NEST_AGE_DEFAULT</span><span class="p">,</span> <span class="s2">&quot;(U) unknown age&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;missed&quot;</span><span class="p">,</span> <span class="s2">&quot;(M) missed turtle, made within past hours&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">NEST_TYPE_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;track-not-assessed&quot;</span>
<span class="n">NEST_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;track-not-assessed&quot;</span><span class="p">,</span> <span class="s2">&quot;track, not checked for nest&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;false-crawl&quot;</span><span class="p">,</span> <span class="s2">&quot;track without nest&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;successful-crawl&quot;</span><span class="p">,</span> <span class="s2">&quot;track with nest&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;track-unsure&quot;</span><span class="p">,</span> <span class="s2">&quot;track, checked for nest, unsure if nest&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;nest&quot;</span><span class="p">,</span> <span class="s2">&quot;nest, unhatched, no track&quot;</span><span class="p">),</span>         <span class="c1"># egg counts, putting eggs back</span>
    <span class="p">(</span><span class="s2">&quot;hatched-nest&quot;</span><span class="p">,</span> <span class="s2">&quot;nest, hatched&quot;</span><span class="p">),</span>   <span class="c1"># hatching and emergence success</span>
    <span class="p">(</span><span class="s2">&quot;body-pit&quot;</span><span class="p">,</span> <span class="s2">&quot;body pit, no track&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">OBSERVATION_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">NA_VALUE</span><span class="p">,</span> <span class="s2">&quot;NA&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;absent&quot;</span><span class="p">,</span> <span class="s2">&quot;Confirmed absent&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;present&quot;</span><span class="p">,</span> <span class="s2">&quot;Confirmed present&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">OBSERVATION_ICONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">NA_VALUE</span><span class="p">:</span> <span class="s2">&quot;fa fa-question-circle-o&quot;</span><span class="p">,</span>
    <span class="s2">&quot;absent&quot;</span><span class="p">:</span> <span class="s2">&quot;fa fa-times&quot;</span><span class="p">,</span>
    <span class="s2">&quot;present&quot;</span><span class="p">:</span> <span class="s2">&quot;fa fa-check&quot;</span><span class="p">}</span>

<span class="n">OBSERVATION_COLOURS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">NA_VALUE</span><span class="p">:</span> <span class="s2">&quot;secondary&quot;</span><span class="p">,</span>
    <span class="s2">&quot;absent&quot;</span><span class="p">:</span> <span class="s2">&quot;dark&quot;</span><span class="p">,</span>
    <span class="s2">&quot;present&quot;</span><span class="p">:</span> <span class="s2">&quot;primary&quot;</span><span class="p">,</span>
    <span class="s2">&quot;yes&quot;</span><span class="p">:</span> <span class="s2">&quot;primary&quot;</span><span class="p">,</span>
    <span class="s2">&quot;no&quot;</span><span class="p">:</span> <span class="s2">&quot;dark&quot;</span><span class="p">,</span>
    <span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;dark&quot;</span><span class="p">,</span>
    <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;primary&quot;</span><span class="p">,</span>
    <span class="s2">&quot;False&quot;</span><span class="p">:</span> <span class="s2">&quot;dark&quot;</span><span class="p">,</span>
    <span class="s2">&quot;True&quot;</span><span class="p">:</span> <span class="s2">&quot;primary&quot;</span>
    <span class="p">}</span>

<span class="n">PHOTO_CHOICES</span> <span class="o">=</span> <span class="n">NA</span> <span class="o">+</span> <span class="p">((</span><span class="s2">&quot;see photos&quot;</span><span class="p">,</span> <span class="s2">&quot;See attached photos for details&quot;</span><span class="p">),)</span>

<span class="n">PHOTO_ICONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">NA_VALUE</span><span class="p">:</span> <span class="s2">&quot;fa fa-question-circle-o&quot;</span><span class="p">,</span>
    <span class="s2">&quot;see photos&quot;</span><span class="p">:</span> <span class="s2">&quot;fa fa-check&quot;</span><span class="p">}</span>

<span class="n">ACCURACY_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;To nearest 1 mm&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;To nearest 5 mm&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;To nearest 1 cm&quot;</span><span class="p">),</span>              <span class="c1"># Default for stranding &quot;measured&quot;</span>
    <span class="p">(</span><span class="s2">&quot;100&quot;</span><span class="p">,</span> <span class="s2">&quot;To nearest 10 cm&quot;</span><span class="p">),</span>            <span class="c1"># Default for stranding &quot;estimated&quot;</span>
    <span class="p">(</span><span class="s2">&quot;1000&quot;</span><span class="p">,</span> <span class="s2">&quot;To nearest 1 m or 1 kg&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;5000&quot;</span><span class="p">,</span> <span class="s2">&quot;To nearest 5 m or 5 kg&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;10000&quot;</span><span class="p">,</span> <span class="s2">&quot;To nearest 10 m or 10 kg&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">DAMAGE_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># Amputations</span>
    <span class="p">(</span><span class="s2">&quot;tip-amputated&quot;</span><span class="p">,</span> <span class="s2">&quot;tip amputation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;amputated-from-nail&quot;</span><span class="p">,</span> <span class="s2">&quot;amputation from nail&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;amputated-half&quot;</span><span class="p">,</span> <span class="s2">&quot;half amputation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;amputated-entirely&quot;</span><span class="p">,</span> <span class="s2">&quot;entire amputation&quot;</span><span class="p">),</span>

    <span class="c1"># Epiphytes and gross things</span>
    <span class="p">(</span><span class="s2">&quot;barnacles&quot;</span><span class="p">,</span> <span class="s2">&quot;barnacles&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;algal-growth&quot;</span><span class="p">,</span> <span class="s2">&quot;algal growth&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;tumor&quot;</span><span class="p">,</span> <span class="s2">&quot;tumor&quot;</span><span class="p">),</span>

    <span class="c1"># Tags</span>
    <span class="p">(</span><span class="s2">&quot;tag-scar&quot;</span><span class="p">,</span> <span class="s2">&quot;tag scar&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;tag-seen&quot;</span><span class="p">,</span> <span class="s2">&quot;tag seen but not identified&quot;</span><span class="p">),</span>

    <span class="c1"># Injuries</span>
    <span class="p">(</span><span class="s2">&quot;cuts&quot;</span><span class="p">,</span> <span class="s2">&quot;cuts&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;boat-strike&quot;</span><span class="p">,</span> <span class="s2">&quot;boat or propeller strike&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;entanglement&quot;</span><span class="p">,</span> <span class="s2">&quot;entanglement&quot;</span><span class="p">),</span>

    <span class="c1"># Morphologic aberrations</span>
    <span class="p">(</span><span class="s2">&quot;deformity&quot;</span><span class="p">,</span> <span class="s2">&quot;deformity&quot;</span><span class="p">),</span>

    <span class="c1"># Catch-all</span>
    <span class="p">(</span><span class="s2">&quot;other&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">),</span> <span class="p">)</span>

<span class="n">DAMAGE_AGE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;healed-entirely&quot;</span><span class="p">,</span> <span class="s2">&quot;entirely healed&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;healed-partially&quot;</span><span class="p">,</span> <span class="s2">&quot;partially healed&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;fresh&quot;</span><span class="p">,</span> <span class="s2">&quot;fresh&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">NEST_DAMAGE_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;turtle&quot;</span>
<span class="n">NEST_DAMAGE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">NEST_DAMAGE_DEFAULT</span><span class="p">,</span> <span class="s2">&quot;(A)nother turtle&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;bandicoot&quot;</span><span class="p">,</span> <span class="s2">&quot;(Ba)ndicoot predation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;bird&quot;</span><span class="p">,</span> <span class="s2">&quot;(Bi)rd predation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;crab&quot;</span><span class="p">,</span> <span class="s2">&quot;(Cr)ab predation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;croc&quot;</span><span class="p">,</span> <span class="s2">&quot;(Cr)oc predation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;cyclone&quot;</span><span class="p">,</span> <span class="s2">&quot;(Cy)clone disturbance&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;dingo&quot;</span><span class="p">,</span> <span class="s2">&quot;(Di)ngo predation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;dog&quot;</span><span class="p">,</span> <span class="s2">&quot;(Do)g predation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;fox&quot;</span><span class="p">,</span> <span class="s2">&quot;(F)ox predation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;goanna&quot;</span><span class="p">,</span> <span class="s2">&quot;(G)oanna predation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;human&quot;</span><span class="p">,</span> <span class="s2">&quot;(Hu)man&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;pig&quot;</span><span class="p">,</span> <span class="s2">&quot;(P)ig predation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;tide&quot;</span><span class="p">,</span> <span class="s2">&quot;(Ti)dal disturbance&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;vehicle&quot;</span><span class="p">,</span> <span class="s2">&quot;(V)ehicle damage&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;(U)nknown&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;other&quot;</span><span class="p">,</span> <span class="s2">&quot;(O)ther identifiable (see comments)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;Training or test record&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">TIME_ESTIMATE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">NA_VALUE</span><span class="p">,</span> <span class="s2">&quot;NA&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;same-night&quot;</span><span class="p">,</span> <span class="s2">&quot;Sometime that night&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;plusminus-2h&quot;</span><span class="p">,</span> <span class="s2">&quot;Plusminus 2h of estimate&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;plusminus-30m&quot;</span><span class="p">,</span> <span class="s2">&quot;Correct to the hour&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1"># End lookups ----------------------------------------------------------------#</span>


<div class="viewcode-block" id="encounter_media"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.encounter_media">[docs]</a><span class="k">def</span> <span class="nf">encounter_media</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an upload file path for an encounter media attachment.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="s1">&#39;encounter/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">source_id</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="expedition_media"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.expedition_media">[docs]</a><span class="k">def</span> <span class="nf">expedition_media</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an upload file path for an expedition media attachment.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="o">.</span><span class="n">expedition</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">expedition</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="s1">&#39;expedition/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">expedition</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="survey_media"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.survey_media">[docs]</a><span class="k">def</span> <span class="nf">survey_media</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an upload path for survey media.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="s1">&#39;survey/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></div>


<span class="c1"># Spatial models -------------------------------------------------------------#</span>
<div class="viewcode-block" id="Area"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Area">[docs]</a><span class="k">class</span> <span class="nc">Area</span><span class="p">(</span><span class="n">geo_models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An area with a polygonal extent.</span>

<span class="sd">    This model accommodates anything with a polygonal extent, providing:</span>

<span class="sd">    * Area type (to classify different kinds of areas)</span>
<span class="sd">    * Area name must be unique within area type</span>
<span class="sd">    * Polygonal extent of the area</span>

<span class="sd">    Some additional fields are populated behind the scenes at each save and</span>
<span class="sd">    serve to cache low churn, high use content:</span>

<span class="sd">    * centroid: useful for spatial analysis and location queries</span>
<span class="sd">    * northern extent: useful to sort by latitude</span>
<span class="sd">    * as html: an HTML map popup</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">AREATYPE_MPA</span> <span class="o">=</span> <span class="s1">&#39;MPA&#39;</span>
    <span class="n">AREATYPE_LOCALITY</span> <span class="o">=</span> <span class="s1">&#39;Locality&#39;</span>
    <span class="n">AREATYPE_SITE</span> <span class="o">=</span> <span class="s1">&#39;Site&#39;</span>
    <span class="n">AREATYPE_DBCA_REGION</span> <span class="o">=</span> <span class="s1">&#39;Region&#39;</span>
    <span class="n">AREATYPE_DBCA_DISTRICT</span> <span class="o">=</span> <span class="s1">&#39;District&#39;</span>

    <span class="n">AREATYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">AREATYPE_MPA</span><span class="p">,</span> <span class="s2">&quot;MPA&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">AREATYPE_LOCALITY</span><span class="p">,</span> <span class="s2">&quot;Locality&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">AREATYPE_SITE</span><span class="p">,</span> <span class="s2">&quot;Site&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">AREATYPE_DBCA_REGION</span><span class="p">,</span> <span class="s2">&quot;DBCA Region&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">AREATYPE_DBCA_DISTRICT</span><span class="p">,</span> <span class="s2">&quot;DBCA District&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">area_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Area type&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">AREATYPE_SITE</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">AREATYPE_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The area type.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Area Name&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The name of the area.&quot;</span><span class="p">),)</span>

    <span class="n">centroid</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">PointField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Centroid&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The centroid is a simplified presentation of the Area.&quot;</span><span class="p">))</span>

    <span class="n">northern_extent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Northernmost latitude&quot;</span><span class="p">),</span>
        <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The northernmost latitude serves to sort areas.&quot;</span><span class="p">),)</span>

    <span class="n">length_surveyed_m</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span>
        <span class="n">max_digits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Surveyed length [m]&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The length of meters covered by a survey of this area. &quot;</span>
                    <span class="s2">&quot;E.g., the meters of high water mark along a beach.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">length_survey_roundtrip_m</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span>
        <span class="n">max_digits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Survey roundtrip [m]&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The total length of meters walked during an end to end &quot;</span>
                    <span class="s2">&quot;survey of this area.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">as_html</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;HTML representation&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The cached HTML representation for display purposes.&quot;</span><span class="p">),)</span>

    <span class="n">geom</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">PolygonField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Location&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The exact extent of the area as polygon in WGS84.&quot;</span><span class="p">))</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class options.&quot;&quot;&quot;</span>

        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-northern_extent&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;area_type&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Area&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Areas&quot;</span>

<div class="viewcode-block" id="Area.save"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Area.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cache centroid and northern extent.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">as_html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_popup</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">northern_extent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">northern_extent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_northern_extent</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centroid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_centroid</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Area</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">derived_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The centroid, derived from the polygon.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">centroid</span> <span class="ow">or</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">derived_northern_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The northern extent, derived from the polygon.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">or</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate HTML popup content.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;popup/</span><span class="si">{0}</span><span class="s2">.html&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">original</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">leaflet_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A title for leaflet map markers.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">absolute_admin_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the absolute admin change URL.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;admin:</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">_change&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_encounters_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;All Encounters within this Area.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;/admin/observations/encounter/?</span><span class="si">{0}</span><span class="s1">__id__exact=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;site&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_type</span> <span class="o">==</span> <span class="n">Area</span><span class="o">.</span><span class="n">AREATYPE_SITE</span> <span class="k">else</span> <span class="s2">&quot;area&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">animal_encounters_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The admin URL for AnimalEncounters within this Area.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;/admin/observations/animalencounter/?</span><span class="si">{0}</span><span class="s1">__id__exact=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;site&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_type</span> <span class="o">==</span> <span class="n">Area</span><span class="o">.</span><span class="n">AREATYPE_SITE</span> <span class="k">else</span> <span class="s2">&quot;area&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Area.make_rest_listurl"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Area.make_rest_listurl">[docs]</a>    <span class="k">def</span> <span class="nf">make_rest_listurl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the API list URL in given format (default: JSON).</span>

<span class="sd">        Permissible formats depend on configured renderers:</span>
<span class="sd">        api (human readable HTML), csv, json, jsonp, yaml, latex (PDF).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">rest_reverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span> <span class="o">+</span> <span class="s1">&#39;-list&#39;</span><span class="p">,</span>
                            <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">format</span><span class="p">})</span></div>

<div class="viewcode-block" id="Area.make_rest_detailurl"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Area.make_rest_detailurl">[docs]</a>    <span class="k">def</span> <span class="nf">make_rest_detailurl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the API detail URL in given format (default: JSON).</span>

<span class="sd">        Permissible formats depend on configured renderers:</span>
<span class="sd">        api (human readable HTML), csv, json, jsonp, yaml, latex (PDF).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">rest_reverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span> <span class="o">+</span> <span class="s1">&#39;-detail&#39;</span><span class="p">,</span>
                            <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pk&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">format</span><span class="p">})</span></div></div>


<div class="viewcode-block" id="SiteVisitStartEnd"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.SiteVisitStartEnd">[docs]</a><span class="k">class</span> <span class="nc">SiteVisitStartEnd</span><span class="p">(</span><span class="n">geo_models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A start or end point to a site visit.&quot;&quot;&quot;</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Data Source&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">SOURCE_DEFAULT</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">SOURCE_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Where was this record captured initially?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">source_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Source ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of the record in the original source, or &quot;</span>
                    <span class="s2">&quot;a newly allocated ID if left blank. Delete and save &quot;</span>
                    <span class="s2">&quot;to regenerate this ID.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">datetime</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Observation time&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Local time (no daylight savings), stored as UTC.&quot;</span><span class="p">))</span>

    <span class="n">location</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">PointField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Location&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The observation location as point in WGS84&quot;</span><span class="p">))</span>

    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">((</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">)),</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;start&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Start of end of site visit?&quot;</span><span class="p">),)</span>

    <span class="c1"># media attachment</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Site visit start or end on </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span></div>


<div class="viewcode-block" id="Expedition"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Expedition">[docs]</a><span class="k">class</span> <span class="nc">Expedition</span><span class="p">(</span><span class="n">PolymorphicModel</span><span class="p">,</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An endeavour of a team to a location within a defined time range.&quot;&quot;&quot;</span>

    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Area</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Surveyed area&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The entire surveyed area.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">started_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Site entered on&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The datetime of entering the site, shown as local time &quot;</span>
                    <span class="s2">&quot;(no daylight savings), stored as UTC.&quot;</span><span class="p">))</span>

    <span class="n">finished_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Site left on&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The datetime of leaving the site, shown as local time &quot;</span>
                    <span class="s2">&quot;(no daylight savings), stored as UTC.&quot;</span><span class="p">))</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Describe any circumstances affecting data collection, &quot;</span>
                    <span class="s2">&quot;e.g. days without surveys.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">team</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;expedition_team&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Expedition </span><span class="si">{0}</span><span class="s2"> to </span><span class="si">{1}</span><span class="s2"> from </span><span class="si">{2}</span><span class="s2"> to </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s2">&quot;unknown site&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;na&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">started_on</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">started_on</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">&quot;na&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">finished_on</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">finished_on</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">site_visits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a QuerySet of site visits.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SiteVisit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">site__geom__contained</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span>
            <span class="n">started_on__gte</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">started_on</span><span class="p">,</span>
            <span class="n">finished_on__lte</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">finished_on</span><span class="p">)</span></div>


<div class="viewcode-block" id="SiteVisit"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.SiteVisit">[docs]</a><span class="k">class</span> <span class="nc">SiteVisit</span><span class="p">(</span><span class="n">Expedition</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A visit to one site by a team of field workers collecting data.&quot;&quot;&quot;</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Data Source&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">SOURCE_DEFAULT</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">SOURCE_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Where was this record captured initially?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">source_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Source ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of the start point in the original source, or &quot;</span>
                    <span class="s2">&quot;a newly allocated ID if left blank. Delete and save &quot;</span>
                    <span class="s2">&quot;to regenerate this ID.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">end_source_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Source ID of end point&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of the record in the original source, or &quot;</span>
                    <span class="s2">&quot;a newly allocated ID if left blank. Delete and save &quot;</span>
                    <span class="s2">&quot;to regenerate this ID.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">start_location</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">PointField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Start location&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The start location as point in WGS84&quot;</span><span class="p">))</span>

    <span class="n">end_location</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">PointField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;End location&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The end location as point in WGS84&quot;</span><span class="p">))</span>

    <span class="n">transect</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">LineStringField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Transect line&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The surveyed path as LineString in WGS84, optional.&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Site Visit </span><span class="si">{0}</span><span class="s2"> of </span><span class="si">{1}</span><span class="s2"> from </span><span class="si">{2}</span><span class="s2"> to </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s2">&quot;unknown site&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;na&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">started_on</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">started_on</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">&quot;na&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">finished_on</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">finished_on</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">encounters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the QuerySet of all Encounters within this SiteVisit.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">where__contained</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span>
            <span class="n">when__gte</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">started_on</span><span class="p">,</span>
            <span class="n">when__lte</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">finished_on</span><span class="p">)</span>

<div class="viewcode-block" id="SiteVisit.claim_encounters"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.SiteVisit.claim_encounters">[docs]</a>    <span class="k">def</span> <span class="nf">claim_encounters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update Encounters within this SiteVisit with reference to self.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encounters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">site_visit</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="SiteVisit.claim_end_points"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.SiteVisit.claim_end_points">[docs]</a>    <span class="k">def</span> <span class="nf">claim_end_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO Claim SiteVisitEnd.&quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="FieldMediaAttachment"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.FieldMediaAttachment">[docs]</a><span class="k">class</span> <span class="nc">FieldMediaAttachment</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A media attachment to an Expedition or Survey.&quot;&quot;&quot;</span>

    <span class="n">MEDIA_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;data_sheet&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Data sheet&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;journal&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Field journal&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;communication&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Communication record&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;photograph&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Photograph&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Other&#39;</span><span class="p">)),</span> <span class="p">)</span>

    <span class="n">expedition</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Expedition</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Expedition&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Surveys can be conducted during an expedition.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">media_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Attachment type&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">MEDIA_TYPE_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;photograph&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;What is the attached file about?&quot;</span><span class="p">),)</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Attachment name&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Give the attachment a representative name&quot;</span><span class="p">),)</span>

    <span class="n">attachment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span>
        <span class="n">upload_to</span><span class="o">=</span><span class="n">expedition_media</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;File attachment&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Upload the file&quot;</span><span class="p">),)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Attachment </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> for </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expedition</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Path to file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">force_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attachment</span><span class="o">.</span><span class="n">file</span><span class="p">)</span></div>


<div class="viewcode-block" id="Survey"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Survey">[docs]</a><span class="k">class</span> <span class="nc">Survey</span><span class="p">(</span><span class="n">QualityControlMixin</span><span class="p">,</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A visit to one site by a team of field workers collecting data.&quot;&quot;&quot;</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Data Source&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">SOURCE_DEFAULT</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">SOURCE_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Where was this record captured initially?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">source_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Source ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of the start point in the original source.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">device_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Device ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of the recording device, if available.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Area</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Surveyed site&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The surveyed site, if known.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">transect</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">LineStringField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Transect line&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span>
            <span class="s2">&quot;The surveyed path as LineString in WGS84, optional.&quot;</span>
            <span class="s2">&quot; E.g. automatically captured by form Track Tally.&quot;</span><span class="p">))</span>

    <span class="n">reporter</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_DEFAULT</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">TSC_ADMIN_USER</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Recorded by&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span>
            <span class="s2">&quot;The person who captured the start point, &quot;</span>
            <span class="s2">&quot;ideally this person also recoreded the encounters and end point.&quot;</span><span class="p">))</span>

    <span class="n">start_location</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">PointField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Survey start point&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The start location as point in WGS84.&quot;</span><span class="p">))</span>

    <span class="n">start_location_accuracy_m</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Start location accuracy (m)&quot;</span><span class="p">),</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The accuracy of the supplied start location in metres, if given.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Survey start time&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The datetime of entering the site, shown as local time &quot;</span>
                    <span class="s2">&quot;(no daylight savings), stored as UTC.&quot;</span>
                    <span class="s2">&quot; The time of &#39;feet in the sand, start recording encounters&#39;.&quot;</span><span class="p">))</span>

    <span class="n">start_photo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span>
        <span class="n">upload_to</span><span class="o">=</span><span class="n">survey_media</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Site photo start&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Site conditions at start of survey.&quot;</span><span class="p">),)</span>

    <span class="n">start_comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments at start&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Describe any circumstances affecting data collection, &quot;</span>
                    <span class="s2">&quot;e.g. days without surveys.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">end_source_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Source ID of end point&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of the record in the original source.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">end_device_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;End Device ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of the recording device which captured the end point, if available.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">end_location</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">PointField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Survey end point&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The end location as point in WGS84.&quot;</span><span class="p">))</span>

    <span class="n">end_location_accuracy_m</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;End location accuracy (m)&quot;</span><span class="p">),</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The accuracy of the supplied end location in metres, if given.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">end_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Survey end time&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The datetime of leaving the site, shown as local time &quot;</span>
                    <span class="s2">&quot;(no daylight savings), stored as UTC.&quot;</span>
                    <span class="s2">&quot; The time of &#39;feet in the sand, done recording encounters.&#39;&quot;</span><span class="p">))</span>

    <span class="n">end_photo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span>
        <span class="n">upload_to</span><span class="o">=</span><span class="n">expedition_media</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Site photo end&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Site conditions at end of survey.&quot;</span><span class="p">),)</span>

    <span class="n">end_comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments at finish&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Describe any circumstances affecting data collection, &quot;</span>
                    <span class="s2">&quot;e.g. days without surveys.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">production</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Production run&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Whether the survey is a real (production) survey, or a training survey.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">team</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;survey_team&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span>
            <span class="s2">&quot;Additional field workers, apart from the reporter,&quot;</span>
            <span class="s2">&quot; who assisted with data collection.&quot;</span><span class="p">))</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Label&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A human-readable, self-explanatory label.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class options.&quot;&quot;&quot;</span>

        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;start_location&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time&quot;</span><span class="p">]</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="s2">&quot;source_id&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation is cached in field ``label`` and updated pre-save.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">make_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Survey </span><span class="si">{0}</span><span class="s2"> of </span><span class="si">{1}</span><span class="s2"> from </span><span class="si">{2}</span><span class="s2"> to </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s2">&quot;unknown site&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;na&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="o">.</span><span class="n">tzlocal</span><span class="p">())</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M %Z&quot;</span><span class="p">),</span>
            <span class="s2">&quot;na&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="o">.</span><span class="n">tzlocal</span><span class="p">())</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">absolute_admin_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the absolute admin change URL.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;admin:</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">_change&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>

<div class="viewcode-block" id="Survey.card_template"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Survey.card_template">[docs]</a>    <span class="k">def</span> <span class="nf">card_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;observations/survey_card.html&#39;</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">encounters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the QuerySet of all Encounters within this SiteVisit unless it&#39;s a training run.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">production</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[wastd.observations.models.survey.encounters] No end_time set, can&#39;t filter Encounters&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[wastd.observations.models.survey.encounters] No site set, can&#39;t filter Encounters&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">where__contained</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span>
                <span class="n">when__gte</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
                <span class="n">when__lte</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[Survey.encounters] </span><span class="si">{0}</span><span class="s2"> found </span><span class="si">{1}</span><span class="s2"> Encounters&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">e</span></div>


<div class="viewcode-block" id="guess_site"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.guess_site">[docs]</a><span class="k">def</span> <span class="nf">guess_site</span><span class="p">(</span><span class="n">survey_instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the first Area containing the start_location or None.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Area</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">area_type</span><span class="o">=</span><span class="n">Area</span><span class="o">.</span><span class="n">AREATYPE_SITE</span><span class="p">,</span>
        <span class="n">geom__contains</span><span class="o">=</span><span class="n">survey_instance</span><span class="o">.</span><span class="n">start_location</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></div>


<div class="viewcode-block" id="claim_end_points"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.claim_end_points">[docs]</a><span class="k">def</span> <span class="nf">claim_end_points</span><span class="p">(</span><span class="n">survey_instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Claim SurveyEnd.</span>

<span class="sd">    The first SurveyEnd with the matching site,</span>
<span class="sd">    and an end_time within six hours after start_time is used</span>
<span class="sd">    to set corresponding end_location, end_time, end_comments,</span>
<span class="sd">    end_photo and end_source_id.</span>

<span class="sd">    Since the end point could be taken with a different device (e.g.</span>
<span class="sd">    if primary device malfunctions), we will not filter down to</span>
<span class="sd">    the same device_id.</span>

<span class="sd">    If no SurveyEnd is found and no end_time is set, the end_time is set to</span>
<span class="sd">    start_time plus six hours. This should allow the survey to claim its Encounters.</span>

<span class="sd">    TODO we could be a bit cleverer and find the latest encounter on the same day and site.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">se</span> <span class="o">=</span> <span class="n">SurveyEnd</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">site</span><span class="o">=</span><span class="n">survey_instance</span><span class="o">.</span><span class="n">site</span><span class="p">,</span>
        <span class="c1"># device_id=survey_instance.device_id,</span>
        <span class="n">end_time__gte</span><span class="o">=</span><span class="n">survey_instance</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
        <span class="n">end_time__lte</span><span class="o">=</span><span class="n">survey_instance</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">se</span><span class="p">:</span>
        <span class="n">survey_instance</span><span class="o">.</span><span class="n">end_location</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">end_location</span>
        <span class="n">survey_instance</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">end_time</span>
        <span class="n">survey_instance</span><span class="o">.</span><span class="n">end_comments</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">end_comments</span>
        <span class="n">survey_instance</span><span class="o">.</span><span class="n">end_photo</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">end_photo</span>
        <span class="n">survey_instance</span><span class="o">.</span><span class="n">end_source_id</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">source_id</span>
        <span class="n">survey_instance</span><span class="o">.</span><span class="n">end_device_id</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">device_id</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">survey_instance</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
            <span class="n">survey_instance</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">survey_instance</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">survey_instance</span><span class="o">.</span><span class="n">end_comments</span> <span class="o">=</span> <span class="s2">&quot;[NEEDS QA][Missing SiteVisitEnd] Survey end guessed.&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[Survey.claim_end_points] Missing SiteVisitEnd for Survey&quot;</span>
                        <span class="s2">&quot; </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">survey_instance</span><span class="p">))</span></div>


<div class="viewcode-block" id="claim_encounters"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.claim_encounters">[docs]</a><span class="k">def</span> <span class="nf">claim_encounters</span><span class="p">(</span><span class="n">survey_instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update Encounters within this Survey to reference survey=self.&quot;&quot;&quot;</span>
    <span class="n">enc</span> <span class="o">=</span> <span class="n">survey_instance</span><span class="o">.</span><span class="n">encounters</span>
    <span class="k">if</span> <span class="n">enc</span><span class="p">:</span>
        <span class="n">enc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">survey</span><span class="o">=</span><span class="n">survey_instance</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[wastd.observations.models.claim_encounters] &quot;</span>
                    <span class="s2">&quot;Survey </span><span class="si">{0}</span><span class="s2"> claimed </span><span class="si">{1}</span><span class="s2"> Encounters&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">survey_instance</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">enc</span><span class="p">)))</span></div>


<div class="viewcode-block" id="survey_pre_save"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.survey_pre_save">[docs]</a><span class="nd">@receiver</span><span class="p">(</span><span class="n">pre_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">Survey</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">survey_pre_save</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">buffer_mins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">initial_duration_hrs</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Survey: Claim site, end point, adjust end time if encounters already claimed.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">dateparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">dateparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">Survey</span><span class="o">.</span><span class="n">STATUS_NEW</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">instance</span><span class="o">.</span><span class="n">site</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">guess_site</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">Survey</span><span class="o">.</span><span class="n">STATUS_NEW</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">instance</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
        <span class="n">claim_end_points</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">end_time</span> <span class="o">==</span> <span class="n">instance</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">initial_duration_hrs</span><span class="p">):</span>
        <span class="n">et</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">end_time</span>
        <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">encounters</span><span class="p">:</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">encounters</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">.</span><span class="n">when</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">buffer_mins</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;[survey_pre_save] End time adjusted from </span><span class="si">{0}</span><span class="s2"> to </span><span class="si">{1}</span><span class="s2">, &quot;</span>
                   <span class="s2">&quot;</span><span class="si">{2}</span><span class="s2"> minutes after last of </span><span class="si">{3}</span><span class="s2"> encounters.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">et</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span> <span class="n">buffer_mins</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">encounters</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">initial_duration_hrs</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;[survey_pre_save] End time adjusted from </span><span class="si">{0}</span><span class="s2"> to </span><span class="si">{1}</span><span class="s2">, &quot;</span>
                   <span class="s2">&quot;</span><span class="si">{2}</span><span class="s2"> hours after the start of the survey. &quot;</span>
                   <span class="s2">&quot;No encounters found.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">et</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span> <span class="n">initial_duration_hrs</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">end_comments</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">make_label</span></div>


<div class="viewcode-block" id="survey_post_save"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.survey_post_save">[docs]</a><span class="nd">@receiver</span><span class="p">(</span><span class="n">post_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">Survey</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">survey_post_save</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Survey: Claim encounters.&quot;&quot;&quot;</span>
    <span class="n">claim_encounters</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span></div>


<div class="viewcode-block" id="SurveyEnd"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.SurveyEnd">[docs]</a><span class="k">class</span> <span class="nc">SurveyEnd</span><span class="p">(</span><span class="n">geo_models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A visit to one site by a team of field workers collecting data.&quot;&quot;&quot;</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Data Source&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">SOURCE_DEFAULT</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">SOURCE_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Where was this record captured initially?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">source_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Source ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of the start point in the original source.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">device_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Device ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of the recording device, if available.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">reporter</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_DEFAULT</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">TSC_ADMIN_USER</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Recorded by&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span>
            <span class="s2">&quot;The person who captured the start point, &quot;</span>
            <span class="s2">&quot;ideally this person also recoreded the encounters and end point.&quot;</span><span class="p">))</span>

    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Area</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Surveyed site&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The surveyed site, if known.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">end_location</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">PointField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Survey end point&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The end location as point in WGS84.&quot;</span><span class="p">))</span>

    <span class="n">end_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Survey end time&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The datetime of leaving the site, shown as local time &quot;</span>
                    <span class="s2">&quot;(no daylight savings), stored as UTC.&quot;</span>
                    <span class="s2">&quot; The time of &#39;feet in the sand, done recording encounters.&#39;&quot;</span><span class="p">))</span>

    <span class="n">end_photo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span>
        <span class="n">upload_to</span><span class="o">=</span><span class="n">survey_media</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Site photo end&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Site conditions at end of survey.&quot;</span><span class="p">),)</span>

    <span class="n">end_comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments at finish&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Describe any circumstances affecting data collection, &quot;</span>
                    <span class="s2">&quot;e.g. days without surveys.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class options.&quot;&quot;&quot;</span>

        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;end_location&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time&quot;</span><span class="p">]</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="s2">&quot;source_id&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="SurveyEnd.save"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.SurveyEnd.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Guess site.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_site</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SurveyEnd</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;SurveyEnd </span><span class="si">{0}</span><span class="s2"> at </span><span class="si">{1}</span><span class="s2"> on </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s2">&quot;na&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="p">,</span>
            <span class="s2">&quot;na&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">guess_site</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the first Area containing the start_location or None.&quot;&quot;&quot;</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="n">Area</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">area_type</span><span class="o">=</span><span class="n">Area</span><span class="o">.</span><span class="n">AREATYPE_SITE</span><span class="p">,</span>
            <span class="n">geom__contains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_location</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">candidates</span> <span class="k">else</span> <span class="n">candidates</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></div>


<span class="c1"># Utilities ------------------------------------------------------------------#</span>
<div class="viewcode-block" id="delete_observations"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.delete_observations">[docs]</a><span class="nd">@receiver</span><span class="p">(</span><span class="n">pre_delete</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">delete_observations</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delete Observations before deleting an Encounter.</span>

<span class="sd">    See https://github.com/django-polymorphic/django-polymorphic/issues/34</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="n">Encounter</span><span class="p">:</span>
        <span class="p">[</span><span class="n">obs</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span> <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">observation_set</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span></div>


<span class="c1"># Encounter models -----------------------------------------------------------#</span>
<div class="viewcode-block" id="Encounter"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Encounter">[docs]</a><span class="k">class</span> <span class="nc">Encounter</span><span class="p">(</span><span class="n">PolymorphicModel</span><span class="p">,</span> <span class="n">QualityControlMixin</span><span class="p">,</span> <span class="n">UrlsMixin</span><span class="p">,</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The base Encounter class.</span>

<span class="sd">    * When: Datetime of encounter, stored in UTC, entered and displayed in local</span>
<span class="sd">      timezome.</span>
<span class="sd">    * Where: Point in WGS84.</span>
<span class="sd">    * Who: The observer has to be a registered system user.</span>
<span class="sd">    * Source: The previous point of truth for the record.</span>
<span class="sd">    * Source ID: The ID of the encounter at the previous point of truth. This</span>
<span class="sd">      can be a corporate file number, a database primary key, and likely is</span>
<span class="sd">      prefixed or post-fixed. Batch imports can (if they use the ID consistently)</span>
<span class="sd">      use the ID to identify previously imported records and avoid duplication.</span>

<span class="sd">    A suggested naming standard for paper records is</span>
<span class="sd">    ``&lt;prefix&gt;&lt;date&gt;&lt;running-number&gt;``, with possible</span>

<span class="sd">    * prefix indicates data type (stranding, tagging, nest obs etc)</span>
<span class="sd">    * date is reversed Y-m-d</span>
<span class="sd">    * a running number caters for multiple records of the same prefix and date</span>

<span class="sd">    These Paper record IDs should be recorded on the original paper forms</span>
<span class="sd">    (before scanning), used as file names for the PDF&#39;d scans, and typed into</span>
<span class="sd">    WAStD.</span>

<span class="sd">    The QA status can only be changed through transition methods, not directly.</span>
<span class="sd">    Changes to the QA status, as wells as versions of the data are logged to</span>
<span class="sd">    preserve the data lineage.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">STATUS_NEW</span> <span class="o">=</span> <span class="s1">&#39;new&#39;</span>
    <span class="n">STATUS_PROOFREAD</span> <span class="o">=</span> <span class="s1">&#39;proofread&#39;</span>
    <span class="n">STATUS_CURATED</span> <span class="o">=</span> <span class="s1">&#39;curated&#39;</span>
    <span class="n">STATUS_PUBLISHED</span> <span class="o">=</span> <span class="s1">&#39;published&#39;</span>

    <span class="n">LOCATION_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;1000&quot;</span>
    <span class="n">LOCATION_ACCURACY_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;GPS reading at exact location (10 m)&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">LOCATION_DEFAULT</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Site centroid or place name (1 km)&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;10000&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Rough estimate (10 km)&quot;</span><span class="p">)),</span> <span class="p">)</span>

    <span class="n">ENCOUNTER_STRANDING</span> <span class="o">=</span> <span class="s1">&#39;stranding&#39;</span>
    <span class="n">ENCOUNTER_TAGGING</span> <span class="o">=</span> <span class="s1">&#39;tagging&#39;</span>
    <span class="n">ENCOUNTER_INWATER</span> <span class="o">=</span> <span class="s1">&#39;inwater&#39;</span>
    <span class="n">ENCOUNTER_NEST</span> <span class="o">=</span> <span class="s1">&#39;nest&#39;</span>
    <span class="n">ENCOUNTER_TRACKS</span> <span class="o">=</span> <span class="s1">&#39;tracks&#39;</span>
    <span class="n">ENCOUNTER_TAG</span> <span class="o">=</span> <span class="s1">&#39;tag-management&#39;</span>
    <span class="n">ENCOUNTER_LOGGER</span> <span class="o">=</span> <span class="s1">&#39;logger&#39;</span>
    <span class="n">ENCOUNTER_OTHER</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>

    <span class="n">ENCOUNTER_TYPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">ENCOUNTER_STRANDING</span><span class="p">,</span> <span class="s2">&quot;Stranding&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ENCOUNTER_TAGGING</span><span class="p">,</span> <span class="s2">&quot;Tagging&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ENCOUNTER_NEST</span><span class="p">,</span> <span class="s2">&quot;Nest&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ENCOUNTER_TRACKS</span><span class="p">,</span> <span class="s2">&quot;Tracks&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ENCOUNTER_INWATER</span><span class="p">,</span> <span class="s2">&quot;In water&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ENCOUNTER_TAG</span><span class="p">,</span> <span class="s2">&quot;Tag Management&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ENCOUNTER_LOGGER</span><span class="p">,</span> <span class="s2">&quot;Logger&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ENCOUNTER_OTHER</span><span class="p">,</span> <span class="s2">&quot;Other&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">LEAFLET_ICON</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">ENCOUNTER_STRANDING</span><span class="p">:</span> <span class="s2">&quot;exclamation-circle&quot;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_TAGGING</span><span class="p">:</span> <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_NEST</span><span class="p">:</span> <span class="s2">&quot;home&quot;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_TRACKS</span><span class="p">:</span> <span class="s2">&quot;truck&quot;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_TAG</span><span class="p">:</span> <span class="s2">&quot;cog&quot;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_INWATER</span><span class="p">:</span> <span class="s2">&quot;tint&quot;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_LOGGER</span><span class="p">:</span> <span class="s2">&quot;tablet&quot;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_OTHER</span><span class="p">:</span> <span class="s2">&quot;question-circle&quot;</span>
    <span class="p">}</span>

    <span class="n">LEAFLET_COLOUR</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">ENCOUNTER_STRANDING</span><span class="p">:</span> <span class="s1">&#39;darkred&#39;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_TAGGING</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_INWATER</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_NEST</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_TRACKS</span><span class="p">:</span> <span class="s1">&#39;cadetblue&#39;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_TAG</span><span class="p">:</span> <span class="s1">&#39;darkpuple&#39;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_LOGGER</span><span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span>
        <span class="n">ENCOUNTER_OTHER</span><span class="p">:</span> <span class="s1">&#39;purple&#39;</span>
    <span class="p">}</span>

    <span class="n">survey</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Survey</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Survey&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The survey during which this encounter happened.&quot;</span><span class="p">),)</span>

    <span class="n">area</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Area</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Area&quot;</span><span class="p">),</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;encounter_area&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The general area this encounter took place in.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">site</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Area</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Surveyed site&quot;</span><span class="p">),</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;encounter_site&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The surveyed site, if known.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Data Source&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">SOURCE_DEFAULT</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">SOURCE_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Where was this record captured initially?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">source_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Source ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of the record in the original source, or &quot;</span>
                    <span class="s2">&quot;a newly allocated ID if left blank. Delete and save &quot;</span>
                    <span class="s2">&quot;to regenerate this ID.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="c1"># status = FSMField(</span>
    <span class="c1">#     db_index=True,</span>
    <span class="c1">#     default=QualityControlMixin.STATUS_NEW,</span>
    <span class="c1">#     choices=QualityControlMixin.STATUS_CHOICES,</span>
    <span class="c1">#     verbose_name=_(&quot;QA Status&quot;))</span>

    <span class="n">where</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">PointField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Observed at&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The observation location as point in WGS84&quot;</span><span class="p">))</span>

    <span class="n">when</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Observed on&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The observation datetime, shown as local time &quot;</span>
                    <span class="s2">&quot;(no daylight savings), stored as UTC.&quot;</span><span class="p">))</span>

    <span class="n">location_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Location accuracy class (m)&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">LOCATION_DEFAULT</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">LOCATION_ACCURACY_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span>
            <span class="s2">&quot;The source of the supplied location &quot;</span>
            <span class="s2">&quot;implies a rough location accuracy.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">location_accuracy_m</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Location accuracy (m)&quot;</span><span class="p">),</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The accuracy of the supplied location in metres, if given.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Animal Name&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The animal&#39;s earliest associated flipper tag ID.&quot;</span><span class="p">),)</span>

    <span class="n">observer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_DEFAULT</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">TSC_ADMIN_USER</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Observed by&quot;</span><span class="p">),</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;observer&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span>
            <span class="s2">&quot;The person who encountered the subject, and executed any measurements. &quot;</span>
            <span class="s2">&quot;The observer is the source of measurement bias.&quot;</span><span class="p">))</span>

    <span class="n">reporter</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_DEFAULT</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">TSC_ADMIN_USER</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Recorded by&quot;</span><span class="p">),</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;reporter&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span>
            <span class="s2">&quot;The person who wrote the initial data sheet in the field. &quot;</span>
            <span class="s2">&quot;The reporter is the source of handwriting and spelling errors. &quot;</span><span class="p">))</span>

    <span class="n">as_html</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;HTML representation&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The cached HTML representation for display purposes.&quot;</span><span class="p">),)</span>

    <span class="n">as_latex</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Latex fragment&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The cached Latex fragment for reporting purposes.&quot;</span><span class="p">),)</span>

    <span class="n">encounter_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Encounter type&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">ENCOUNTER_STRANDING</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ENCOUNTER_TYPES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The primary concern of this encounter.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class options.&quot;&quot;&quot;</span>

        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;when&quot;</span><span class="p">,</span> <span class="s2">&quot;where&quot;</span><span class="p">]</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="s2">&quot;source_id&quot;</span><span class="p">)</span>
        <span class="n">index_together</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;when&quot;</span><span class="p">,</span> <span class="s2">&quot;where&quot;</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Encounter&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Encounters&quot;</span>
        <span class="n">get_latest_by</span> <span class="o">=</span> <span class="s2">&quot;when&quot;</span>
        <span class="c1"># base_manager_name = &#39;base_objects&#39;  # fix delete bug</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">opts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make _meta accessible from templates.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Encounter </span><span class="si">{0}</span><span class="s2"> on </span><span class="si">{1}</span><span class="s2"> by </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">when</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">observer</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># URLs</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">absolute_admin_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the absolute admin change URL.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;admin:</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">_change&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>

<div class="viewcode-block" id="Encounter.make_rest_listurl"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Encounter.make_rest_listurl">[docs]</a>    <span class="k">def</span> <span class="nf">make_rest_listurl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the API list URL in given format (default: JSON).</span>

<span class="sd">        Permissible formats depend on configured renderers:</span>
<span class="sd">        api (human readable HTML), csv, json, jsonp, yaml, latex (PDF).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">rest_reverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span> <span class="o">+</span> <span class="s1">&#39;-list&#39;</span><span class="p">,</span>
                            <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">format</span><span class="p">})</span></div>

<div class="viewcode-block" id="Encounter.make_rest_detailurl"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Encounter.make_rest_detailurl">[docs]</a>    <span class="k">def</span> <span class="nf">make_rest_detailurl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the API detail URL in given format (default: JSON).</span>

<span class="sd">        Permissible formats depend on configured renderers:</span>
<span class="sd">        api (human readable HTML), csv, json, jsonp, yaml, latex (PDF).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">rest_reverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span> <span class="o">+</span> <span class="s1">&#39;-detail&#39;</span><span class="p">,</span>
                            <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pk&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">format</span><span class="p">})</span></div>



    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Derived properties</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">leaflet_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A string for Leaflet map marker titles. Cache me as field.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">when</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_encounter_type_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">leaflet_icon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the Fontawesome icon class for the encounter type.&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">Encounter</span><span class="o">.</span><span class="n">LEAFLET_ICON</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">encounter_type</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">leaflet_colour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the Leaflet.awesome-markers colour for the encounter type.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Encounter</span><span class="o">.</span><span class="n">LEAFLET_COLOUR</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">encounter_type</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tx_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A list of dicts of QA timestamp, status and operator.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">timestamp</span><span class="o">=</span><span class="n">log</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                     <span class="n">status</span><span class="o">=</span><span class="n">log</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
                     <span class="n">operator</span><span class="o">=</span><span class="n">log</span><span class="o">.</span><span class="n">by</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">StateLog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">for_</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_encounter_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Infer the encounter type.</span>

<span class="sd">        &quot;Track&quot; encounters have a TrackTallyObservation, those who don&#39;t have</span>
<span class="sd">        one but involve a TagObservation are tag management encounters (tag</span>
<span class="sd">        orders, distribution, returns, decommissioning).</span>
<span class="sd">        Lastly, the catch-all is &quot;other&quot; but complete records should not end up</span>
<span class="sd">        as such.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_set</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span><span class="n">TrackTallyObservation</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENCOUNTER_TRACKS</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_set</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span><span class="n">TagObservation</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENCOUNTER_TAG</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENCOUNTER_OTHER</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">short_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A short, often unique, human-readable representation of the encounter.</span>

<span class="sd">        Slugified and dash-separated:</span>

<span class="sd">        * Date of encounter as YYYY-mm-dd</span>
<span class="sd">        * longitude in WGS 84 DD, rounded to 4 decimals (&lt;10m),</span>
<span class="sd">        * latitude in WGS 84 DD, rounded to 4 decimals (&lt;10m), (missing sign!!)</span>
<span class="sd">        * health,</span>
<span class="sd">        * maturity,</span>
<span class="sd">        * species.</span>

<span class="sd">        The short_name could be non-unique for encounters of multiple stranded</span>
<span class="sd">        animals of the same species and deadness.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">slugify</span><span class="o">.</span><span class="n">slugify</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">when</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="o">.</span><span class="n">tzlocal</span><span class="p">())</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M %Z&quot;</span><span class="p">),</span>
            <span class="n">force_text</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span>
            <span class="n">force_text</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span>
        <span class="p">]))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the date component of Encounter.when.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">when</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">date_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the date as string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">when</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the full datetime of the Encounter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">when</span>

<div class="viewcode-block" id="Encounter.save"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Encounter.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cache popup, encounter type and source ID.</span>

<span class="sd">        The popup content changes when fields change, and is expensive to build.</span>
<span class="sd">        As it is required ofen and under performance-critical circumstances -</span>
<span class="sd">        populating the home screen with lots of popups - is is re-calculated</span>
<span class="sd">        whenever the contents change (on save) rather when it is required for</span>
<span class="sd">        display.</span>

<span class="sd">        The source ID will be auto-generated from ``short_name`` (if not set)</span>
<span class="sd">        but is not guaranteed to be unique.</span>
<span class="sd">        The User will be prompted to provide a unique source ID if necessary,</span>
<span class="sd">        e.g. by appending a running number.</span>
<span class="sd">        The source ID can be re-created by deleting it and re-saving the object.</span>

<span class="sd">        The encounter type is inferred from the type of attached Observations.</span>
<span class="sd">        This logic is overridden in subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_name</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">inferred_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inferred_name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_site</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encounter_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_encounter_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">as_html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_popup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">as_latex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latex</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Encounter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="c1"># Name -------------------------------------------------------------------#</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">guess_site</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the first Area containing the start_location or None.&quot;&quot;&quot;</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="n">Area</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">area_type</span><span class="o">=</span><span class="n">Area</span><span class="o">.</span><span class="n">AREATYPE_SITE</span><span class="p">,</span>
            <span class="n">geom__contains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">candidates</span> <span class="k">else</span> <span class="n">candidates</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">guess_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the first Area containing the start_location or None.&quot;&quot;&quot;</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="n">Area</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">area_type</span><span class="o">=</span><span class="n">Area</span><span class="o">.</span><span class="n">AREATYPE_LOCALITY</span><span class="p">,</span>
            <span class="n">geom__contains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">candidates</span> <span class="k">else</span> <span class="n">candidates</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<div class="viewcode-block" id="Encounter.set_name"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Encounter.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the animal name to a given value.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> name set to </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(),</span> <span class="n">name</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inferred_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the inferred name from related new capture if existing.&quot;&quot;&quot;</span>
        <span class="c1"># TODO less dirty</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">enc</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">for</span> <span class="n">enc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">related_encounters</span>
                    <span class="k">if</span> <span class="n">enc</span><span class="o">.</span><span class="n">is_new_capture</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="Encounter.set_name_in_related_encounters"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Encounter.set_name_in_related_encounters">[docs]</a>    <span class="k">def</span> <span class="nf">set_name_in_related_encounters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the animal name in all related AnimalEncounters.&quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">related_encounters</span><span class="p">]</span></div>

<div class="viewcode-block" id="Encounter.set_name_and_propagate"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Encounter.set_name_and_propagate">[docs]</a>    <span class="k">def</span> <span class="nf">set_name_and_propagate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the animal name in this and all related Encounters.&quot;&quot;&quot;</span>
        <span class="c1"># self.set_name(name)  # already contained in next line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_name_in_related_encounters</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">related_encounters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all Encounters with the same Animal.</span>

<span class="sd">        This algorithm collects all Encounters with the same animal by</span>
<span class="sd">        traversing an Encounter&#39;s TagObservations and their encounter histories.</span>

<span class="sd">        The algorithm starts with the Encounter (``self``) as initial</span>
<span class="sd">        known Encounter (``known_enc``), and ``self.tags`` as both initial known</span>
<span class="sd">        (``known_tags``) and new TagObs (``new_tags``).</span>
<span class="sd">        While there are new TagObs, a &quot;while&quot; loop harvests new encounters:</span>

<span class="sd">        * For each tag in ``new_tags``, retrieve the encounter history.</span>
<span class="sd">        * Combine and deduplicate the encounter histories</span>
<span class="sd">        * Remove known encounters and call this set of encounters ``new_enc``.</span>
<span class="sd">        * Add ``new_enc`` to ``known_enc``.</span>
<span class="sd">        * Combine and deduplicate all tags of all encounters in ``new_enc`` and</span>
<span class="sd">          call this set of TabObservations ``new_tags``.</span>
<span class="sd">        * Add ``new_tags`` to ``known_tags``.</span>
<span class="sd">        * Repeat the loop if the list of new tags is not empty.</span>

<span class="sd">        Finally, deduplicate and return ``known_enc``. These are all encounters</span>
<span class="sd">        that concern the same animal as this (self) encounter, as proven through</span>
<span class="sd">        the shared presence of TagObservations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">known_enc</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="p">]</span>
        <span class="n">known_tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">new_enc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span>
        <span class="n">show_must_go_on</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="n">show_must_go_on</span><span class="p">:</span>
            <span class="n">new_enc</span> <span class="o">=</span> <span class="n">TagObservation</span><span class="o">.</span><span class="n">encounter_histories</span><span class="p">(</span>
                <span class="n">new_tags</span><span class="p">,</span> <span class="n">without</span><span class="o">=</span><span class="n">known_enc</span><span class="p">)</span>
            <span class="n">known_enc</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_enc</span><span class="p">)</span>
            <span class="n">new_tags</span> <span class="o">=</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">tag_lists</span><span class="p">(</span><span class="n">new_enc</span><span class="p">)</span>
            <span class="n">known_tags</span> <span class="o">+=</span> <span class="n">new_tags</span>
            <span class="n">show_must_go_on</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_tags</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">known_enc</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a queryset of TagObservations.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_set</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span><span class="n">TagObservation</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flipper_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a queryset of Flipper Tag Observations.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_set</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span><span class="n">TagObservation</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">tagobservation__tag_type</span><span class="o">=</span><span class="s1">&#39;flipper-tag&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">primary_flipper_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the TagObservation of the primary flipper tag.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipper_tags</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;tagobservation__tag_location&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<div class="viewcode-block" id="Encounter.tag_lists"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Encounter.tag_lists">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tag_lists</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">encounter_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the related tags of list of encounters.</span>

<span class="sd">        TODO double-check performance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
            <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">tags</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">encounter_list</span><span class="p">])))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_new_capture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the Encounter is a new capture (hint: never).</span>

<span class="sd">        Encounters can involve tags, but are never new captures.</span>
<span class="sd">        AnimalEncounters override this property, as they can be new captures.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># HTML popup -------------------------------------------------------------#</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">wkt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the point coordinates as Well Known Text (WKT).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">wkt</span>

<div class="viewcode-block" id="Encounter.get_popup"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Encounter.get_popup">[docs]</a>    <span class="k">def</span> <span class="nf">get_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate HTML popup content.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;popup/</span><span class="si">{0}</span><span class="s2">.html&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">))</span>
        <span class="c1"># c = Context({&quot;original&quot;: self})</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">({</span><span class="s2">&quot;original&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}))</span></div>

<div class="viewcode-block" id="Encounter.get_report"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Encounter.get_report">[docs]</a>    <span class="k">def</span> <span class="nf">get_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate an HTML report of the Encounter.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;reports/</span><span class="si">{0}</span><span class="s2">.html&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">))</span>
        <span class="c1"># c = Context({&quot;original&quot;: self})</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">({</span><span class="s2">&quot;original&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}))</span></div>

<div class="viewcode-block" id="Encounter.get_latex"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Encounter.get_latex">[docs]</a>    <span class="k">def</span> <span class="nf">get_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a Latex fragment of the Encounter.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;latex/fragments/</span><span class="si">{0}</span><span class="s2">.tex&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">))</span>
        <span class="c1"># c = Context({&quot;original&quot;: self})</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">({</span><span class="s2">&quot;original&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}))</span></div>

<div class="viewcode-block" id="Encounter.get_observations"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Encounter.get_observations">[docs]</a>    <span class="k">def</span> <span class="nf">get_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return related observations as a queryset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Observation</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">encounter</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observation_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Manually implement the backwards relation to the Observation model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_observations</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the WGS 84 DD latitude.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">y</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the WGS 84 DD longitude.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the location CRS.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">srs</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the boostrap tag-* CSS label flavour for the QA status.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">QualityControlMixin</span><span class="o">.</span><span class="n">STATUS_LABELS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">photographs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the URLs of all attached photograph or none.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">observation_set</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span>
                    <span class="n">MediaAttachment</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                        <span class="n">mediaattachment__media_type</span><span class="o">=</span><span class="s2">&quot;photograph&quot;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="AnimalEncounter"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.AnimalEncounter">[docs]</a><span class="k">class</span> <span class="nc">AnimalEncounter</span><span class="p">(</span><span class="n">Encounter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The encounter of an animal of a species.</span>

<span class="sd">    Extends the base Encounter class with:</span>

<span class="sd">    * taxonomic group (choices), can be used to filter remaining form choices</span>
<span class="sd">    * species (choices)</span>
<span class="sd">    * sex (choices)</span>
<span class="sd">    * maturity (choices)</span>
<span class="sd">    * health (choices)</span>
<span class="sd">    * activity (choices)</span>
<span class="sd">    * behaviour (free text)</span>
<span class="sd">    * habitat (choices)</span>

<span class="sd">    Turtle Strandings are encounters of turtles</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">taxon</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Taxonomic group&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">TAXON_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">TAXON_CHOICES_DEFAULT</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The taxonomic group of the animal.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">species</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Species&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">SPECIES_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The species of the animal.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">sex</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Sex&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">SEX_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The animal&#39;s sex.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">maturity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Maturity&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">MATURITY_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The animal&#39;s maturity.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">health</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Health status&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">HEALTH_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;On a scale from the Fresh Prince of Bel Air to 80s Hair &quot;</span>
                    <span class="s2">&quot;Metal: how dead and decomposed is the animal?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">activity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Activity&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ACTIVITY_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The animal&#39;s activity at the time of observation.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">behaviour</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Condition and behaviour&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Notes on condition or behaviour.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">habitat</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Habitat&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">HABITAT_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The habitat in which the animal was encountered.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">nesting_event</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Nesting event&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Was the animal nesting?&quot;</span><span class="p">),)</span>

    <span class="n">laparoscopy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Laparoscopy conducted&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Was the animal&#39;s sex and maturity determined through &quot;</span>
                    <span class="s2">&quot;laparoscopy?&quot;</span><span class="p">),)</span>

    <span class="n">checked_for_injuries</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Checked for injuries&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Was the animal checked for injuries, were any found?&quot;</span><span class="p">),)</span>

    <span class="n">scanned_for_pit_tags</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Scanned for PIT tags&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Was the animal scanned for PIT tags, were any found?&quot;</span><span class="p">),)</span>

    <span class="n">checked_for_flipper_tags</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Checked for flipper tags&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Was the animal checked for flipper tags, were any found?&quot;</span><span class="p">),)</span>

    <span class="n">cause_of_death</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Cause of death&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">CAUSE_OF_DEATH_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;If dead, is the case of death known?&quot;</span><span class="p">),)</span>

    <span class="n">cause_of_death_confidence</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Cause of death confidence&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">CONFIDENCE_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;What is the cause of death, if known, based on?&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class options.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Animal Encounter&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Animal Encounters&quot;</span>
        <span class="n">get_latest_by</span> <span class="o">=</span> <span class="s2">&quot;when&quot;</span>
        <span class="c1"># base_manager_name = &#39;base_objects&#39;  # fix delete bug</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="n">tpl</span> <span class="o">=</span> <span class="s2">&quot;AnimalEncounter </span><span class="si">{0}</span><span class="s2"> on </span><span class="si">{1}</span><span class="s2"> by </span><span class="si">{2}</span><span class="s2"> of </span><span class="si">{3}</span><span class="s2">, </span><span class="si">{4}</span><span class="s2"> </span><span class="si">{5}</span><span class="s2"> </span><span class="si">{6}</span><span class="s2"> on </span><span class="si">{7}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">tpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">when</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="o">.</span><span class="n">tzlocal</span><span class="p">())</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M %Z&quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_species_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_health_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_maturity_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_sex_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_habitat_display</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_encounter_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Infer the encounter type.</span>

<span class="sd">        AnimalEncounters are either in water, tagging or stranding encounters.</span>
<span class="sd">        If the animal is dead (at various decompositional stages), a stranding</span>
<span class="sd">        is assumed.</span>
<span class="sd">        In water captures happen if the habitat is in the list of aquatic</span>
<span class="sd">        habitats.</span>
<span class="sd">        Remaining encounters are assumed to be taggings, as other encounters are</span>
<span class="sd">        excluded. Note that an animal encountered in water, or even a dead</span>
<span class="sd">        animal (whether that makes sense or not) can also be tagged.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nesting_event</span> <span class="o">==</span> <span class="s2">&quot;present&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">ENCOUNTER_TAGGING</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">health</span> <span class="ow">in</span> <span class="n">DEATH_STAGES</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">ENCOUNTER_STRANDING</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">habitat</span> <span class="ow">in</span> <span class="n">HABITAT_WATER</span><span class="p">:</span>
            <span class="c1"># this will ignore inwater encounters without habitat</span>
            <span class="k">return</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">ENCOUNTER_INWATER</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># not stranding or in water = fallback to tagging</span>
            <span class="k">return</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">ENCOUNTER_TAGGING</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">short_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A short, often unique, human-readable representation of the encounter.</span>

<span class="sd">        Slugified and dash-separated:</span>

<span class="sd">        * Date of encounter as YYYY-mm-dd</span>
<span class="sd">        * longitude in WGS 84 DD, rounded to 4 decimals (&lt;10m),</span>
<span class="sd">        * latitude in WGS 84 DD, rounded to 4 decimals (&lt;10m), (missing sign!!)</span>
<span class="sd">        * health,</span>
<span class="sd">        * maturity,</span>
<span class="sd">        * species,</span>
<span class="sd">        * name if available (requires &quot;update names&quot; and tag obs)</span>

<span class="sd">        The short_name could be non-unique for encounters of multiple stranded</span>
<span class="sd">        animals of the same species and deadness.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nameparts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">when</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="o">.</span><span class="n">tzlocal</span><span class="p">())</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M %Z&quot;</span><span class="p">),</span>
            <span class="n">force_text</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span>
            <span class="n">force_text</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">health</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maturity</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sex</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nameparts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slugify</span><span class="o">.</span><span class="n">slugify</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nameparts</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the WGS 84 DD latitude.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">y</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the WGS 84 DD longitude.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_stranding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the Encounters is stranding or tagging.</span>

<span class="sd">        If the animal is not &quot;alive&quot;, it&#39;s a stranding encounter, else it&#39;s a</span>
<span class="sd">        tagging encounter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">health</span> <span class="o">!=</span> <span class="s1">&#39;alive&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_new_capture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether this Encounter is a new capture.</span>

<span class="sd">        New captures are named after their primary flipper tag.</span>
<span class="sd">        An Encounter is a new capture if there are:</span>

<span class="sd">        * no associated TagObservations of ``is_recapture`` status</span>
<span class="sd">        * at least one associated TabObservation of ``is_new`` status</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_tagobs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipper_tags</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_new</span><span class="p">])</span>
        <span class="n">old_tagobs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipper_tags</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_recapture</span><span class="p">])</span>
        <span class="n">has_new_tagobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_tagobs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">has_old_tagobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_tagobs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">has_new_tagobs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_old_tagobs</span><span class="p">)</span>

<div class="viewcode-block" id="AnimalEncounter.get_absolute_url"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.AnimalEncounter.get_absolute_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;observations:animalencounter-detail&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pk&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span></div>

<div class="viewcode-block" id="AnimalEncounter.card_template"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.AnimalEncounter.card_template">[docs]</a>    <span class="k">def</span> <span class="nf">card_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;observations/animalencounter_card.html&#39;</span></div></div>


<div class="viewcode-block" id="TurtleNestEncounter"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TurtleNestEncounter">[docs]</a><span class="k">class</span> <span class="nc">TurtleNestEncounter</span><span class="p">(</span><span class="n">Encounter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The encounter of turtle nest during its life cycle.</span>

<span class="sd">    The observations are assumed to follow DPaW protocol.</span>
<span class="sd">    TurtleNestEncouters by third parties can be recorded, but related</span>
<span class="sd">    observations cannot if they don&#39;t follow DPaW protocol.</span>

<span class="sd">    Stages:</span>

<span class="sd">    * false crawl (aborted nesting attempt)</span>
<span class="sd">    * new (turtle is present, observed during nesting/tagging)</span>
<span class="sd">    * fresh (morning after, observed during track count)</span>
<span class="sd">    * predated (nest and eggs destroyed by predator)</span>
<span class="sd">    * hatched (eggs hatched)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nest_age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Age&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">NEST_AGE_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NEST_AGE_DEFAULT</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The track or nest age.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">nest_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">NEST_TYPE_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NEST_TYPE_DEFAULT</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The track or nest type.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">species</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Species&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">TURTLE_SPECIES_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">TURTLE_SPECIES_DEFAULT</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The species of the animal which created the track or nest.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">habitat</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Habitat&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">BEACH_POSITION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The habitat in which the track or nest was encountered.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">disturbance</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Evidence of predation or disturbance&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Is there evidence of predation or other disturbance?&quot;</span><span class="p">),)</span>

    <span class="n">nest_tagged</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Nest tag present&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Was a nest tag applied, re-sighted, or otherwise encountered?&quot;</span><span class="p">),)</span>

    <span class="n">logger_found</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Logger present&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Was a data logger deployed, retrieved, or otherwise encountered?&quot;</span><span class="p">),)</span>

    <span class="n">eggs_counted</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Nest excavated and eggs counted&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Was the nest excavated and were turtle eggs counted?&quot;</span><span class="p">),)</span>

    <span class="n">hatchlings_measured</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Hatchlings measured&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Were turtle hatchlings encountered and their morphometrics measured?&quot;</span><span class="p">),)</span>

    <span class="n">fan_angles_measured</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Hatchling emergence recorded&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Were hatchling emergence track fan angles recorded?&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class options.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Nest Encounter&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Turtle Nest Encounters&quot;</span>
        <span class="n">get_latest_by</span> <span class="o">=</span> <span class="s2">&quot;when&quot;</span>
        <span class="c1"># base_manager_name = &#39;base_objects&#39;  # fix delete bug</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> of </span><span class="si">{2}</span><span class="s2"> in </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_nest_age_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_nest_type_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_species_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_habitat_display</span><span class="p">(),</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_encounter_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Infer the encounter type.</span>

<span class="sd">        TurtleNestEncounters are always nest encounters. Would you have guessed?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">ENCOUNTER_NEST</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">short_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A short, often unique, human-readable representation of the encounter.</span>

<span class="sd">        Slugified and dash-separated:</span>

<span class="sd">        * Date of encounter as YYYY-mm-dd</span>
<span class="sd">        * longitude in WGS 84 DD, rounded to 4 decimals (&lt;10m),</span>
<span class="sd">        * latitude in WGS 84 DD, rounded to 4 decimals (&lt;10m), (missing sign!!)</span>
<span class="sd">        * nest age (type),</span>
<span class="sd">        * species,</span>
<span class="sd">        * name if available (requires &quot;update names&quot; and tag obs)</span>

<span class="sd">        The short_name could be non-unique.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nameparts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">when</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="o">.</span><span class="n">tzlocal</span><span class="p">())</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M %Z&quot;</span><span class="p">),</span>
            <span class="n">force_text</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span>
            <span class="n">force_text</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nest_age</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nameparts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slugify</span><span class="o">.</span><span class="n">slugify</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nameparts</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the WGS 84 DD latitude.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">y</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the WGS 84 DD longitude.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">x</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># URLs</span>
<div class="viewcode-block" id="TurtleNestEncounter.get_absolute_url"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TurtleNestEncounter.get_absolute_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;observations:turtlenestencounter-detail&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pk&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span></div>

<div class="viewcode-block" id="TurtleNestEncounter.card_template"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TurtleNestEncounter.card_template">[docs]</a>    <span class="k">def</span> <span class="nf">card_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;observations/turtlenestencounter_card.html&#39;</span></div></div>


<div class="viewcode-block" id="LineTransectEncounter"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.LineTransectEncounter">[docs]</a><span class="k">class</span> <span class="nc">LineTransectEncounter</span><span class="p">(</span><span class="n">Encounter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Encounter with a line transect.</span>

<span class="sd">    An observer tallies (not individually georeferenced) observations along</span>
<span class="sd">    a line transect, while recording the transect route live and keeping the</span>
<span class="sd">    tally until the end of the transect.</span>

<span class="sd">    Although individually geo-referenced Encounters are preferable, this Encounter</span>
<span class="sd">    type supports tallies of abundant entities (like turtle tracks on a saturation</span>
<span class="sd">    beach), collected under time pressure.</span>

<span class="sd">    Examples:</span>

<span class="sd">    ODK form &quot;Track Tally&quot;, providing per record:</span>
<span class="sd">    * One LineTransectEncounter with zero to many related:</span>
<span class="sd">    * TrackTallyObservation</span>
<span class="sd">    * TurtleNestDisturbanceTallyObservation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">transect</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">LineStringField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Transect line&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The line transect as LineString in WGS84&quot;</span><span class="p">))</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class options.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Line Transect Encounter&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Line Transect Encounters&quot;</span>
        <span class="n">get_latest_by</span> <span class="o">=</span> <span class="s2">&quot;when&quot;</span>
        <span class="c1"># base_manager_name = &#39;base_objects&#39;  # fix delete bug</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Line tx </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_encounter_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Infer the encounter type.</span>

<span class="sd">        If TrackTallyObservations are related, it&#39;s a track observation.</span>

<span class="sd">        TODO support other types of line transects when added</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">ENCOUNTER_NEST</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">short_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A short, often unique, human-readable representation of the encounter.</span>

<span class="sd">        Slugified and dash-separated:</span>

<span class="sd">        * Date of encounter as YYYY-mm-dd</span>
<span class="sd">        * longitude in WGS 84 DD, rounded to 4 decimals (&lt;10m),</span>
<span class="sd">        * latitude in WGS 84 DD, rounded to 4 decimals (&lt;10m), (missing sign!!)</span>
<span class="sd">        * nest age (type),</span>
<span class="sd">        * species,</span>
<span class="sd">        * name if available (requires &quot;update names&quot; and tag obs)</span>

<span class="sd">        The short_name could be non-unique.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nameparts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">when</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="o">.</span><span class="n">tzlocal</span><span class="p">())</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M %Z&quot;</span><span class="p">),</span>
            <span class="n">force_text</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span>
            <span class="n">force_text</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nameparts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slugify</span><span class="o">.</span><span class="n">slugify</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nameparts</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the WGS 84 DD latitude.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">y</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the WGS 84 DD longitude.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">x</span>

<div class="viewcode-block" id="LineTransectEncounter.card_template"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.LineTransectEncounter.card_template">[docs]</a>    <span class="k">def</span> <span class="nf">card_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;observations/linetransectencounter_card.html&#39;</span></div></div>


<div class="viewcode-block" id="LoggerEncounter"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.LoggerEncounter">[docs]</a><span class="k">class</span> <span class="nc">LoggerEncounter</span><span class="p">(</span><span class="n">Encounter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The encounter of an electronic logger during its life cycle.</span>

<span class="sd">    Stages:</span>

<span class="sd">    * programmed (in office)</span>
<span class="sd">    * posted to field team (in mail)</span>
<span class="sd">    * deployed (in situ)</span>
<span class="sd">    * resighted (in situ)</span>
<span class="sd">    * retrieved (in situ)</span>
<span class="sd">    * downloaded (in office)</span>

<span class="sd">    The life cycle can be repeated. The logger can be downloaded, reprogrammed</span>
<span class="sd">    and deployed again in situ.</span>

<span class="sd">    This model is deprecated and LoggerEncounters will become</span>
<span class="sd">    Encounters with LoggerObservations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">LOGGER_TYPE_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;temperature-logger&#39;</span>
    <span class="n">LOGGER_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">LOGGER_TYPE_DEFAULT</span><span class="p">,</span> <span class="s1">&#39;Temperature Logger&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;data-logger&#39;</span><span class="p">,</span> <span class="s1">&#39;Data Logger&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ctd-data-logger&#39;</span><span class="p">,</span> <span class="s1">&#39;Conductivity, Temperature, Depth SR data logger&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">LOGGER_STATUS_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;resighted&#39;</span>
    <span class="n">LOGGER_STATUS_NEW</span> <span class="o">=</span> <span class="s2">&quot;programmed&quot;</span>
    <span class="n">LOGGER_STATUS_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">LOGGER_STATUS_NEW</span><span class="p">,</span> <span class="s2">&quot;programmed&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;posted&quot;</span><span class="p">,</span> <span class="s2">&quot;posted to field team&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;deployed&quot;</span><span class="p">,</span> <span class="s2">&quot;deployed in situ&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;resighted&quot;</span><span class="p">,</span> <span class="s2">&quot;resighted in situ&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;retrieved&quot;</span><span class="p">,</span> <span class="s2">&quot;retrieved in situ&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;downloaded&quot;</span><span class="p">,</span> <span class="s2">&quot;downloaded&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">logger_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">LOGGER_TYPE_DEFAULT</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">LOGGER_TYPE_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The logger type.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">deployment_status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">LOGGER_STATUS_DEFAULT</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">LOGGER_STATUS_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The logger life cycle status.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">logger_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Logger ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of a logger must be unique within the tag type.&quot;</span><span class="p">),)</span>

    <span class="c1"># comments = models.TextField(</span>
    <span class="c1">#     verbose_name=_(&quot;Comment&quot;),</span>
    <span class="c1">#     blank=True, null=True,</span>
    <span class="c1">#     help_text=_(&quot;Comments&quot;), )</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class options.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Logger Encounter&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Logger Encounters&quot;</span>
        <span class="n">get_latest_by</span> <span class="o">=</span> <span class="s2">&quot;when&quot;</span>
        <span class="c1"># base_manager_name = &#39;base_objects&#39;  # fix delete bug</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger_type_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_deployment_status_display</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_encounter_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Infer the encounter type.</span>

<span class="sd">        LoggerEncounters are always logger encounters. Would you have guessed?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">ENCOUNTER_LOGGER</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">short_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A short, often unique, human-readable representation of the encounter.</span>

<span class="sd">        Slugified and dash-separated:</span>

<span class="sd">        * logger type</span>
<span class="sd">        * deployment status</span>
<span class="sd">        * logger id</span>

<span class="sd">        The short_name could be non-unique for very similar encounters.</span>
<span class="sd">        In this case, a modifier can be added by the user to ensure uniqueness.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nameparts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger_type</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deployment_status</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger_id</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nameparts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slugify</span><span class="o">.</span><span class="n">slugify</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nameparts</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inferred_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the encounter name from logger ID.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the WGS 84 DD latitude.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">y</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the WGS 84 DD longitude.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">x</span>

<div class="viewcode-block" id="LoggerEncounter.card_template"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.LoggerEncounter.card_template">[docs]</a>    <span class="k">def</span> <span class="nf">card_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;observations/loggerencounter_card.html&#39;</span></div></div>

<span class="c1"># Observation models ---------------------------------------------------------#</span>
<div class="viewcode-block" id="Observation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Observation">[docs]</a><span class="k">class</span> <span class="nc">Observation</span><span class="p">(</span><span class="n">PolymorphicModel</span><span class="p">,</span> <span class="n">LegacySourceMixin</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The Observation base class for encounter observations.</span>

<span class="sd">    Everything happens somewhere, at a time, to someone, and someone records it.</span>
<span class="sd">    Therefore, an Observation must happen during an Encounter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">encounter</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Encounter</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Encounter&quot;</span><span class="p">),</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;encounter&#39;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;The Encounter during which the observation was made&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class options.&quot;&quot;&quot;</span>

        <span class="c1"># base_manager_name = &#39;base_objects&#39;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;Obs </span><span class="si">{0}</span><span class="s2"> for </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the encounter location.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">where</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">as_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An HTML representation.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;popup/</span><span class="si">{0}</span><span class="s2">.html&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">))</span>
        <span class="c1"># c = Context({&quot;original&quot;: self})</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">({</span><span class="s2">&quot;original&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">as_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A Latex representation.&quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;latex/</span><span class="si">{0}</span><span class="s2">.tex&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">))</span>
        <span class="c1"># c = Context({&quot;original&quot;: self})</span>
        <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">({</span><span class="s2">&quot;original&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observation_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The concrete model name.</span>

<span class="sd">        This method will inherit down the polymorphic chain, and always return</span>
<span class="sd">        the actual child model&#39;s name.</span>

<span class="sd">        `observation_name` can be included as field e.g. in API serializers,</span>
<span class="sd">        so e.g. a writeable serializer would know which child model to `create`</span>
<span class="sd">        or `update`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polymorphic_ctype</span><span class="o">.</span><span class="n">model</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The encounter&#39;s latitude.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">y</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The encounter&#39;s longitude.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">x</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

<div class="viewcode-block" id="Observation.datetime"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.Observation.datetime">[docs]</a>    <span class="k">def</span> <span class="nf">datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The encounter&#39;s timestamp.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">when</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span></div></div>



<div class="viewcode-block" id="MediaAttachment"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.MediaAttachment">[docs]</a><span class="k">class</span> <span class="nc">MediaAttachment</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A media attachment to an Encounter.&quot;&quot;&quot;</span>

    <span class="n">MEDIA_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;data_sheet&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Data sheet&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;communication&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Communication record&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;photograph&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Photograph&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Other&#39;</span><span class="p">)),</span> <span class="p">)</span>

    <span class="n">media_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Attachment type&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">MEDIA_TYPE_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;photograph&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;What is the attached file about?&quot;</span><span class="p">),)</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Attachment name&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Give the attachment a representative name&quot;</span><span class="p">),)</span>

    <span class="n">attachment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span>
        <span class="n">upload_to</span><span class="o">=</span><span class="n">encounter_media</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;File attachment&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Upload the file&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Media Attachment&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;Media </span><span class="si">{0}</span><span class="s2"> for </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The path to attached file.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fpath</span> <span class="o">=</span> <span class="n">force_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attachment</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">fpath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">fpath</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attachment</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mark_safe</span><span class="p">(</span>
                <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">{0}</span><span class="s1">&quot; target=&quot;_&quot; rel=&quot;nofollow&quot; &#39;</span>
                <span class="s1">&#39;title=&quot;Click to view full screen in new browser tab&quot;&gt;&#39;</span>
                <span class="s1">&#39;&lt;img src=&quot;</span><span class="si">{0}</span><span class="s1">&quot; alt=&quot;</span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&quot; style=&quot;height:100px;&quot;&gt;&lt;/img&gt;&#39;</span>
                <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">attachment</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_media_type_display</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
                <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="TagObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TagObservation">[docs]</a><span class="k">class</span> <span class="nc">TagObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An Observation of an identifying tag on an observed entity.</span>

<span class="sd">    The identifying tag can be a flipper tag on a turtle, a PIT tag,</span>
<span class="sd">    a satellite tag, a barcode on a sample taken off an animal, a whisker ID</span>
<span class="sd">    from a picture of a pinniped, a genetic fingerprint or similar.</span>

<span class="sd">    The tag has its own life cycle through stages of production, delivery,</span>
<span class="sd">    affiliation with an animal, repeated sightings and disposal.</span>

<span class="sd">    The life cycle stages will vary between tag types.</span>

<span class="sd">    A TagObservation will find the tag in exactly one of the life cycle stages.</span>

<span class="sd">    The life history of each tag can be reconstructed from the sum of all of its</span>
<span class="sd">    TagObservations.</span>

<span class="sd">    As TagObservations can sometimes occur without an Observation of an animal,</span>
<span class="sd">    the FK to Observations is optional.</span>

<span class="sd">    Flipper Tag Status as per WAMTRAM:</span>

<span class="sd">    * # = tag attached new, number NA, need to double-check number</span>
<span class="sd">    * P, p: re-sighted as attached to animal, no actions taken or necessary</span>
<span class="sd">    * do not use: 0L, A2, M, M1, N</span>
<span class="sd">    * AE = A1</span>
<span class="sd">    * P_ED = near flipper edge, might fall off soon</span>
<span class="sd">    * PX = tag re-sighted, but operator could not read tag ID</span>
<span class="sd">      (e.g. turtle running off)</span>
<span class="sd">    * RQ = tag re-sighted, tag was &quot;insecure&quot;, but no action was recorded</span>

<span class="sd">    Recaptured tags: Need to record state (open, closed, tip locked or not)</span>
<span class="sd">    as feedback to taggers to improve their tagging technique.</span>

<span class="sd">    PIT tag status:</span>

<span class="sd">    * applied and did read OK</span>
<span class="sd">    * applied and did not read (but still inside and might read later on)</span>

<span class="sd">    Sample status:</span>

<span class="sd">    * taken off animal</span>
<span class="sd">    * handed to lab</span>
<span class="sd">    * done science to it</span>
<span class="sd">    * handed in report</span>

<span class="sd">    Animal Name:</span>
<span class="sd">    All TagObservations of one animal are linked by shared encounters or</span>
<span class="sd">    shared tag names. The earliest associated flipper tag name is used as the</span>
<span class="sd">    animal&#39;s name, and transferred onto all related TagObservations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tag_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tag type&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">TAG_TYPE_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;flipper-tag&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;What kind of tag is it?&quot;</span><span class="p">),)</span>

    <span class="n">tag_location</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tag position&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">TURTLE_BODY_PART_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">BODY_PART_DEFAULT</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Where is the tag attached, or the sample taken from?&quot;</span><span class="p">),)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tag ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of a tag must be unique within the tag type.&quot;</span><span class="p">),)</span>

    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tag status&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">TAG_STATUS_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">TAG_STATUS_DEFAULT</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The status this tag was after the encounter.&quot;</span><span class="p">),)</span>

    <span class="n">handler</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_DEFAULT</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">TSC_ADMIN_USER</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Handled by&quot;</span><span class="p">),</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;tag_handler&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The person in physical contact with the tag or sample&quot;</span><span class="p">))</span>

    <span class="n">recorder</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_DEFAULT</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">TSC_ADMIN_USER</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Recorded by&quot;</span><span class="p">),</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;tag_recorder&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The person who records the tag observation&quot;</span><span class="p">))</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Any other comments or notes.&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Tag Observation&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2"> on </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_tag_type_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_status_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_tag_location_display</span><span class="p">())</span>

<div class="viewcode-block" id="TagObservation.encounter_history"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TagObservation.encounter_history">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">encounter_history</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tagname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the related encounters of all TagObservations of a given tag name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">encounter</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">tagname</span><span class="p">)]))</span></div>

<div class="viewcode-block" id="TagObservation.encounter_histories"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TagObservation.encounter_histories">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">encounter_histories</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tagname_list</span><span class="p">,</span> <span class="n">without</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Return the related encounters of all tag names.</span>

<span class="sd">        TODO double-check performance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">encounter</span>
                <span class="k">for</span> <span class="n">encounter</span>
                <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">TagObservation</span><span class="o">.</span><span class="n">encounter_history</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tagname_list</span><span class="p">])))</span>
                <span class="k">if</span> <span class="n">encounter</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">without</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return wheter the TagObservation is the first association with the animal.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">TAG_STATUS_APPLIED_NEW</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_recapture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the TabObservation is a recapture.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="n">TAG_STATUS_RESIGHTED</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">history_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The list view of all observations of this tag.&quot;&quot;&quot;</span>
        <span class="n">cl</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;admin:observations_tagobservation_changelist&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">?q=</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote_plus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span></div>


<div class="viewcode-block" id="NestTagObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.NestTagObservation">[docs]</a><span class="k">class</span> <span class="nc">NestTagObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Turtle Nest Tag Observation.</span>

<span class="sd">    TNTs consist of three components, which are all optional:</span>

<span class="sd">    * flipper_tag_id: The primary flipper tag ID of the nesting turtle</span>
<span class="sd">    * date_nest_laid: The calendar (not turtle) date of nest creation</span>
<span class="sd">    * tag_label: Any extra nest label if other two components not available</span>

<span class="sd">    Naming scheme:</span>

<span class="sd">    * Uppercase and remove whitespace from flipper tag ID</span>
<span class="sd">    * date nest laid: YYYY-mm-dd</span>
<span class="sd">    * Uppercase and remove whitespace from tag label</span>
<span class="sd">    * Join all with &quot;_&quot;</span>

<span class="sd">    E.g.: WA1234_2017-12-31_M1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tag status&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">NEST_TAG_STATUS_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">TAG_STATUS_DEFAULT</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The status this tag was seen in, or brought into.&quot;</span><span class="p">),)</span>

    <span class="n">flipper_tag_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Flipper Tag ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The primary flipper tag ID of the nesting turtle &quot;</span>
                    <span class="s2">&quot;if available.&quot;</span><span class="p">),)</span>

    <span class="n">date_nest_laid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Date nest laid&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The calendar (not turtle) date of nest creation.&quot;</span><span class="p">))</span>

    <span class="n">tag_label</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tag Label&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Any extra nest label if other two components are not &quot;</span>
                    <span class="s2">&quot;available.&quot;</span><span class="p">),)</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Any other comments or notes.&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Nest Tag Observation&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status_display</span><span class="p">())</span>

    <span class="c1"># def save(self, *args, **kwargs):</span>
    <span class="c1">#     &quot;&quot;&quot;Cache name, centroid and northern extent.&quot;&quot;&quot;</span>
    <span class="c1">#     super(NestTagObservation, self).save(*args, **kwargs)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">history_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The list view of all observations of this tag.&quot;&quot;&quot;</span>
        <span class="n">cl</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;admin:observations_nesttagobservation_changelist&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipper_tag_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">?q=</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote_plus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flipper_tag_id</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cl</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the nest tag name according to the naming scheme.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipper_tag_id</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipper_tag_id</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_nest_laid</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_nest_laid</span><span class="p">),</span>
            <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_label</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="nesttagobservation_pre_save"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.nesttagobservation_pre_save">[docs]</a><span class="nd">@receiver</span><span class="p">(</span><span class="n">pre_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">NestTagObservation</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">nesttagobservation_pre_save</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;NestTagObservation pre_save: sanitise tag_label, name Encounter after tag.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">STATUS_NEW</span> <span class="ow">and</span> <span class="n">instance</span><span class="o">.</span><span class="n">tag_label</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">tag_label</span> <span class="o">=</span> <span class="n">sanitize_tag_label</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">tag_label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">STATUS_NEW</span> <span class="ow">and</span> <span class="n">instance</span><span class="o">.</span><span class="n">flipper_tag_id</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">flipper_tag_id</span> <span class="o">=</span> <span class="n">sanitize_tag_label</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">flipper_tag_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">Encounter</span><span class="o">.</span><span class="n">STATUS_NEW</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">instance</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">name</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">])</span></div>


<div class="viewcode-block" id="ManagementAction"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.ManagementAction">[docs]</a><span class="k">class</span> <span class="nc">ManagementAction</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Management actions following an AnimalEncounter.</span>

<span class="sd">    E.g, disposal, rehab, euthanasia.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">management_actions</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Management Actions&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Managment actions taken. Keep updating as appropriate.&quot;</span><span class="p">),)</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Any other comments or notes.&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Management Action&quot;</span>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;Management Action </span><span class="si">{0}</span><span class="s2"> of </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span></div>


<div class="viewcode-block" id="TurtleMorphometricObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TurtleMorphometricObservation">[docs]</a><span class="k">class</span> <span class="nc">TurtleMorphometricObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Morphometric measurements of a turtle.&quot;&quot;&quot;</span>

    <span class="n">curved_carapace_length_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Curved carapace length max (mm)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The curved carapace length (max) in millimetres.&quot;</span><span class="p">),)</span>

    <span class="n">curved_carapace_length_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ACCURACY_CHOICES</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Curved carapace length (max) accuracy&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The expected measurement accuracy.&quot;</span><span class="p">),)</span>

    <span class="n">curved_carapace_length_min_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Curved carapace length min (mm)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The curved carapace length (min) in millimetres.&quot;</span><span class="p">),)</span>

    <span class="n">curved_carapace_length_min_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ACCURACY_CHOICES</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Curved carapace length accuracy&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The expected measurement accuracy.&quot;</span><span class="p">),)</span>

    <span class="n">straight_carapace_length_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Straight carapace length (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The straight carapace length in millimetres.&quot;</span><span class="p">),)</span>

    <span class="n">straight_carapace_length_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ACCURACY_CHOICES</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Straight carapace length accuracy&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The expected measurement accuracy.&quot;</span><span class="p">),)</span>

    <span class="n">curved_carapace_width_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Curved carapace width (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Curved carapace width in millimetres.&quot;</span><span class="p">),)</span>

    <span class="n">curved_carapace_width_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ACCURACY_CHOICES</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Curved carapace width (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The expected measurement accuracy.&quot;</span><span class="p">),)</span>

    <span class="n">tail_length_carapace_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tail length from carapace (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The tail length in millimetres, &quot;</span>
                    <span class="s2">&quot;measured from carapace to tip.&quot;</span><span class="p">),)</span>

    <span class="n">tail_length_carapace_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ACCURACY_CHOICES</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tail length from carapace accuracy&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The expected measurement accuracy.&quot;</span><span class="p">),)</span>

    <span class="n">tail_length_vent_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tail length from vent (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The tail length in millimetres, &quot;</span>
                    <span class="s2">&quot;measured from vent to tip.&quot;</span><span class="p">),)</span>

    <span class="n">tail_length_vent_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ACCURACY_CHOICES</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tail Length Accuracy&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The expected measurement accuracy.&quot;</span><span class="p">),)</span>

    <span class="n">tail_length_plastron_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tail length from plastron (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The tail length in millimetres, &quot;</span>
                    <span class="s2">&quot;measured from plastron to tip.&quot;</span><span class="p">),)</span>

    <span class="n">tail_length_plastron_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ACCURACY_CHOICES</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tail length from plastron accuracy&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The expected measurement accuracy.&quot;</span><span class="p">),)</span>

    <span class="n">maximum_head_width_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Maximum head width (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The maximum head width in millimetres.&quot;</span><span class="p">),)</span>

    <span class="n">maximum_head_width_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ACCURACY_CHOICES</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Maximum head width accuracy&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The expected measurement accuracy.&quot;</span><span class="p">),)</span>

    <span class="n">maximum_head_length_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Maximum head length (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The maximum head length in millimetres.&quot;</span><span class="p">),)</span>

    <span class="n">maximum_head_length_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ACCURACY_CHOICES</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Maximum head length accuracy&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The expected measurement accuracy.&quot;</span><span class="p">),)</span>

    <span class="n">body_depth_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Body depth (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The body depth, plastron to carapace, in millimetres.&quot;</span><span class="p">),)</span>

    <span class="n">body_depth_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ACCURACY_CHOICES</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Body depth accuracy&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The expected measurement accuracy.&quot;</span><span class="p">),)</span>

    <span class="n">body_weight_g</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Body weight (g)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The body weight in grams (1000 g = 1kg).&quot;</span><span class="p">),)</span>

    <span class="n">body_weight_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">ACCURACY_CHOICES</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Body weight accuracy&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The expected measurement accuracy.&quot;</span><span class="p">),)</span>

    <span class="n">handler</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;morphometric_handler&quot;</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Measured by&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The person conducting the measurements.&quot;</span><span class="p">))</span>

    <span class="n">recorder</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;morphometric_recorder&quot;</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Recorded by&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The person recording the measurements.&quot;</span><span class="p">))</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Morphometric Observation&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="n">tpl</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;Turtle Morphometrics </span><span class="si">{0}</span><span class="s2"> CCL </span><span class="si">{1}</span><span class="s2"> CCW </span><span class="si">{2}</span><span class="s2"> for Encounter </span><span class="si">{3}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">tpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curved_carapace_length_mm</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curved_carapace_width_mm</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span></div>


<div class="viewcode-block" id="HatchlingMorphometricObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.HatchlingMorphometricObservation">[docs]</a><span class="k">class</span> <span class="nc">HatchlingMorphometricObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Morphometric measurements of a hatchling at a TurtleNestEncounter.&quot;&quot;&quot;</span>

    <span class="n">straight_carapace_length_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Straight carapace length (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The straight carapace length in millimetres.&quot;</span><span class="p">),)</span>

    <span class="n">straight_carapace_width_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Straight carapace width (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The straight carapace width in millimetres.&quot;</span><span class="p">),)</span>

    <span class="n">body_weight_g</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Body weight (g)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The body weight in grams (1000 g = 1kg).&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Hatchling Morphometric Observation&quot;</span>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="n">tpl</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> Hatchling SCL </span><span class="si">{1}</span><span class="s2"> mm, SCW </span><span class="si">{2}</span><span class="s2"> mm, Wt </span><span class="si">{3}</span><span class="s2"> g&quot;</span>
        <span class="k">return</span> <span class="n">tpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight_carapace_length_mm</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">straight_carapace_width_mm</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body_weight_g</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="DugongMorphometricObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.DugongMorphometricObservation">[docs]</a><span class="k">class</span> <span class="nc">DugongMorphometricObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Morphometric measurements of a Dugong at an AnimalEncounter.&quot;&quot;&quot;</span>

    <span class="n">body_length_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Body length (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The body length in millimetres.&quot;</span><span class="p">),)</span>

    <span class="n">body_girth_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Body girth (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The body girth at the widest point in millimetres.&quot;</span><span class="p">),)</span>

    <span class="n">tail_fluke_width_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tail fluke width (mm)&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The tail fluke width in millimetres.&quot;</span><span class="p">),)</span>

    <span class="n">tusks_found</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tusks found&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Did the animal have tusks?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Dugong Morphometric Observation&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="n">tpl</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> Hatchling SCL </span><span class="si">{2}</span><span class="s2"> mm, SCW </span><span class="si">{3}</span><span class="s2"> mm, Wt </span><span class="si">{4}</span><span class="s2"> g&quot;</span>
        <span class="k">return</span> <span class="n">tpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body_length_mm</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body_girth_mm</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tail_fluke_width_mm</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TurtleDamageObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TurtleDamageObservation">[docs]</a><span class="k">class</span> <span class="nc">TurtleDamageObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Observation of turtle damages or injuries.&quot;&quot;&quot;</span>

    <span class="n">body_part</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;whole-turtle&quot;</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Affected body part&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">TURTLE_BODY_PART_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The body part affected by the observed damage.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">damage_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;minor-trauma&quot;</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Damage type&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">DAMAGE_TYPE_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The type of the damage.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">damage_age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;healed-entirely&quot;</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Damage age&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">DAMAGE_AGE_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The age of the damage.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A description of the damage.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Damage Observation&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_body_part_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_damage_age_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_damage_type_display</span><span class="p">(),</span> <span class="p">)</span></div>


<div class="viewcode-block" id="TrackTallyObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TrackTallyObservation">[docs]</a><span class="k">class</span> <span class="nc">TrackTallyObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Observation of turtle track tallies and signs of predation.&quot;&quot;&quot;</span>

    <span class="n">species</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Species&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">TURTLE_SPECIES_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">TURTLE_SPECIES_DEFAULT</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The species of the animal causing the track.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">nest_age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Age&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">NEST_AGE_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NEST_AGE_DEFAULT</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The track or nest age.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">nest_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">NEST_TYPE_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NEST_TYPE_DEFAULT</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The track or nest type.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">tally</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tally&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The sum of encountered tracks.&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Track Tally Observation&quot;</span>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;TrackTally: </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">s of </span><span class="si">{3}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tally</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest_age</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span></div>



<div class="viewcode-block" id="TurtleNestDisturbanceTallyObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TurtleNestDisturbanceTallyObservation">[docs]</a><span class="k">class</span> <span class="nc">TurtleNestDisturbanceTallyObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Observation of turtle track tallies and signs of predation.&quot;&quot;&quot;</span>

    <span class="n">species</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Species&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">TURTLE_SPECIES_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">TURTLE_SPECIES_DEFAULT</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The species of the nesting animal.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">disturbance_cause</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Disturbance cause&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">NEST_DAMAGE_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NEST_DAMAGE_DEFAULT</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The cause of the disturbance.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">no_nests_disturbed</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tally of nests disturbed&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The sum of damaged nests.&quot;</span><span class="p">),)</span>

    <span class="n">no_tracks_encountered</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tally of disturbance signs&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The sum of signs, e.g. predator tracks.&quot;</span><span class="p">),)</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Any other comments or notes.&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Nest Disturbance Tally Observation&quot;</span>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Nest Damage Tally: </span><span class="si">{0}</span><span class="s1"> nests of </span><span class="si">{1}</span><span class="s1"> showing disturbance by </span><span class="si">{2}</span><span class="s1"> &#39;</span>
              <span class="s1">&#39;(</span><span class="si">{3}</span><span class="s1"> disturbance signs sighted)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_nests_disturbed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">disturbance_cause</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_tracks_encountered</span><span class="p">)</span></div>


<div class="viewcode-block" id="TurtleNestObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TurtleNestObservation">[docs]</a><span class="k">class</span> <span class="nc">TurtleNestObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Turtle nest observations.</span>

<span class="sd">    This model supports data sheets for:</span>

<span class="sd">    * Turtle nest observation during tagging</span>
<span class="sd">    * Turtle nest excavation a few days after hatching</span>

<span class="sd">    Egg count is done as total, plus categories of nest contents following</span>
<span class="sd">    &quot;Determining Clutch Size and Hatching Success, Jeffrey D. Miller,</span>
<span class="sd">    Research and Management Techniques for the Conservation of Sea Turtles,</span>
<span class="sd">    IUCN Marine Turtle Specialist Group, 1999.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nest_position</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Beach position&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">BEACH_POSITION_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The position of the nest on the beach.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">eggs_laid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Did the turtle lay eggs?&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Did round, white objects leave the turtle&#39;s butt?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">egg_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Total number of eggs laid&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The total number of eggs laid as observed during tagging.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="c1"># start Miller fields</span>
    <span class="c1"># no_emerged = models.PositiveIntegerField(</span>
    <span class="c1">#     verbose_name=_(&quot;Emerged (E)&quot;),</span>
    <span class="c1">#     blank=True, null=True,</span>
    <span class="c1">#     help_text=_(&quot;The number of hatchlings leaving or departed from nest.&quot;</span>
    <span class="c1">#                 &quot;Calculated from S - (L + D).&quot;), )</span>

    <span class="n">no_egg_shells</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Egg shells (S)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The number of empty shells counted which were &quot;</span>
                    <span class="s2">&quot;more than 50 percent complete.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">no_live_hatchlings_neck_of_nest</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Live hatchlings in neck of nest&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The number of live hatchlings in the neck of the nest.&quot;</span><span class="p">),)</span>

    <span class="n">no_live_hatchlings</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Live hatchlings in nest (L)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The number of live hatchlings left among shells &quot;</span>
                    <span class="s2">&quot;excluding those in neck of nest.&quot;</span><span class="p">),)</span>

    <span class="n">no_dead_hatchlings</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Dead hatchlings (D)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The number of dead hatchlings that have left&quot;</span>
                    <span class="s2">&quot; their shells.&quot;</span><span class="p">),)</span>

    <span class="n">no_undeveloped_eggs</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Undeveloped eggs (UD)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The number of unhatched eggs with no obvious embryo.&quot;</span><span class="p">),)</span>

    <span class="n">no_unhatched_eggs</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Unhatched eggs (UH)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The number of unhatched eggs with obvious, &quot;</span>
                    <span class="s2">&quot;not yet full term, embryo.&quot;</span><span class="p">),)</span>

    <span class="n">no_unhatched_term</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Unhatched term (UHT)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The number of unhatched, apparently full term, embryo&quot;</span>
                    <span class="s2">&quot; in egg or pipped with small amount of external&quot;</span>
                    <span class="s2">&quot; yolk material.&quot;</span><span class="p">),)</span>

    <span class="n">no_depredated_eggs</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Depredated eggs (P)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The number of open, nearly complete shells containing &quot;</span>
                    <span class="s2">&quot;egg residue.&quot;</span><span class="p">),)</span>

    <span class="c1"># end Miller fields</span>
    <span class="n">nest_depth_top</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Nest depth (top) mm&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The depth of sand above the eggs in mm.&quot;</span><span class="p">),)</span>

    <span class="n">nest_depth_bottom</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Nest depth (bottom) mm&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The depth of the lowest eggs in mm.&quot;</span><span class="p">),)</span>

    <span class="n">sand_temp</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Sand temperature&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The sand temperature in degree Celsius.&quot;</span><span class="p">),)</span>

    <span class="n">air_temp</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Air temperature&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The air temperature in degree Celsius.&quot;</span><span class="p">),)</span>

    <span class="n">water_temp</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Water temperature&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The water temperature in degree Celsius.&quot;</span><span class="p">),)</span>

    <span class="n">egg_temp</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Egg temperature&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The egg temperature in degree Celsius.&quot;</span><span class="p">),)</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Any other comments or notes.&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Nest Excavation (Egg count)&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Turtle Nest Excavations (Egg count)&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;Nest Obs </span><span class="si">{0}</span><span class="s2"> eggs, hatching succ </span><span class="si">{1}</span><span class="s2">, emerg succ </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">egg_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hatching_success</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">emergence_success</span><span class="p">)</span>

    <span class="c1"># TODO custom save()</span>
    <span class="c1"># calculate egg_count;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">no_emerged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The number of hatchlings leaving or departed from nest is S-(L+D).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_egg_shells</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_live_hatchlings</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dead_hatchlings</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">egg_count_calculated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The calculated egg count from nest excavations.</span>

<span class="sd">        Calculated as:</span>

<span class="sd">        no_egg_shells + no_undeveloped_eggs + no_unhatched_eggs +</span>
<span class="sd">        no_unhatched_term + no_depredated_eggs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_egg_shells</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_undeveloped_eggs</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_unhatched_eggs</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_unhatched_term</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_depredated_eggs</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hatching_success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the hatching success as percentage [0..100].</span>

<span class="sd">        Formula after Miller 1999::</span>

<span class="sd">            Hatching success = 100 * no_egg_shells / (</span>
<span class="sd">                no_egg_shells + no_undeveloped_eggs + no_unhatched_eggs +</span>
<span class="sd">                no_unhatched_term + no_depredated_eggs)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">egg_count_calculated</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_egg_shells</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">egg_count_calculated</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emergence_success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the emergence success as percentage [0..100].</span>

<span class="sd">        Formula after Miller 1999::</span>

<span class="sd">            Emergence success = 100 *</span>
<span class="sd">                (no_egg_shells - no_live_hatchlings - no_dead_hatchlings) / (</span>
<span class="sd">                no_egg_shells + no_undeveloped_eggs + no_unhatched_eggs +</span>
<span class="sd">                no_unhatched_term + no_depredated_eggs)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">egg_count_calculated</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_egg_shells</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_live_hatchlings</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_dead_hatchlings</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">egg_count_calculated</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="TurtleNestDisturbanceObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TurtleNestDisturbanceObservation">[docs]</a><span class="k">class</span> <span class="nc">TurtleNestDisturbanceObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Turtle nest disturbance observations.</span>

<span class="sd">    Disturbance can be a result of:</span>

<span class="sd">    * Predation</span>
<span class="sd">    * Disturbance by other turtles</span>
<span class="sd">    * Environmental disturbance (cyclones, tides)</span>
<span class="sd">    * Anthropogenic disturbance (vehicle damage, poaching, research, harvest)</span>

<span class="sd">    Disturbance severity can range from negligible disturbance to total destruction.</span>

<span class="sd">    Disturbance cause contains a training category to mark training or test records.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NEST_VIABILITY_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;negligible&quot;</span><span class="p">,</span> <span class="s2">&quot;negligible disturbance&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;partly&quot;</span><span class="p">,</span> <span class="s2">&quot;nest partly destroyed&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;completely&quot;</span><span class="p">,</span> <span class="s2">&quot;nest completely destroyed&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">NA_VALUE</span><span class="p">,</span> <span class="s2">&quot;nest in indeterminate condition&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">disturbance_cause</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Disturbance cause&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">NEST_DAMAGE_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The cause of the disturbance.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">disturbance_cause_confidence</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Disturbance cause choice confidence&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">CONFIDENCE_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;What is the choice of disturbance cause based on?&quot;</span><span class="p">),)</span>

    <span class="n">disturbance_severity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Disturbance severity&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">NEST_VIABILITY_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The impact of the disturbance on nest viability.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Any other comments or notes.&quot;</span><span class="p">),)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;Nest Disturbance </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disturbance_cause</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disturbance_severity</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Nest Disturbance Observation&quot;</span></div>


<div class="viewcode-block" id="PathToSea"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.PathToSea">[docs]</a><span class="k">class</span> <span class="nc">PathToSea</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A Mixin providing code, label and description.&quot;&quot;&quot;</span>

    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Code&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A unique, url-safe code.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Label&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A human-readable, self-explanatory label.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A comprehensive description.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="c1"># abstract = True</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span></div>


<div class="viewcode-block" id="TurtleHatchlingEmergenceObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TurtleHatchlingEmergenceObservation">[docs]</a><span class="k">class</span> <span class="nc">TurtleHatchlingEmergenceObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Turtle hatchling emergence observation.</span>

<span class="sd">    Hatchling emergence observations can include:</span>

<span class="sd">    * Emergence time (if seen directly),</span>
<span class="sd">    * Fan angles of hatchling tracks forming a fan from nest to sea,</span>
<span class="sd">    * Emergence climate</span>
<span class="sd">    * Outliers present (if yes: TurtleHatchlingEmergenceOutlierObservation)</span>
<span class="sd">    * Light sources known and present (if yes: LightSourceObservation).</span>

<span class="sd">    # TON 0.54+</span>
<span class="sd">    &quot;fan_angles&quot;: {</span>
<span class="sd">        &quot;photo_hatchling_tracks_seawards&quot;: &quot;1546836969404.jpg&quot;,</span>
<span class="sd">        &quot;photo_hatchling_tracks_relief&quot;: null,</span>
<span class="sd">        &quot;bearing_to_water_manual&quot;: &quot;98.0000000000&quot;,</span>
<span class="sd">        &quot;leftmost_track_manual&quot;: &quot;58.0000000000&quot;,</span>
<span class="sd">        &quot;rightmost_track_manual&quot;: &quot;122.0000000000&quot;,</span>
<span class="sd">        &quot;no_tracks_main_group&quot;: &quot;7&quot;,</span>
<span class="sd">        &quot;no_tracks_main_group_min&quot;: &quot;7&quot;,</span>
<span class="sd">        &quot;no_tracks_main_group_max&quot;: &quot;7&quot;,</span>
<span class="sd">        &quot;outlier_tracks_present&quot;: &quot;present&quot;,</span>
<span class="sd">        &quot;hatchling_path_to_sea&quot;: &quot;clear&quot;,</span>
<span class="sd">        &quot;path_to_sea_comments&quot;: null,</span>
<span class="sd">        &quot;hatchling_emergence_time_known&quot;: &quot;yes&quot;,</span>
<span class="sd">        &quot;cloud_cover_at_emergence_known&quot;: &quot;yes&quot;,</span>
<span class="sd">        &quot;light_sources_present&quot;: &quot;present&quot;</span>
<span class="sd">      },</span>
<span class="sd">      &quot;outlier_track&quot;: {</span>
<span class="sd">        &quot;outlier_track_photo&quot;: &quot;1546837474680.jpg&quot;,</span>
<span class="sd">        &quot;outlier_track_bearing_manual&quot;: &quot;180.0000000000&quot;,</span>
<span class="sd">        &quot;outlier_group_size&quot;: &quot;1&quot;,</span>
<span class="sd">        &quot;outlier_track_comment&quot;: null</span>
<span class="sd">      },</span>
<span class="sd">      &quot;hatchling_emergence_time_group&quot;: {</span>
<span class="sd">        &quot;hatchling_emergence_time&quot;: &quot;2019-01-06T23:07:00.000Z&quot;,</span>
<span class="sd">        &quot;hatchling_emergence_time_source&quot;: &quot;plusminus-2h&quot;</span>
<span class="sd">      },</span>
<span class="sd">      &quot;emergence_climate&quot;: {</span>
<span class="sd">        &quot;cloud_cover_at_emergence&quot;: &quot;3&quot;</span>
<span class="sd">      },</span>
<span class="sd">      &quot;light_source&quot;: [</span>
<span class="sd">        {</span>
<span class="sd">          &quot;light_source_photo&quot;: null,</span>
<span class="sd">          &quot;light_bearing_manual&quot;: &quot;50.0000000000&quot;,</span>
<span class="sd">          &quot;light_source_type&quot;: &quot;artificial&quot;,</span>
<span class="sd">          &quot;light_source_description&quot;: &quot;Oil rig#5&quot;</span>
<span class="sd">        },</span>
<span class="sd">        {</span>
<span class="sd">          &quot;light_source_photo&quot;: null,</span>
<span class="sd">          &quot;light_bearing_manual&quot;: &quot;190.0000000000&quot;,</span>
<span class="sd">          &quot;light_source_type&quot;: &quot;natural&quot;,</span>
<span class="sd">          &quot;light_source_description&quot;: &quot;Moon&quot;</span>
<span class="sd">        }</span>
<span class="sd">      ],</span>
<span class="sd">      &quot;other_light_sources&quot;: {</span>
<span class="sd">        &quot;other_light_sources_present&quot;: &quot;na&quot;</span>
<span class="sd">      }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># photo_hatchling_tracks_seawards # media</span>
    <span class="c1"># photo_hatchling_tracks_relief # media</span>
    <span class="n">bearing_to_water_degrees</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Bearing to water&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Bearing captured with handheld compass.&quot;</span><span class="p">),)</span>

    <span class="n">bearing_leftmost_track_degrees</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Leftmost track bearing of main fan&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Excluding outlier tracks, 5m from nest or at HWM. Bearing captured with handheld compass.&quot;</span><span class="p">),)</span>

    <span class="n">bearing_rightmost_track_degrees</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Rightmost track bearing of main fan&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Excluding outlier tracks, 5m from nest or at HWM. Bearing captured with handheld compass.&quot;</span><span class="p">),)</span>

    <span class="n">no_tracks_main_group</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Number of tracks in main fan&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Exact count or best estimate.&quot;</span><span class="p">),)</span>

    <span class="n">no_tracks_main_group_min</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Min number of tracks in main fan&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Lowest estimate.&quot;</span><span class="p">),)</span>

    <span class="n">no_tracks_main_group_max</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Max number of tracks in main fan&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Highest estimate.&quot;</span><span class="p">),)</span>

    <span class="n">outlier_tracks_present</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Outlier tracks present&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),)</span>

    <span class="n">hatchling_path_to_sea</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">PathToSea</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;path_to_sea&quot;</span><span class="p">)</span>

    <span class="n">path_to_sea_comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Hatchling path to sea comments&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Any other comments or notes.&quot;</span><span class="p">),)</span>

    <span class="n">hatchling_emergence_time_known</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Hatchling emergence time known&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">((</span><span class="n">NA_VALUE</span><span class="p">,</span> <span class="s2">&quot;NA&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">),),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),)</span>  <span class="c1"># yes no</span>

    <span class="n">cloud_cover_at_emergence_known</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Cloud cover at emergence known&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">((</span><span class="n">NA_VALUE</span><span class="p">,</span> <span class="s2">&quot;NA&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">),),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),)</span>

    <span class="n">light_sources_present</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Light sources present during emergence&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),)</span>
    <span class="c1"># other_light_sources_present</span>

    <span class="n">hatchling_emergence_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Hatchling emergence time&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The estimated time of hatchling emergence, stored as UTC and &quot;</span>
                    <span class="s2">&quot;shown in local time.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">hatchling_emergence_time_accuracy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Hatchling emergence time estimate accuracy&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">TIME_ESTIMATE_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),)</span>

    <span class="n">cloud_cover_at_emergence</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Cloud cover at emergence&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;If known, in eights.&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Hatchling Emergence Observation (Fan Angle)&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Turtle Hatchling Emergence Observations (Fan Angles)&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Fan </span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">-</span><span class="si">{2}</span><span class="s2">) tracks (</span><span class="si">{3}</span><span class="s2">-</span><span class="si">{4}</span><span class="s2"> deg); water </span><span class="si">{5}</span><span class="s2"> deg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_tracks_main_group</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_tracks_main_group_min</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">no_tracks_main_group_max</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing_leftmost_track_degrees</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing_rightmost_track_degrees</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing_to_water_degrees</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="LightSourceObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.LightSourceObservation">[docs]</a><span class="k">class</span> <span class="nc">LightSourceObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dict of one or list of many</span>
<span class="sd">    {</span>
<span class="sd">      &quot;light_source_photo&quot;: null,</span>
<span class="sd">      &quot;light_bearing_manual&quot;: &quot;50.0000000000&quot;,</span>
<span class="sd">      &quot;light_source_type&quot;: &quot;artificial&quot;  &quot;natural&quot; CHOICES</span>
<span class="sd">      &quot;light_source_description&quot;: &quot;Oil rig#5&quot;</span>
<span class="sd">    }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bearing_light_degrees</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Bearing&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Bearing captured with handheld compass.&quot;</span><span class="p">),)</span>

    <span class="n">light_source_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Light source type&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">((</span><span class="n">NA_VALUE</span><span class="p">,</span> <span class="s2">&quot;NA&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;natural&quot;</span><span class="p">,</span> <span class="s2">&quot;Natural&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;artificial&quot;</span><span class="p">,</span> <span class="s2">&quot;Artificial&quot;</span><span class="p">),),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),)</span>

    <span class="n">light_source_description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Any other comments or notes.&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Hatchling Light Source Observation (Fan Angle)&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Turtle Hatchling Light Source Observations (Fan Angles)&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Light Source </span><span class="si">{0}</span><span class="s2"> at </span><span class="si">{1}</span><span class="s2"> deg: </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_light_source_type_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing_light_degrees</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">light_source_description</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TurtleHatchlingEmergenceOutlierObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TurtleHatchlingEmergenceOutlierObservation">[docs]</a><span class="k">class</span> <span class="nc">TurtleHatchlingEmergenceOutlierObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dict of one or list of many</span>
<span class="sd">    &quot;outlier_track&quot;: {</span>
<span class="sd">    &quot;outlier_track_photo&quot;: &quot;1546837474680.jpg&quot;,</span>
<span class="sd">    &quot;outlier_track_bearing_manual&quot;: &quot;180.0000000000&quot;,</span>
<span class="sd">    &quot;outlier_group_size&quot;: &quot;1&quot;,</span>
<span class="sd">    &quot;outlier_track_comment&quot;: null</span>
<span class="sd">    }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># outlier_track_photo # media</span>
    <span class="n">bearing_outlier_track_degrees</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Bearing&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Aim at track 5m from nest or high water mark. Bearing captured with handheld compass.&quot;</span><span class="p">),)</span>

    <span class="n">outlier_group_size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Number of tracks in outlier group&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),)</span>

    <span class="n">outlier_track_comment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Any other comments or notes.&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Turtle Hatchling Emergence Outlier Observation (Fan Angle)&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Turtle Hatchling Emergence Outlier Observations (Fan Angles)&quot;</span>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Outlier: </span><span class="si">{0}</span><span class="s2"> tracks at </span><span class="si">{1}</span><span class="s2"> deg. </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outlier_group_size</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing_outlier_track_degrees</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outlier_track_comment</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>

<span class="c1"># TODO add CetaceanMorphometricObservation for cetacean strandings</span>


<span class="c1"># Logger Observation models --------------------------------------------------#</span>
<div class="viewcode-block" id="TemperatureLoggerSettings"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TemperatureLoggerSettings">[docs]</a><span class="k">class</span> <span class="nc">TemperatureLoggerSettings</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Temperature Logger Settings.&quot;&quot;&quot;</span>

    <span class="n">logging_interval</span> <span class="o">=</span> <span class="n">DurationField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Logging interval&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The time between individual readings as python timedelta &quot;</span>
                    <span class="s2">&quot;string. E.g, 1h is `01:00:00`; 1 day is `1 00:00:00`.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">recording_start</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Recording start&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The preset start of recording, stored as UTC and &quot;</span>
                    <span class="s2">&quot;shown in local time.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">tested</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Tested&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Was the logger tested after programming?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Temperature Logger Setting&quot;</span>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;Sampling starting on </span><span class="si">{0}</span><span class="s2"> with rate </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recording_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging_interval</span><span class="p">)</span></div>


<div class="viewcode-block" id="DispatchRecord"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.DispatchRecord">[docs]</a><span class="k">class</span> <span class="nc">DispatchRecord</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A record of dispatching the subject of the encounter.&quot;&quot;&quot;</span>

    <span class="n">sent_to</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_DEFAULT</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">TSC_ADMIN_USER</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Sent to&quot;</span><span class="p">),</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;receiver&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The receiver of the dispatch.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="c1"># sent_on = models.DateField(</span>
    <span class="c1">#     verbose_name=_(&quot;Sent on&quot;),</span>
    <span class="c1">#     blank=True, null=True,</span>
    <span class="c1">#     help_text=_(&quot;The date of dispatch.&quot;))</span>


    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Dispatch Record&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;Sent on </span><span class="si">{0}</span><span class="s2"> to </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">when</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sent_to</span><span class="p">)</span></div>


<div class="viewcode-block" id="TemperatureLoggerDeployment"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.TemperatureLoggerDeployment">[docs]</a><span class="k">class</span> <span class="nc">TemperatureLoggerDeployment</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A record of deploying a temperature logger.&quot;&quot;&quot;</span>

    <span class="n">depth_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Logger depth (mm)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The depth of the buried logger in mm.&quot;</span><span class="p">),)</span>

    <span class="n">marker1_present</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Marker 1 present&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Is the first marker in place?&quot;</span><span class="p">),)</span>

    <span class="n">distance_to_marker1_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Distance to marker 1 (mm)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The distance to the first marker in mm.&quot;</span><span class="p">),)</span>

    <span class="n">marker2_present</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Marker 2 present&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">OBSERVATION_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">NA_VALUE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Is the second marker in place?&quot;</span><span class="p">),)</span>

    <span class="n">distance_to_marker2_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Distance to marker 2 (mm)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The distance to the second marker in mm.&quot;</span><span class="p">),)</span>

    <span class="n">habitat</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Habitat&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">HABITAT_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;na&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The habitat in which the nest was encountered.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">distance_to_vegetation_mm</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Distance to vegetation (mm)&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The distance to the beach-vegetation border in mm. &quot;</span>
                    <span class="s2">&quot;Positive values if logger is located on beach, &quot;</span>
                    <span class="s2">&quot;negative values if in vegetation.&quot;</span><span class="p">),)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Temperature Logger Deployment&quot;</span>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;Logger at </span><span class="si">{0}</span><span class="s2"> mm depth&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_mm</span><span class="p">)</span></div>


<div class="viewcode-block" id="LoggerObservation"><a class="viewcode-back" href="../../../developers.html#wastd.observations.models.LoggerObservation">[docs]</a><span class="k">class</span> <span class="nc">LoggerObservation</span><span class="p">(</span><span class="n">Observation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A logger is oobserved during an Encounter.&quot;&quot;&quot;</span>
    <span class="n">LOGGER_TYPE_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;temperature-logger&#39;</span>
    <span class="n">LOGGER_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">LOGGER_TYPE_DEFAULT</span><span class="p">,</span> <span class="s1">&#39;Temperature Logger&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;data-logger&#39;</span><span class="p">,</span> <span class="s1">&#39;Data Logger&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ctd-data-logger&#39;</span><span class="p">,</span> <span class="s1">&#39;Conductivity, Temperature, Depth SR Data Logger&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">LOGGER_STATUS_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;resighted&#39;</span>
    <span class="n">LOGGER_STATUS_NEW</span> <span class="o">=</span> <span class="s2">&quot;programmed&quot;</span>
    <span class="n">LOGGER_STATUS_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">LOGGER_STATUS_NEW</span><span class="p">,</span> <span class="s2">&quot;programmed&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;posted&quot;</span><span class="p">,</span> <span class="s2">&quot;posted to field team&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;deployed&quot;</span><span class="p">,</span> <span class="s2">&quot;deployed in situ&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;resighted&quot;</span><span class="p">,</span> <span class="s2">&quot;resighted in situ&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;retrieved&quot;</span><span class="p">,</span> <span class="s2">&quot;retrieved in situ&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;downloaded&quot;</span><span class="p">,</span> <span class="s2">&quot;downloaded&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">logger_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">LOGGER_TYPE_DEFAULT</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">LOGGER_TYPE_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The logger type.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">deployment_status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">LOGGER_STATUS_DEFAULT</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">LOGGER_STATUS_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The logger life cycle status.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">logger_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Logger ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of a logger must be unique within the tag type.&quot;</span><span class="p">),)</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comment&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Logger Observation&quot;</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2020 DBCA

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>