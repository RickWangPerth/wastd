

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>conservation.models &mdash; WAStD 0.45.10 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> WAStD
          

          
          </a>

          
            
            
              <div class="version">
                0.45
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../data_collection/data_collection_overview.html">Data collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_collection/data_collection_admin.html">Data collection administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_collection/data_collection_training.html">Data collection training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_curators.html">Data curators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_curators.html#data-upload-from-odk">Data upload from ODK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_curators.html#data-qa">Data QA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_curators.html#data-release">Data release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_consumers.html">Data consumers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../business_analysts.html">Business Analysts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../business_analysts.html#how-it-s-made-the-process">How itâ€™s made - the process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../business_analysts.html#reproducible-research">Reproducible Research</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainers.html">Application maintainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers.html">Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers.html#project-delivery-ticking-the-boxes">Project delivery: ticking the boxes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">WAStD</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>conservation.models</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for conservation.models</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">uuid</span>

<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.fields</span> <span class="kn">import</span> <span class="n">GenericForeignKey</span><span class="p">,</span> <span class="n">GenericRelation</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.contrib.gis.db</span> <span class="kn">import</span> <span class="n">models</span> <span class="k">as</span> <span class="n">geo_models</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.db.models.signals</span> <span class="kn">import</span> <span class="n">pre_save</span><span class="p">,</span> <span class="n">post_save</span>
<span class="kn">from</span> <span class="nn">django.dispatch</span> <span class="kn">import</span> <span class="n">receiver</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">django_fsm</span> <span class="kn">import</span> <span class="n">FSMIntegerField</span><span class="p">,</span> <span class="n">transition</span>
<span class="kn">from</span> <span class="nn">django_fsm_log.decorators</span> <span class="kn">import</span> <span class="n">fsm_log_by</span>

<span class="kn">from</span> <span class="nn">wastd.users.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">shared.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RenderMixin</span><span class="p">,</span>
    <span class="n">UrlsMixin</span><span class="p">,</span>
    <span class="n">CodeLabelDescriptionMixin</span><span class="p">,</span>
    <span class="n">ObservationAuditMixin</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">taxonomy.models</span> <span class="kn">import</span> <span class="n">Community</span><span class="p">,</span> <span class="n">Taxon</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="fileattachment_media"><a class="viewcode-back" href="../../developers.html#conservation.models.fileattachment_media">[docs]</a><span class="k">def</span> <span class="nf">fileattachment_media</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an upload path for fileattachment media.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;attachment/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">content_type</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileAttachment"><a class="viewcode-back" href="../../developers.html#conservation.models.FileAttachment">[docs]</a><span class="k">class</span> <span class="nc">FileAttachment</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A generic file attachment to any model.&quot;&quot;&quot;</span>

    <span class="n">attachment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="n">fileattachment_media</span><span class="p">)</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">)</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Title&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A self-explanatory title for the file attachment.&quot;</span><span class="p">))</span>

    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Author&quot;</span><span class="p">),</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;conservation_fileattachments&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The person who authored and endorsed this file.&quot;</span><span class="p">))</span>

    <span class="n">current</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Is current&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Whether this file is current or an archived version.&quot;</span><span class="p">),)</span>

    <span class="n">confidential</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Is confidential&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Whether this file is confidential or &quot;</span>
                    <span class="s2">&quot;can be released to the public.&quot;</span><span class="p">),)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="p">)</span></div>


<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Conservation (Management) Threats and Actions</span>
<div class="viewcode-block" id="ConservationThreatCategory"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationThreatCategory">[docs]</a><span class="k">class</span> <span class="nc">ConservationThreatCategory</span><span class="p">(</span><span class="n">CodeLabelDescriptionMixin</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A conservation management threat category.&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>

        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Conservation Threat Category&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Conservation Threat Categories&quot;</span></div>


<div class="viewcode-block" id="ConservationThreat"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationThreat">[docs]</a><span class="k">class</span> <span class="nc">ConservationThreat</span><span class="p">(</span><span class="n">RenderMixin</span><span class="p">,</span> <span class="n">UrlsMixin</span><span class="p">,</span> <span class="n">ObservationAuditMixin</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A conservation threat is a potentially damaging event against a taxon or community.</span>

<span class="sd">    The conservation threat can pertain to:</span>

<span class="sd">    * an entire species,</span>
<span class="sd">    * an entire community,</span>
<span class="sd">    * any combination of species and communities</span>
<span class="sd">      (as per multi-species management plans),</span>
<span class="sd">    * a management / recovery / interim recovery plan,</span>
<span class="sd">    * an individual occurrence (fauna site, flora population</span>
<span class="sd">      or subpopulation, TEC pr PEC boundary), or</span>
<span class="sd">    * a subset of occurrences as indicated by a multipolygon.</span>

<span class="sd">    The conservation threat is specified by:</span>

<span class="sd">    * a threat category, and</span>
<span class="sd">    * threat causes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">EHMLNN_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
    <span class="n">EHMLNN_NIL</span> <span class="o">=</span> <span class="s2">&quot;nil&quot;</span>
    <span class="n">EHMLNN_LOW</span> <span class="o">=</span> <span class="s2">&quot;low&quot;</span>
    <span class="n">EHMLNN_MEDIUM</span> <span class="o">=</span> <span class="s2">&quot;medium&quot;</span>
    <span class="n">EHMLNN_HIGH</span> <span class="o">=</span> <span class="s2">&quot;high&quot;</span>
    <span class="n">EHMLNN_EXTREME</span> <span class="o">=</span> <span class="s2">&quot;extreme&quot;</span>
    <span class="n">EHMLNN_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">EHMLNN_DEFAULT</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;NA&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">EHMLNN_NIL</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Nil&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">EHMLNN_LOW</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Low&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">EHMLNN_MEDIUM</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Medium&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">EHMLNN_HIGH</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;High&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">EHMLNN_EXTREME</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Extreme&quot;</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="n">LMSN_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
    <span class="n">LSMN_SHORT</span> <span class="o">=</span> <span class="s2">&quot;short-term&quot;</span>
    <span class="n">LSMN_MEDIUM</span> <span class="o">=</span> <span class="s2">&quot;medium-term&quot;</span>
    <span class="n">LSMN_LONG</span> <span class="o">=</span> <span class="s2">&quot;long-term&quot;</span>
    <span class="n">LMSN_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">LMSN_DEFAULT</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;NA&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">LSMN_SHORT</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;(S)hort term: Within 12 months&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">LSMN_MEDIUM</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;(M)edium term: Within 1 to 5 years&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">LSMN_LONG</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;(L)ong term: after 5 years&quot;</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="c1"># Pertains to</span>
    <span class="n">taxa</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">Taxon</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Taxa&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;All taxa this conservation threat pertains to.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">communities</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">Community</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Communities&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;All communities this conservation threat pertains to.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">document</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Plan document&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The document in which this conservation threat is specified.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">target_area</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">MultiPolygonField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Target Area&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;If this action pertains to only some but not all occurrences, &quot;</span>
                    <span class="s2">&quot;indicate the target area(s) here. This management action will &quot;</span>
                    <span class="s2">&quot;be automatically affiliated with all intersecting occurrence areas.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">occurrence_area_code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Occurence area code&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The known code for the occurrence area this &quot;</span>
                    <span class="s2">&quot;conservation threat pertains to, e.g. a Fauna site, &quot;</span>
                    <span class="s2">&quot;a Flora (sub)population ID, or a TEC/PEC boundary name.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Threat</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">ConservationThreatCategory</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Threat category&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Choose the overarching category.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">cause</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Threat cause&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Describe the threat cause or agent.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">area_affected_percent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span>
        <span class="n">max_digits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">decimal_places</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Area affected [%]&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The estimated percentage (0-100) of the &quot;</span>
                    <span class="s2">&quot;specified occurrence area affected by this threat.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">current_impact</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Current Impact&quot;</span><span class="p">),</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">EHMLNN_DEFAULT</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">EHMLNN_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Current impact of threat on specified subjects.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">potential_impact</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Potential Impact&quot;</span><span class="p">),</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">EHMLNN_DEFAULT</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">EHMLNN_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Potential impact of threat on specified subjects.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">potential_onset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Potential Onset&quot;</span><span class="p">),</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">LMSN_DEFAULT</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">LMSN_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Potential onset of threat on specified subjects.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>

        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Conservation Threat&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Conservation Threats&quot;</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;cause&quot;</span><span class="p">,</span> <span class="p">]</span>
        <span class="n">index_together</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="s2">&quot;occurrence_area_code&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;cause&quot;</span><span class="p">,</span> <span class="p">],</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cause</span><span class="p">)</span></div>


<div class="viewcode-block" id="ConservationActionCategory"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationActionCategory">[docs]</a><span class="k">class</span> <span class="nc">ConservationActionCategory</span><span class="p">(</span><span class="n">CodeLabelDescriptionMixin</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A conservation management action category.&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>

        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Conservation Action Category&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Conservation Action Categories&quot;</span></div>


<div class="viewcode-block" id="ConservationAction"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationAction">[docs]</a><span class="k">class</span> <span class="nc">ConservationAction</span><span class="p">(</span><span class="n">RenderMixin</span><span class="p">,</span> <span class="n">UrlsMixin</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A conservation action is an intended conservation management measure.</span>

<span class="sd">    The conservation action can pertain to:</span>

<span class="sd">    * an entire species,</span>
<span class="sd">    * an entire community,</span>
<span class="sd">    * any combination of species and communities</span>
<span class="sd">      (as per multi-species management plans),</span>
<span class="sd">    * a management / recovery / interim recovery plan,</span>
<span class="sd">    * an individual occurrence (fauna site, flora population</span>
<span class="sd">      or subpopulation, TEC pr PEC boundary), or</span>
<span class="sd">    * a subset of occurrences as indicated by a multipolygon.</span>

<span class="sd">    The conservation action intent is specified by:</span>

<span class="sd">    * an action category, and</span>
<span class="sd">    * implementation instructions.</span>

<span class="sd">    The partial or complete implementation is documented by:</span>

<span class="sd">    * instructions,</span>
<span class="sd">    * completion date,</span>
<span class="sd">    * expenditure.</span>

<span class="sd">    A conservation action has an implicit life cycle:</span>

<span class="sd">    * new - no implementation notes,</span>
<span class="sd">    * stale - implementation notes, but no changes in current fiscal year,</span>
<span class="sd">    * in progress - implementation notes, changed in current fiscal year,</span>
<span class="sd">    * complete - completion date set.</span>

<span class="sd">    Attachments can be added to capture e.g. communication records with stakeholders,</span>
<span class="sd">    reports on implementation outcomes and any other supporting information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">STATUS_NEW</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">STATUS_STALE</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">STATUS_INPROGRESS</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">STATUS_COMPLETED</span> <span class="o">=</span> <span class="mi">40</span>

    <span class="n">STATUS_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">STATUS_NEW</span><span class="p">,</span> <span class="s2">&quot;New&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_STALE</span><span class="p">,</span> <span class="s2">&quot;Stale&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_INPROGRESS</span><span class="p">,</span> <span class="s2">&quot;In progress&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_COMPLETED</span><span class="p">,</span> <span class="s2">&quot;Completed&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Pertains to</span>
    <span class="n">taxa</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">Taxon</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Taxa&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;All taxa this conservation action pertains to.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">communities</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">Community</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Communities&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;All communities this conservation action pertains to.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">document</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Plan document&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The document in which this conservation action is specified.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">target_area</span> <span class="o">=</span> <span class="n">geo_models</span><span class="o">.</span><span class="n">MultiPolygonField</span><span class="p">(</span>
        <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Target Area&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;If this action pertains to only some but not all occurrences, &quot;</span>
                    <span class="s2">&quot;indicate the target area(s) here. This conservation action will &quot;</span>
                    <span class="s2">&quot;be automatically affiliated with all intersecting occurrence areas.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">occurrence_area_code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Occurence area code&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The known code for the occurrence area this &quot;</span>
                    <span class="s2">&quot;conservation action pertains to, either a Fauna site, &quot;</span>
                    <span class="s2">&quot;a Flora (sub)population ID, or a TEC/PEC boundary name.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Intent</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">ConservationActionCategory</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Conservation action category&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Choose the overarching category.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">instructions</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Instructions&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Details on the intended implementation.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Implementation</span>
    <span class="n">implementation_notes</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Implementation notes&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Add notes as appropriate once the implementation is in progress. &quot;</span>
                    <span class="s2">&quot;Separate progress from different fiscal years in paragraphs. &quot;</span>
                    <span class="s2">&quot;If this conservation action requires several separate activities, &quot;</span>
                    <span class="s2">&quot;consider reporting a them separately as conservation activities.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">completion_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Completion date&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Set once the action is completed.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">expenditure</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span>
        <span class="n">max_digits</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Expenditure&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The running tally of budget expended as sum of reported activities.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Completion status&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">STATUS_NEW</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">STATUS_CHOICES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Completion status.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">attachments</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">FileAttachment</span><span class="p">,</span> <span class="n">object_id_field</span><span class="o">=</span><span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>

        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Conservation Action&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Conservation Actions&quot;</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;completion_date&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="p">]</span>
        <span class="n">index_together</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;completion_date&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="s2">&quot;occurrence_area_code&quot;</span><span class="p">],</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># django-fsm QA status</span>
<div class="viewcode-block" id="ConservationAction.get_status"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationAction.get_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a string indicating the progress status.</span>

<span class="sd">        * If completion date exists and in the past: completed</span>
<span class="sd">        * If cons activities added: in progress</span>
<span class="sd">        * If impl notes added: in progress</span>
<span class="sd">        * else: new.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">completion_date</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">completion_date</span> <span class="o">&lt;=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ConservationAction</span><span class="o">.</span><span class="n">STATUS_COMPLETED</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">conservationactivity_set</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ConservationAction</span><span class="o">.</span><span class="n">STATUS_INPROGRESS</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">implementation_notes</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ConservationAction</span><span class="o">.</span><span class="n">STATUS_INPROGRESS</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ConservationAction</span><span class="o">.</span><span class="n">STATUS_NEW</span></div></div>


<div class="viewcode-block" id="update_status_cache"><a class="viewcode-back" href="../../developers.html#conservation.models.update_status_cache">[docs]</a><span class="nd">@receiver</span><span class="p">(</span><span class="n">pre_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">ConservationAction</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">update_status_cache</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ConservationAction: Cache expensive lookups.</span>

<span class="sd">    * Derive status</span>
<span class="sd">    * Calculate total expenditure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationAction.update_status_cache] Deriving completion status.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">completion_date</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">completion_date</span><span class="p">)</span> <span class="o">==</span> <span class="n">datetime</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">completion_date</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">completion_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">expenditure</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">conservationactivity_set</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
        <span class="n">models</span><span class="o">.</span><span class="n">Sum</span><span class="p">(</span><span class="s1">&#39;expenditure&#39;</span><span class="p">))[</span><span class="s1">&#39;expenditure__sum&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="ConservationActivity"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationActivity">[docs]</a><span class="k">class</span> <span class="nc">ConservationActivity</span><span class="p">(</span><span class="n">UrlsMixin</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An implementation of a conservation management measure.&quot;&quot;&quot;</span>

    <span class="n">conservation_action</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">ConservationAction</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span>
    <span class="p">)</span>

    <span class="n">implementation_notes</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Implementation notes&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Describe the executed work.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">completion_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Completion date&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date on which this activity was completed.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">expenditure</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span>
        <span class="n">max_digits</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Expenditure&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The estimated cost of this activity.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">attachments</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">FileAttachment</span><span class="p">,</span> <span class="n">object_id_field</span><span class="o">=</span><span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>

        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Conservation Activity&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Conservation Activities&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">][</span><span class="si">{1}</span><span class="s2">] </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conservation_action</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">completion_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">completion_date</span> <span class="k">else</span> <span class="s2">&quot;in progress&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">implementation_notes</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># URLs</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">absolute_admin_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the absolute admin change URL.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conservation_action</span><span class="o">.</span><span class="n">absolute_admin_url</span>

<div class="viewcode-block" id="ConservationActivity.list_url"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationActivity.list_url">[docs]</a>    <span class="k">def</span> <span class="nf">list_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Conservation action detail url lists its cons activities.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conservation_action</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span></div>

<div class="viewcode-block" id="ConservationActivity.get_absolute_url"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationActivity.get_absolute_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Detail url.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conservation_action</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span></div>

<div class="viewcode-block" id="ConservationActivity.create_url"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationActivity.create_url">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_url</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">conservation_action</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create url. Required args: a conservation action instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;conservation:conservationactivity-create&#39;</span><span class="p">,</span>
                       <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pk&#39;</span><span class="p">:</span> <span class="n">conservation_action</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span></div></div>


<div class="viewcode-block" id="update_consaction_caches"><a class="viewcode-back" href="../../developers.html#conservation.models.update_consaction_caches">[docs]</a><span class="nd">@receiver</span><span class="p">(</span><span class="n">post_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">ConservationActivity</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">update_consaction_caches</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ConservationActivity: Update Conservation Action status and budget cache.</span>

<span class="sd">    * Derive status</span>
<span class="sd">    * Calculate total expenditure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationAction.update_caches] Updating cached fields.&quot;</span><span class="p">)</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">conservation_action</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>


<div class="viewcode-block" id="ConservationList"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationList">[docs]</a><span class="k">class</span> <span class="nc">ConservationList</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A Conservation List like BCA, EPBC, RedList.&quot;&quot;&quot;</span>

    <span class="n">APPROVAL_IMMEDIATE</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">APPROVAL_PANEL</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">APPROVAL_DIRECTOR</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">APPROVAL_MINISTER</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="n">APPROVAL_LEVELS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">APPROVAL_IMMEDIATE</span><span class="p">,</span> <span class="s1">&#39;Immediate&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">APPROVAL_PANEL</span><span class="p">,</span> <span class="s1">&#39;Panel&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">APPROVAL_DIRECTOR</span><span class="p">,</span> <span class="s1">&#39;Director&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">APPROVAL_MINISTER</span><span class="p">,</span> <span class="s1">&#39;Minister&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Code&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A Conservation List code.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Label&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;An explanatory label.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A comprehensive description.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">active_from</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Active from&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date and time from which this list is current.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">active_to</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Active to&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date and time from which this list is non-current.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">scope_wa</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Applies to WA&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Whether this list is applicable state-wide.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">scope_cmw</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Applies to Commonwealth&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Whether this list is applicable nation-wide.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">scope_intl</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Applies Internationally&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Whether this list is applicable internationally.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">scope_species</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Applies to Species&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Whether this list is applicable to individual species.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">scope_communities</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Applies to Communities&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Whether this list is applicable to ecological communities.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">approval_level</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Approval Level&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">APPROVAL_MINISTER</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">APPROVAL_LEVELS</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;What is the highest required approval instance for this list?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>

        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Conservation List&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Conservation Lists&quot;</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-active_from&quot;</span><span class="p">,</span> <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># URLs</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">absolute_admin_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the absolute admin change URL.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;admin:</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">_change&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span></div>


<div class="viewcode-block" id="ConservationCategory"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationCategory">[docs]</a><span class="k">class</span> <span class="nc">ConservationCategory</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A Conservation Category like CR, EN, VU.&quot;&quot;&quot;</span>

    <span class="n">LEVEL_EXTINCT</span> <span class="o">=</span> <span class="s2">&quot;extinct&quot;</span>
    <span class="n">LEVEL_COLLAPSED</span> <span class="o">=</span> <span class="s2">&quot;collapsed&quot;</span>
    <span class="n">LEVEL_THREATENED</span> <span class="o">=</span> <span class="s2">&quot;threatened&quot;</span>
    <span class="n">LEVEL_PRIORITY</span> <span class="o">=</span> <span class="s2">&quot;priority&quot;</span>
    <span class="n">LEVEL_OTHER</span> <span class="o">=</span> <span class="s2">&quot;other&quot;</span>
    <span class="n">LEVEL_SPECIALLY_PROTECTED</span> <span class="o">=</span> <span class="s2">&quot;specially-protected&quot;</span>
    <span class="n">LEVEL_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">LEVEL_EXTINCT</span><span class="p">,</span> <span class="s2">&quot;Extinct&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LEVEL_COLLAPSED</span><span class="p">,</span> <span class="s2">&quot;Collapsed&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LEVEL_THREATENED</span><span class="p">,</span> <span class="s2">&quot;Threatened&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LEVEL_SPECIALLY_PROTECTED</span><span class="p">,</span> <span class="s2">&quot;Specially Protected&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LEVEL_OTHER</span><span class="p">,</span> <span class="s2">&quot;Other&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LEVEL_PRIORITY</span><span class="p">,</span> <span class="s2">&quot;Priority&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">SHORTCODE_OTHER</span> <span class="o">=</span> <span class="s2">&quot;O&quot;</span>
    <span class="n">SHORTCODE_EXTINCT</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span>
    <span class="n">SHORTCODE_COLLAPSED</span> <span class="o">=</span> <span class="s2">&quot;CO&quot;</span>
    <span class="n">SHORTCODE_THREATENED</span> <span class="o">=</span> <span class="s2">&quot;T&quot;</span>
    <span class="n">SHORTCODE_SPECIALLY_PROTECTED</span> <span class="o">=</span> <span class="s2">&quot;SP&quot;</span>
    <span class="n">SHORTCODE_P1</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
    <span class="n">SHORTCODE_P2</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
    <span class="n">SHORTCODE_P3</span> <span class="o">=</span> <span class="s2">&quot;3&quot;</span>
    <span class="n">SHORTCODE_P4</span> <span class="o">=</span> <span class="s2">&quot;4&quot;</span>
    <span class="n">SHORTCODE_P5</span> <span class="o">=</span> <span class="s2">&quot;5&quot;</span>
    <span class="n">SHORTCODE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">SHORTCODE_EXTINCT</span><span class="p">,</span> <span class="s2">&quot;Extinct&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SHORTCODE_COLLAPSED</span><span class="p">,</span> <span class="s2">&quot;Collapsed&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SHORTCODE_THREATENED</span><span class="p">,</span> <span class="s2">&quot;Threatened&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SHORTCODE_SPECIALLY_PROTECTED</span><span class="p">,</span> <span class="s2">&quot;Specially Protected&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SHORTCODE_OTHER</span><span class="p">,</span> <span class="s2">&quot;Other&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SHORTCODE_P1</span><span class="p">,</span> <span class="s2">&quot;Priority 1&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SHORTCODE_P2</span><span class="p">,</span> <span class="s2">&quot;Priority 2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SHORTCODE_P3</span><span class="p">,</span> <span class="s2">&quot;Priority 3&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SHORTCODE_P4</span><span class="p">,</span> <span class="s2">&quot;Priority 4&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SHORTCODE_P5</span><span class="p">,</span> <span class="s2">&quot;Priority 5&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">conservation_list</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">ConservationList</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Conservation List&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The conservation list this code is described in.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Code&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A category code, unique within its conservation list.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Label&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;An explanatory label.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A comprehensive description.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">rank</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Rank&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Display order, lowest number goes first.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">current</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Is current&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Whether this category should be shown for &quot;</span>
                    <span class="s2">&quot;new conservation listings.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">level</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">LEVEL_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">LEVEL_OTHER</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Filter group&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A convenience grouping of several conservation levels&quot;</span>
                    <span class="s2">&quot; for efficient filtering of records in TSC.&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">short_code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">SHORTCODE_CHOICES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">SHORTCODE_OTHER</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;FloraBase Code&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A conservation code exported to FloraBase&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;conservation_list&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">)</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;conservation_list&quot;</span><span class="p">,</span> <span class="s2">&quot;rank&quot;</span><span class="p">]</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Conservation Category&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Conservation Categories&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] </span><span class="si">{1}</span><span class="s2"> (</span><span class="si">{2}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conservation_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_level_display</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span>
        <span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># URLs</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">absolute_admin_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the absolute admin change URL.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;admin:</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">_change&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span></div>


<div class="viewcode-block" id="ConservationCriterion"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationCriterion">[docs]</a><span class="k">class</span> <span class="nc">ConservationCriterion</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A Conservation Criterion like A4a.&quot;&quot;&quot;</span>

    <span class="n">conservation_list</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">ConservationList</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Conservation List&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The conservation list this code is described in.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Code&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A criterion code, unique within its conservation list.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Label&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;An explanatory label.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A comprehensive description.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">rank</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Rank&quot;</span><span class="p">),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Display order, lowest number goes first.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;conservation_list&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">)</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;conservation_list&quot;</span><span class="p">,</span> <span class="s2">&quot;rank&quot;</span><span class="p">]</span>
        <span class="n">index_together</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;conservation_list&quot;</span><span class="p">,</span> <span class="s2">&quot;rank&quot;</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Conservation Criterion&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Conservation Criteria&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conservation_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># URLs</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">absolute_admin_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the absolute admin change URL.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;admin:</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">_change&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span></div>


<div class="viewcode-block" id="ActiveConservationListingManager"><a class="viewcode-back" href="../../developers.html#conservation.models.ActiveConservationListingManager">[docs]</a><span class="k">class</span> <span class="nc">ActiveConservationListingManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom ConservationListing manager to return only active ConservationListings.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ActiveConservationListingManager.get_queryset"><a class="viewcode-back" href="../../developers.html#conservation.models.ActiveConservationListingManager.get_queryset">[docs]</a>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return only active ConservationListings.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_EFFECTIVE</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="ActiveStateConservationListingManager"><a class="viewcode-back" href="../../developers.html#conservation.models.ActiveStateConservationListingManager">[docs]</a><span class="k">class</span> <span class="nc">ActiveStateConservationListingManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom ConservationListing manager to return only active ConservationListings in WA.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ActiveStateConservationListingManager.get_queryset"><a class="viewcode-back" href="../../developers.html#conservation.models.ActiveStateConservationListingManager.get_queryset">[docs]</a>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return only active ConservationListings.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_EFFECTIVE</span><span class="p">,</span>
            <span class="n">scope</span><span class="o">=</span><span class="n">ConservationListing</span><span class="o">.</span><span class="n">SCOPE_WESTERN_AUSTRALIA</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="ActiveNationalConservationListingManager"><a class="viewcode-back" href="../../developers.html#conservation.models.ActiveNationalConservationListingManager">[docs]</a><span class="k">class</span> <span class="nc">ActiveNationalConservationListingManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom ConservationListing manager to return only active ConservationListings in CWTH.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ActiveNationalConservationListingManager.get_queryset"><a class="viewcode-back" href="../../developers.html#conservation.models.ActiveNationalConservationListingManager.get_queryset">[docs]</a>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return only active ConservationListings.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_EFFECTIVE</span><span class="p">,</span>
            <span class="n">scope</span><span class="o">=</span><span class="n">ConservationListing</span><span class="o">.</span><span class="n">SCOPE_COMMONWEALTH</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="ConservationListing"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing">[docs]</a><span class="k">class</span> <span class="nc">ConservationListing</span><span class="p">(</span><span class="n">RenderMixin</span><span class="p">,</span> <span class="n">UrlsMixin</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The allocation of one or more ConservationCategories and Criteria.</span>

<span class="sd">    Approval state is tracked as django-fsm field.</span>
<span class="sd">    ConservationCategory can change during approval process.</span>
<span class="sd">    Inheritance can override transitions.</span>

<span class="sd">    Documents are attached as MediaAttachments.</span>

<span class="sd">    Some conservation categories are mutually exclusiver than others.</span>
<span class="sd">    To prevent invalid combinations of ConservationCategories,</span>
<span class="sd">    the transition to ConservationListing.STATUS_EFFECTIVE must take care of</span>
<span class="sd">    closing just the mutually exclusive ones.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">STATUS_PROPOSED</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">STATUS_IN_EXPERT_REVIEW</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">STATUS_IN_PUBLIC_REVIEW</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">STATUS_IN_PANEL_REVIEW</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">STATUS_IN_BM_REVIEW</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">STATUS_IN_DIR_REVIEW</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">STATUS_IN_DG_REVIEW</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">STATUS_IN_MIN_REVIEW</span> <span class="o">=</span> <span class="mi">70</span>
    <span class="n">STATUS_EFFECTIVE</span> <span class="o">=</span> <span class="mi">80</span>
    <span class="n">STATUS_CLOSED</span> <span class="o">=</span> <span class="mi">90</span>
    <span class="n">STATUS_REJECTED</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">APPROVAL_STATUS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span> <span class="s2">&quot;Proposed&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with experts&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with public&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with panel&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with Branch Manager&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with Division Director&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with Director General&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_MIN_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with Minister&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_EFFECTIVE</span><span class="p">,</span> <span class="s2">&quot;Listed&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_CLOSED</span><span class="p">,</span> <span class="s2">&quot;De-listed&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_REJECTED</span><span class="p">,</span> <span class="s2">&quot;Rejected&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">SOURCE_MANUAL_ENTRY</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">SOURCE_THREATENED_FAUNA</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SOURCE_THREATENED_FLORA</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">SOURCE_THREATENED_COMMUNITIES</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="n">SOURCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">SOURCE_MANUAL_ENTRY</span><span class="p">,</span> <span class="s1">&#39;Manual entry&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SOURCE_THREATENED_FAUNA</span><span class="p">,</span> <span class="s1">&#39;Threatened Fauna&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SOURCE_THREATENED_FLORA</span><span class="p">,</span> <span class="s1">&#39;Threatened Flora&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SOURCE_THREATENED_COMMUNITIES</span><span class="p">,</span> <span class="s1">&#39;Threatened Communities&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">SCOPE_WESTERN_AUSTRALIA</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">SCOPE_COMMONWEALTH</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SCOPE_INTERNATIONAL</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">SCOPE_ACTION_PLAN</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="n">SCOPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">SCOPE_WESTERN_AUSTRALIA</span><span class="p">,</span> <span class="s1">&#39;WA&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SCOPE_COMMONWEALTH</span><span class="p">,</span> <span class="s1">&#39;CWTH&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SCOPE_INTERNATIONAL</span><span class="p">,</span> <span class="s1">&#39;IUCN&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SCOPE_ACTION_PLAN</span><span class="p">,</span> <span class="s1">&#39;AP&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Data Source&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">SOURCE_MANUAL_ENTRY</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">SOURCES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Where was this record captured initially?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">source_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">(),</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Source ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of the record in the original source, if available.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">scope</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Scope&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">SCOPE_WESTERN_AUSTRALIA</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">SCOPES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;In which legislation does this ConservationListing apply?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="c1"># Conservation status</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">ConservationCategory</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Conservation Categories&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The Conservation Categories can change during the approval process.&quot;</span>
                    <span class="s2">&quot; Some combinations are valid, some are not.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">criteria</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">ConservationCriterion</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Conservation Criteria&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The Conservation Criteria form the reason &quot;</span>
                    <span class="s2">&quot;for the choice of conservation categories.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Approval status</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">FSMIntegerField</span><span class="p">(</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">APPROVAL_STATUS</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Approval status&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The approval status of the Conservation Listing.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Approval milestones</span>
    <span class="n">proposed_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Proposed on&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date and time this Conservation Listing was proposed on.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">effective_from</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Effective from&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date printed on the Departmental ConservationListing notice &quot;</span>
                    <span class="s2">&quot;containing this Conservation Listing.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">effective_to</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Effective to&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date and time this Conservation Listing was de-listed or &quot;</span>
                    <span class="s2">&quot;otherwise ceased to be in effect.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">last_reviewed_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Last reviewed on&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date and time this Conservation Listing was last reviewed.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">review_due</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Review due date&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date and time this Conservation Listing should be reviewed.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Approval process log</span>
    <span class="n">comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Append comments on approval process as appropriate.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Cache fields</span>
    <span class="n">category_cache</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Category list&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;An auto-generated list of conservation categories.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">criteria_cache</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Criteria list&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;An auto-generated list of conservation criteria.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">label_cache</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;ConservationListing label&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;An auto-generated label for the Conservation Listing.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
    <span class="n">active</span> <span class="o">=</span> <span class="n">ActiveConservationListingManager</span><span class="p">()</span>
    <span class="n">active_state</span> <span class="o">=</span> <span class="n">ActiveStateConservationListingManager</span><span class="p">()</span>
    <span class="n">active_national</span> <span class="o">=</span> <span class="n">ActiveNationalConservationListingManager</span><span class="p">()</span>

<div class="viewcode-block" id="ConservationListing.Meta"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>

        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;effective_from&#39;</span><span class="p">,</span> <span class="p">]</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># URLs</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">absolute_admin_add_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the absolute admin add URL.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;admin:</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">_add&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">))</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Derived properties</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">build_category_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build a string of all attached categories.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">all</span><span class="p">()])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">build_criteria_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build a string of all attached criteria.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">code</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">criteria</span><span class="o">.</span><span class="n">all</span><span class="p">()])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">build_label_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the category and criteria cache.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_scope_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_category_cache</span>
        <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_approval_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the highest required approval level of all categories.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">conservation_list</span><span class="o">.</span><span class="n">approval_level</span>
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">all</span><span class="p">()])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if status currently in effect.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_EFFECTIVE</span>

    <span class="c1"># ------------------------------------------------------------------------#</span>
    <span class="c1"># Django-FSM transitions</span>
    <span class="c1"># ALL -&gt; STATUS_PROPOSED -------------------------------------------------#</span>
<div class="viewcode-block" id="ConservationListing.can_recall_to_proposed"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.can_recall_to_proposed">[docs]</a>    <span class="k">def</span> <span class="nf">can_recall_to_proposed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow always to reset to the initial status.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ConservationListing.recall_to_proposed"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.recall_to_proposed">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_MIN_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_EFFECTIVE</span><span class="p">,</span>
                <span class="n">STATUS_CLOSED</span><span class="p">,</span>
                <span class="n">STATUS_REJECTED</span><span class="p">],</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_recall_to_proposed</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_recall_to_proposed&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">recall_to_proposed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset a new ConservationListing to status &quot;new&quot; (proposed).</span>

<span class="sd">        This transition allows to reset any ConservationListing to status &quot;new&quot;</span>
<span class="sd">        (before any endorsement) to start over freshly.</span>
<span class="sd">        This operation is equivalent to starting a new ConservationListing.</span>

<span class="sd">        Source: all but STATUS_PROPOSED</span>
<span class="sd">        Target: STATUS_PROPOSED</span>
<span class="sd">        Permissions: staff</span>
<span class="sd">        Gatecheck: can_recall_to_proposed (pass)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] recall_to_proposed&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_PROPOSED -&gt; STATUS_IN_EXPERT_REVIEW -----------------------------#</span>
<div class="viewcode-block" id="ConservationListing.can_submit_for_expert_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.can_submit_for_expert_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_expert_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Require if any categories are of min approval level APPROVAL_PANEL.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_approval_level</span> <span class="o">&gt;=</span> <span class="n">ConservationList</span><span class="o">.</span><span class="n">APPROVAL_PANEL</span></div>

<div class="viewcode-block" id="ConservationListing.submit_for_expert_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.submit_for_expert_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_expert_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_submit_for_expert_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_expert_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for expert review.</span>

<span class="sd">        Source: STATUS_PROPOSED</span>
<span class="sd">        Target: STATUS_IN_EXPERT_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires panel approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_expert_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># PROPOSED / IN_EXPERT_REVIEW -&gt; STATUS_IN_PUBLIC_REVIEW -----------------#</span>
<div class="viewcode-block" id="ConservationListing.can_submit_for_public_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.can_submit_for_public_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_public_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Only categories of max approval level APPROVAL_PANEL require this step.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_approval_level</span> <span class="o">&gt;=</span> <span class="n">ConservationList</span><span class="o">.</span><span class="n">APPROVAL_PANEL</span></div>

<div class="viewcode-block" id="ConservationListing.submit_for_public_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.submit_for_public_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span> <span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">],</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_public_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_submit_for_expert_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_public_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for public review.</span>

<span class="sd">        Source: STATUS_PROPOSED, STATUS_IN_EXPERT_REVIEW</span>
<span class="sd">        Target: STATUS_IN_PUBLIC_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires panel approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_public_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_PROPOSED, STATUS_IN_EXPERT_REVIEW, STATUS_IN_PUBLIC_REVIEW -&gt;</span>
    <span class="c1"># STATUS_IN_PANEL_REVIEW  ------------------------------------------------#</span>
<div class="viewcode-block" id="ConservationListing.can_submit_for_panel_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.can_submit_for_panel_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_panel_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Only categories of max approval level APPROVAL_PANEL require this step.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_approval_level</span> <span class="o">&gt;=</span> <span class="n">ConservationList</span><span class="o">.</span><span class="n">APPROVAL_PANEL</span></div>

<div class="viewcode-block" id="ConservationListing.submit_for_panel_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.submit_for_panel_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span> <span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span> <span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">],</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_panel_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_submit_for_panel_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_panel_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for panel review.</span>

<span class="sd">        A proposed review can optionally go to an expert, to the public,</span>
<span class="sd">        or go directly for panel review.</span>

<span class="sd">        Source: STATUS_PROPOSED, STATUS_IN_EXPERT_REVIEW, STATUS_IN_PUBLIC_REVIEW</span>
<span class="sd">        Target: STATUS_IN_PANEL_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires panel approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_panel_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_IN_PANEL_REVIEW -&gt; STATUS_IN_BM_REVIEW --------------------------#</span>
<div class="viewcode-block" id="ConservationListing.can_submit_for_bm_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.can_submit_for_bm_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_bm_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Only categories of approval level APPROVAL_MINISTER require this step.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_approval_level</span> <span class="o">==</span> <span class="n">ConservationList</span><span class="o">.</span><span class="n">APPROVAL_MINISTER</span></div>

<div class="viewcode-block" id="ConservationListing.submit_for_bm_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.submit_for_bm_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_panel_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.submit_for_bm_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_bm_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for Branch Manager review once panel endorses.</span>

<span class="sd">        Source: STATUS_IN_PANEL_REVIEW</span>
<span class="sd">        Target: STATUS_IN_BM_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires ministerial approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_bm_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_IN_BM_REVIEW -&gt; STATUS_IN_DIR_REVIEW ----------------------------#</span>
<div class="viewcode-block" id="ConservationListing.can_submit_for_dir_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.can_submit_for_dir_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_dir_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Only categories of approval level APPROVAL_MINISTER require this step.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_approval_level</span> <span class="o">==</span> <span class="n">ConservationList</span><span class="o">.</span><span class="n">APPROVAL_MINISTER</span></div>

<div class="viewcode-block" id="ConservationListing.submit_for_director_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.submit_for_director_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_dir_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_submit_for_dir_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_director_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for Dir BCS review once BM endorses.</span>

<span class="sd">        Source: STATUS_IN_BM_REVIEW</span>
<span class="sd">        Target: STATUS_IN_DIR_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires ministerial approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_director_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_IN_DIR_REVIEW -&gt; STATUS_IN_DG_REVIEW ----------------------------#</span>
<div class="viewcode-block" id="ConservationListing.can_submit_for_dg_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.can_submit_for_dg_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_dg_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Only categories of approval level APPROVAL_MINISTER require this step.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_approval_level</span> <span class="o">==</span> <span class="n">ConservationList</span><span class="o">.</span><span class="n">APPROVAL_MINISTER</span></div>

<div class="viewcode-block" id="ConservationListing.submit_for_director_general_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.submit_for_director_general_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_dg_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_submit_for_dg_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_director_general_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for DG review once Director endorses.</span>

<span class="sd">        Source: STATUS_IN_DIR_REVIEW</span>
<span class="sd">        Target: STATUS_IN_DG_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires ministerial approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_director_general_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_IN_DG_REVIEW -&gt; STATUS_IN_MIN_REVIEW ----------------------------#</span>
<div class="viewcode-block" id="ConservationListing.can_submit_for_minister_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.can_submit_for_minister_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_minister_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Only categories of approval level APPROVAL_MINISTER require this step.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_approval_level</span> <span class="o">==</span> <span class="n">ConservationList</span><span class="o">.</span><span class="n">APPROVAL_MINISTER</span></div>

<div class="viewcode-block" id="ConservationListing.submit_for_minister_review"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.submit_for_minister_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_MIN_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_minister_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_submit_for_dg_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_minister_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for DG review once Director endorses.</span>

<span class="sd">        Source: STATUS_IN_DG_REVIEW</span>
<span class="sd">        Target: STATUS_IN_MIN_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires ministerial approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_minister_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># ALL -&gt; STATUS_EFFECTIVE -------------------------------------------------#</span>
<div class="viewcode-block" id="ConservationListing.can_mark_gazetted"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.can_mark_gazetted">[docs]</a>    <span class="k">def</span> <span class="nf">can_mark_gazetted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gatecheck for mark_gazetted.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="c1"># @fsm_log_by</span>
    <span class="c1"># @transition(</span>
    <span class="c1">#     field=status,</span>
    <span class="c1">#     source=&#39;*&#39;,</span>
    <span class="c1">#     target=STATUS_EFFECTIVE,</span>
    <span class="c1">#     conditions=[can_mark_gazetted],</span>
    <span class="c1">#     # permission=&#39;conservation.can_mark_gazetted&#39;</span>
    <span class="c1"># )</span>
    <span class="c1"># def mark_gazetted(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Mark a conservation listing as gazetted.</span>

    <span class="c1">#     This transition allows any source status to fast-track any ConservationListing.</span>

    <span class="c1">#     Source: all but STATUS_EFFECTIVE</span>
    <span class="c1">#     Target: STATUS_EFFECTIVE</span>
    <span class="c1">#     Permissions: curators</span>
    <span class="c1">#     Gatecheck: can_mark_gazetted (pass)</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     logger.info(&quot;[ConservationListing status] you should override this method to &quot;</span>
    <span class="c1">#                 &quot;close other Tax/ComConservationListings in same scope.&quot;)</span>

    <span class="c1"># STATUS_* -&gt; STATUS_CLOSED ----------------------------------------------#</span>
<div class="viewcode-block" id="ConservationListing.can_mark_delisted"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.can_mark_delisted">[docs]</a>    <span class="k">def</span> <span class="nf">can_mark_delisted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gatecheck for mark_delisted.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ConservationListing.mark_delisted"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.mark_delisted">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span>
                <span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_MIN_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_EFFECTIVE</span><span class="p">],</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_CLOSED</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_mark_delisted</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_mark_delisted&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">mark_delisted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mark a conservation listing as de-listed.</span>

<span class="sd">        This can either happen if a new conservation listing is gazetted,</span>
<span class="sd">        or if a conservation listing is de-listed without a superseding new listing.</span>

<span class="sd">        Source: all</span>
<span class="sd">        Target: STATUS_CLOSED</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: can_mark_delisted (pass)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] mark_delisted&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_* -&gt; STATUS_CLOSED ----------------------------------------------#</span>
<div class="viewcode-block" id="ConservationListing.can_mark_rejected"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.can_mark_rejected">[docs]</a>    <span class="k">def</span> <span class="nf">can_mark_rejected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gatecheck for mark_rejected.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ConservationListing.mark_rejected"><a class="viewcode-back" href="../../developers.html#conservation.models.ConservationListing.mark_rejected">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span>
                <span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_MIN_REVIEW</span><span class="p">],</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_REJECTED</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_mark_rejected</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_mark_rejected&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">mark_rejected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mark a conservation listing as rejected.</span>

<span class="sd">        This can happen in any review stage.</span>

<span class="sd">        Source: all review stages</span>
<span class="sd">        Target: STATUS_REJECTED</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: can_mark_rejected (pass)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] mark_rejected&quot;</span><span class="p">)</span></div></div>

    <span class="c1"># end Django-FSM</span>
    <span class="c1"># ------------------------------------------------------------------------#</span>


<div class="viewcode-block" id="TaxonConservationListing"><a class="viewcode-back" href="../../developers.html#conservation.models.TaxonConservationListing">[docs]</a><span class="k">class</span> <span class="nc">TaxonConservationListing</span><span class="p">(</span><span class="n">ConservationListing</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The ConservationListing of a ConservationCategory against a Taxon.</span>

<span class="sd">    There can only be one ConservationListing per scope.</span>
<span class="sd">    Transition to &quot;gazetted&quot; shall close any other ConservationListings of same scope.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">taxon</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Taxon</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;conservation_listings&quot;</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>

        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Taxon Conservation Listing&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Taxon Conservation Listings&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2"> </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_scope_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">taxon</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">category_cache</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">criteria_cache</span>
        <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># URLs</span>
<div class="viewcode-block" id="TaxonConservationListing.list_url"><a class="viewcode-back" href="../../developers.html#conservation.models.TaxonConservationListing.list_url">[docs]</a>    <span class="k">def</span> <span class="nf">list_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subject list contains all conservation listings.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxon</span><span class="o">.</span><span class="n">list_url</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaxonConservationListing.update_url"><a class="viewcode-back" href="../../developers.html#conservation.models.TaxonConservationListing.update_url">[docs]</a>    <span class="k">def</span> <span class="nf">update_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update through subject.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolute_admin_url</span></div>

<div class="viewcode-block" id="TaxonConservationListing.get_absolute_url"><a class="viewcode-back" href="../../developers.html#conservation.models.TaxonConservationListing.get_absolute_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Detail url.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxon</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span></div>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Transitions</span>
<div class="viewcode-block" id="TaxonConservationListing.mark_gazetted"><a class="viewcode-back" href="../../developers.html#conservation.models.TaxonConservationListing.mark_gazetted">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="s1">&#39;status&#39;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_MIN_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_CLOSED</span><span class="p">],</span>
        <span class="n">target</span><span class="o">=</span><span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_EFFECTIVE</span><span class="p">,</span>
        <span class="c1"># conditions=[ConservationListing.can_mark_gazetted],</span>
        <span class="c1"># permission=&#39;conservation.can_mark_gazetted&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">mark_gazetted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mark a conservation listing as gazetted.</span>

<span class="sd">        This transition allows any source status to fast-track any ConservationListing.</span>

<span class="sd">        Source: all but STATUS_EFFECTIVE</span>
<span class="sd">        Target: STATUS_EFFECTIVE</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: can_mark_gazetted (pass)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[Taxon ConservationListing] mark_gazetted should now mark older &quot;</span>
                    <span class="s2">&quot;ConservationListings as de-listed.&quot;</span><span class="p">)</span>
        <span class="c1"># TODO fsm_log_by request.user if coming from request</span>
        <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">mark_delisted</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">taxon</span><span class="o">.</span><span class="n">conservation_listings</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_EFFECTIVE</span>
        <span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">)]</span></div></div>


<div class="viewcode-block" id="CommunityConservationListing"><a class="viewcode-back" href="../../developers.html#conservation.models.CommunityConservationListing">[docs]</a><span class="k">class</span> <span class="nc">CommunityConservationListing</span><span class="p">(</span><span class="n">ConservationListing</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The ConservationListing of a ConservationCategory against a Community.&quot;&quot;&quot;</span>

    <span class="n">community</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Community</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;conservation_listings&quot;</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>

        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Community Conservation Listing&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Community Conservation Listings&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2"> </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_scope_display</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">community</span><span class="o">.</span><span class="n">code</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">category_cache</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">criteria_cache</span>
        <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># URLs</span>
<div class="viewcode-block" id="CommunityConservationListing.list_url"><a class="viewcode-back" href="../../developers.html#conservation.models.CommunityConservationListing.list_url">[docs]</a>    <span class="k">def</span> <span class="nf">list_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subject list contains all conservation listings.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">community</span><span class="o">.</span><span class="n">list_url</span><span class="p">()</span></div>

<div class="viewcode-block" id="CommunityConservationListing.update_url"><a class="viewcode-back" href="../../developers.html#conservation.models.CommunityConservationListing.update_url">[docs]</a>    <span class="k">def</span> <span class="nf">update_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update through subject.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolute_admin_url</span></div>

<div class="viewcode-block" id="CommunityConservationListing.get_absolute_url"><a class="viewcode-back" href="../../developers.html#conservation.models.CommunityConservationListing.get_absolute_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Detail url.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">community</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span></div>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Transitions</span>
<div class="viewcode-block" id="CommunityConservationListing.mark_gazetted"><a class="viewcode-back" href="../../developers.html#conservation.models.CommunityConservationListing.mark_gazetted">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="s1">&#39;status&#39;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_IN_MIN_REVIEW</span><span class="p">,</span>
                <span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_CLOSED</span><span class="p">],</span>
        <span class="n">target</span><span class="o">=</span><span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_EFFECTIVE</span><span class="p">,</span>
        <span class="c1"># conditions=[ConservationListing.can_mark_gazetted],</span>
        <span class="c1"># permission=&#39;conservation.can_mark_gazetted&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">mark_gazetted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mark a conservation listing as gazetted.</span>

<span class="sd">        This transition allows any source status to fast-track any ConservationListing.</span>

<span class="sd">        Source: all but STATUS_EFFECTIVE</span>
<span class="sd">        Target: STATUS_EFFECTIVE</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: can_mark_gazetted (pass)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[Community ConservationListing] De-list previous &quot;</span>
                    <span class="s2">&quot;ConservationListings in same scope.&quot;</span><span class="p">)</span>
        <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">mark_delisted</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">community</span><span class="o">.</span><span class="n">conservation_listings</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">ConservationListing</span><span class="o">.</span><span class="n">STATUS_EFFECTIVE</span>
        <span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">)]</span></div></div>


<div class="viewcode-block" id="conservationlisting_caches"><a class="viewcode-back" href="../../developers.html#conservation.models.conservationlisting_caches">[docs]</a><span class="nd">@receiver</span><span class="p">(</span><span class="n">pre_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">TaxonConservationListing</span><span class="p">)</span>
<span class="nd">@receiver</span><span class="p">(</span><span class="n">pre_save</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">CommunityConservationListing</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">conservationlisting_caches</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ConservationListing: Cache expensive lookups.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing_caches] Updating cache fields.&quot;</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">category_cache</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">build_category_cache</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">criteria_cache</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">build_criteria_cache</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">label_cache</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">build_label_cache</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing_caches] New ConservationListing, re-save to populate caches.&quot;</span><span class="p">)</span></div>


<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Documents</span>
<div class="viewcode-block" id="Document"><a class="viewcode-back" href="../../developers.html#conservation.models.Document">[docs]</a><span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="n">RenderMixin</span><span class="p">,</span> <span class="n">UrlsMixin</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A Document with attachments and approval workflow.&quot;&quot;&quot;</span>

    <span class="n">TYPE_RECOVERY_PLAN</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">TYPE_INTERIM_RECOVERY_PLAN</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">TYPE_MANAGEMENT_PLAN</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">TYPE_ANIMAL_ETHICS</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">TYPE_FAUNA_TRANSLOCATION</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">TYPE_SOP</span> <span class="o">=</span> <span class="mi">40</span>

    <span class="n">TYPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">TYPE_RECOVERY_PLAN</span><span class="p">,</span> <span class="s1">&#39;Recovery Plan&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">TYPE_INTERIM_RECOVERY_PLAN</span><span class="p">,</span> <span class="s1">&#39;Interim Recovery Plan&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">TYPE_MANAGEMENT_PLAN</span><span class="p">,</span> <span class="s1">&#39;Management Plan&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">TYPE_ANIMAL_ETHICS</span><span class="p">,</span> <span class="s1">&#39;Animal Ethics Application&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">TYPE_FAUNA_TRANSLOCATION</span><span class="p">,</span> <span class="s1">&#39;Fauna Translocation Proposal&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">TYPE_SOP</span><span class="p">,</span> <span class="s1">&#39;Standard Operating Procedure&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">STATUS_PROPOSED</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">STATUS_IN_EXPERT_REVIEW</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">STATUS_IN_PUBLIC_REVIEW</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">STATUS_IN_PANEL_REVIEW</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">STATUS_IN_BM_REVIEW</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">STATUS_IN_REGIONAL_REVIEW</span> <span class="o">=</span> <span class="mi">45</span>
    <span class="n">STATUS_IN_DIR_REVIEW</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">STATUS_IN_DG_REVIEW</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">STATUS_IN_MIN_REVIEW</span> <span class="o">=</span> <span class="mi">70</span>
    <span class="n">STATUS_EFFECTIVE</span> <span class="o">=</span> <span class="mi">80</span>
    <span class="n">STATUS_ADOPTED_COMMONWEALTH</span> <span class="o">=</span> <span class="mi">85</span>
    <span class="n">STATUS_CLOSED</span> <span class="o">=</span> <span class="mi">90</span>
    <span class="n">STATUS_REJECTED</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">APPROVAL_STATUS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span> <span class="s2">&quot;Proposed&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with Branch Manager&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_REGIONAL_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with Regional Manager&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with Division Director&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with public&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with Director General&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_IN_MIN_REVIEW</span><span class="p">,</span> <span class="s2">&quot;In review with Minister&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_EFFECTIVE</span><span class="p">,</span> <span class="s2">&quot;Active&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_CLOSED</span><span class="p">,</span> <span class="s2">&quot;Closed&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">STATUS_REJECTED</span><span class="p">,</span> <span class="s2">&quot;Rejected&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">SOURCE_MANUAL_ENTRY</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">SOURCE_THREATENED_FAUNA</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SOURCE_THREATENED_FLORA</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">SOURCE_THREATENED_COMMUNITIES</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="n">SOURCES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">SOURCE_MANUAL_ENTRY</span><span class="p">,</span> <span class="s1">&#39;Manual entry&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SOURCE_THREATENED_FAUNA</span><span class="p">,</span> <span class="s1">&#39;Threatened Fauna&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SOURCE_THREATENED_FLORA</span><span class="p">,</span> <span class="s1">&#39;Threatened Flora&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SOURCE_THREATENED_COMMUNITIES</span><span class="p">,</span> <span class="s1">&#39;Threatened Communities&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Data Source&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">SOURCE_MANUAL_ENTRY</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">SOURCES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Where was this record captured initially?&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">source_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Source ID&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The ID of the record in the original source, if available.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="n">taxa</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">Taxon</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Taxa&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A list of all taxa to which this document applies to.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">communities</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">Community</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Communities&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A list of all communities to which this document applies to.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">document_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Document Type&quot;</span><span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">TYPES</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">TYPE_RECOVERY_PLAN</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The document type governs the approval process.&quot;</span><span class="p">),</span> <span class="p">)</span>

    <span class="c1"># Approval status</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">FSMIntegerField</span><span class="p">(</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">APPROVAL_STATUS</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Approval status&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The approval status of the ConservationListing.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">effective_from</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Effective from&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date and time from which this document is effective from.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">effective_to</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Effective to&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date and time to which this document is effective to.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">effective_from_commonwealth</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Adopted by Commonwealth on&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date and time from which this document was adopted by the Commonwealth.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">effective_to_commonwealth</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Retired by Commonwealth on&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date and time on which this document was retired by the Commonwealth.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">review_due</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Review due date&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date and time this Document should be reviewed.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">last_reviewed_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Last reviewed on&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;The date and time this Conservation Listing was last reviewed.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># year</span>
    <span class="c1"># number</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Title&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;A concise document title.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Comments&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Optional comments on document approval and provenance.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">team</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">User</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Staff involved in the writing, approval, &quot;</span>
                       <span class="s2">&quot;or publication of this document.&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">attachments</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">FileAttachment</span><span class="p">,</span> <span class="n">object_id_field</span><span class="o">=</span><span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class opts.&quot;&quot;&quot;</span>

        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;document_type&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">]</span>
        <span class="n">index_together</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;document_type&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Document&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Documents&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">{0}</span><span class="s2">] </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_document_type_display</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># URLs</span>
    <span class="c1"># def get_absolute_url(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Detail url.&quot;&quot;&quot;</span>
    <span class="c1">#     return &quot;/&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">absolute_admin_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the absolute admin change URL.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;admin:</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">_change&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>

    <span class="c1"># ------------------------------------------------------------------------#</span>
    <span class="c1"># Django-FSM transitions</span>
    <span class="c1"># ALL -&gt; STATUS_PROPOSED -------------------------------------------------#</span>
<div class="viewcode-block" id="Document.can_recall_to_proposed"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.can_recall_to_proposed">[docs]</a>    <span class="k">def</span> <span class="nf">can_recall_to_proposed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow always to reset to the initial status.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Document.recall_to_proposed"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.recall_to_proposed">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_MIN_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_EFFECTIVE</span><span class="p">,</span>
                <span class="n">STATUS_CLOSED</span><span class="p">,</span>
                <span class="n">STATUS_REJECTED</span><span class="p">],</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_recall_to_proposed</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_recall_to_proposed&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">recall_to_proposed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset a new ConservationListing to status &quot;new&quot; (proposed).</span>

<span class="sd">        This transition allows to reset any ConservationListing to status &quot;new&quot;</span>
<span class="sd">        (before any endorsement) to start over freshly.</span>
<span class="sd">        This operation is equivalent to starting a new ConservationListing.</span>

<span class="sd">        Source: all but STATUS_PROPOSED</span>
<span class="sd">        Target: STATUS_PROPOSED</span>
<span class="sd">        Permissions: staff</span>
<span class="sd">        Gatecheck: can_recall_to_proposed (pass)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] recall_to_proposed&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_PROPOSED -&gt; STATUS_IN_EXPERT_REVIEW -----------------------------#</span>
<div class="viewcode-block" id="Document.can_submit_for_expert_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.can_submit_for_expert_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_expert_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Require if any categories are of min approval level APPROVAL_PANEL.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Document.submit_for_expert_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.submit_for_expert_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_expert_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_submit_for_expert_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_expert_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for expert review.</span>

<span class="sd">        Source: STATUS_PROPOSED</span>
<span class="sd">        Target: STATUS_IN_EXPERT_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires panel approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_expert_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># PROPOSED / IN_EXPERT_REVIEW -&gt; STATUS_IN_PUBLIC_REVIEW -----------------#</span>
<div class="viewcode-block" id="Document.can_submit_for_public_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.can_submit_for_public_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_public_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Only categories of max approval level APPROVAL_PANEL require this step.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Document.submit_for_public_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.submit_for_public_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span> <span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">],</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_public_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_submit_for_expert_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_public_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for public review.</span>

<span class="sd">        Source: STATUS_PROPOSED, STATUS_IN_EXPERT_REVIEW</span>
<span class="sd">        Target: STATUS_IN_PUBLIC_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires panel approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_public_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_PROPOSED, STATUS_IN_EXPERT_REVIEW, STATUS_IN_PUBLIC_REVIEW -&gt;</span>
    <span class="c1"># STATUS_IN_PANEL_REVIEW  ------------------------------------------------#</span>
<div class="viewcode-block" id="Document.can_submit_for_panel_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.can_submit_for_panel_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_panel_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Only categories of max approval level APPROVAL_PANEL require this step.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Document.submit_for_panel_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.submit_for_panel_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span> <span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span> <span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">],</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_panel_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_submit_for_panel_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_panel_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for panel review.</span>

<span class="sd">        A proposed review can optionally go to an expert, to the public,</span>
<span class="sd">        or go directly for panel review.</span>

<span class="sd">        Source: STATUS_PROPOSED, STATUS_IN_EXPERT_REVIEW, STATUS_IN_PUBLIC_REVIEW</span>
<span class="sd">        Target: STATUS_IN_PANEL_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires panel approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_panel_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_IN_PANEL_REVIEW -&gt; STATUS_IN_BM_REVIEW --------------------------#</span>
<div class="viewcode-block" id="Document.can_submit_for_bm_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.can_submit_for_bm_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_bm_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Only categories of approval level APPROVAL_MINISTER require this step.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Document.submit_for_bm_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.submit_for_bm_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_panel_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.submit_for_bm_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_bm_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for Branch Manager review once panel endorses.</span>

<span class="sd">        Source: STATUS_IN_PANEL_REVIEW</span>
<span class="sd">        Target: STATUS_IN_BM_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires ministerial approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_bm_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_IN_BM_REVIEW -&gt; STATUS_IN_DIR_REVIEW ----------------------------#</span>
<div class="viewcode-block" id="Document.can_submit_for_dir_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.can_submit_for_dir_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_dir_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Only categories of approval level APPROVAL_MINISTER require this step.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Document.submit_for_director_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.submit_for_director_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_dir_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_submit_for_dir_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_director_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for Dir BCS review once BM endorses.</span>

<span class="sd">        Source: STATUS_IN_BM_REVIEW</span>
<span class="sd">        Target: STATUS_IN_DIR_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires ministerial approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_director_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_IN_DIR_REVIEW -&gt; STATUS_IN_DG_REVIEW ----------------------------#</span>
<div class="viewcode-block" id="Document.can_submit_for_dg_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.can_submit_for_dg_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_dg_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Only categories of approval level APPROVAL_MINISTER require this step.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Document.submit_for_director_general_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.submit_for_director_general_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_dg_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_submit_for_dg_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_director_general_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for DG review once Director endorses.</span>

<span class="sd">        Source: STATUS_IN_DIR_REVIEW</span>
<span class="sd">        Target: STATUS_IN_DG_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires ministerial approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_director_general_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_IN_DG_REVIEW -&gt; STATUS_IN_MIN_REVIEW ----------------------------#</span>
<div class="viewcode-block" id="Document.can_submit_for_minister_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.can_submit_for_minister_review">[docs]</a>    <span class="k">def</span> <span class="nf">can_submit_for_minister_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Only categories of approval level APPROVAL_MINISTER require this step.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Document.submit_for_minister_review"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.submit_for_minister_review">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_IN_MIN_REVIEW</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_submit_for_minister_review</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_submit_for_dg_review&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">submit_for_minister_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Submit a new ConservationListing for DG review once Director endorses.</span>

<span class="sd">        Source: STATUS_IN_DG_REVIEW</span>
<span class="sd">        Target: STATUS_IN_MIN_REVIEW</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: At least one category requires ministerial approval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] submit_for_minister_review&quot;</span><span class="p">)</span></div>

    <span class="c1"># ALL -&gt; STATUS_EFFECTIVE -------------------------------------------------#</span>
<div class="viewcode-block" id="Document.can_mark_gazetted"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.can_mark_gazetted">[docs]</a>    <span class="k">def</span> <span class="nf">can_mark_gazetted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gatecheck for mark_gazetted.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Document.mark_active"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.mark_active">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_EFFECTIVE</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_mark_gazetted</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_mark_gazetted&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">mark_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mark a Document as approved and active.</span>

<span class="sd">        This transition allows any source status to fast-track any Document.</span>

<span class="sd">        Source: all but STATUS_EFFECTIVE</span>
<span class="sd">        Target: STATUS_EFFECTIVE</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: can_mark_gazetted (pass)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] you should override this method to &quot;</span>
                    <span class="s2">&quot;close other Tax/ComConservationListings in same scope.&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_* -&gt; STATUS_CLOSED ----------------------------------------------#</span>
<div class="viewcode-block" id="Document.can_mark_delisted"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.can_mark_delisted">[docs]</a>    <span class="k">def</span> <span class="nf">can_mark_delisted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gatecheck for mark_delisted.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Document.mark_closed"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.mark_closed">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span>
                <span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_MIN_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_EFFECTIVE</span><span class="p">],</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_CLOSED</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_mark_delisted</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_mark_delisted&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">mark_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mark a Document as closed.</span>

<span class="sd">        Source: all</span>
<span class="sd">        Target: STATUS_CLOSED</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: can_mark_delisted (pass)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] mark_inactive&quot;</span><span class="p">)</span></div>

    <span class="c1"># STATUS_EFFECTIVE -&gt; STATUS_ADOPTED_COMMONWEALTH</span>
    <span class="c1"># TODO</span>

    <span class="c1"># STATUS_* -&gt; STATUS_CLOSED ----------------------------------------------#</span>
<div class="viewcode-block" id="Document.can_mark_rejected"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.can_mark_rejected">[docs]</a>    <span class="k">def</span> <span class="nf">can_mark_rejected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gatecheck for mark_rejected.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Document.mark_rejected"><a class="viewcode-back" href="../../developers.html#conservation.models.Document.mark_rejected">[docs]</a>    <span class="nd">@fsm_log_by</span>
    <span class="nd">@transition</span><span class="p">(</span>
        <span class="n">field</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="n">STATUS_PROPOSED</span><span class="p">,</span>
                <span class="n">STATUS_IN_EXPERT_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_PUBLIC_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_PANEL_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_BM_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_DIR_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_DG_REVIEW</span><span class="p">,</span>
                <span class="n">STATUS_IN_MIN_REVIEW</span><span class="p">],</span>
        <span class="n">target</span><span class="o">=</span><span class="n">STATUS_REJECTED</span><span class="p">,</span>
        <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">can_mark_rejected</span><span class="p">],</span>
        <span class="c1"># permission=&#39;conservation.can_mark_rejected&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">mark_rejected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mark a conservation listing as rejected.</span>

<span class="sd">        This can happen in any review stage.</span>

<span class="sd">        Source: all review stages</span>
<span class="sd">        Target: STATUS_REJECTED</span>
<span class="sd">        Permissions: curators</span>
<span class="sd">        Gatecheck: can_mark_rejected (pass)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[ConservationListing status] mark_rejected&quot;</span><span class="p">)</span></div></div>

    <span class="c1"># end Django-FSM</span>
    <span class="c1"># ------------------------------------------------------------------------#</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2020 DBCA

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>